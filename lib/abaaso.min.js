/**
 * abaaso
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright Jason Mulligan 2012
 * @license BSD-3 <http://opensource.org/licenses/BSD-3-Clause>
 * @link http://abaaso.com
 * @module abaaso
 * @version 3.1.0
 */
(function(e){var t=e.document,n=e.location,r=e.navigator,i=typeof t=="undefined",s,o,u,a;i&&(a=require("url"),o=require("http"),u=require("https"),typeof Storage=="undefined"&&(localStorage=require("localStorage")),typeof XMLHttpRequest=="undefined"&&(XMLHttpRequest=null)),s=e.abaaso||function(){"use strict";var f,l,c,h,p={add:function(e,t){return p.contains(e,t)||e.push(t),e},cast:function(e,t){t=t===!0;var n=[];switch(!0){case!isNaN(e.length):if(!v.ie||v.version>8)n=Array.prototype.slice.call(e);else try{n=Array.prototype.slice.call(e)}catch(r){O.iterate(e,function(e,t){t!=="length"&&n.push(e)})}break;default:t?n=p.keys(e):O.iterate(e,function(e){n.push(e)})}return n},clone:function(e){return O.clone(e)},contains:function(e,t){return p.index(e,t)>-1},diff:function(e,t){var n=[];return e.each(function(e){t.contains(e)||n.add(e)}),t.each(function(t){e.contains(t)||n.add(t)}),n},each:function(e,t){var n=e.length,r=-1,i;while(++r<n){i=t.call(e,e[r],r);if(i===!1)break}return e},first:function(e){return e[0]},index:function(e,t){return e.indexOf(t)},indexed:function(e){var t=[];return O.iterate(e,function(e,n){typeof e=="object"?t=t.concat(p.indexed(e)):t.push(e)}),t},intersect:function(e,t){var n=e.length>t.length?e:t,r=n===e?t:e;return n.filter(function(e){return p.contains(r,e)})},keys:function(e){var t=[];return typeof Object.keys=="function"?t=Object.keys(e):O.iterate(e,function(e,n){t.push(n)}),t},last:function(e){return e[e.length-1]},max:function(e){return p.last(e.sort(p.sort))},min:function(e){return e.sort(p.sort)[0]},range:function(e,t,n){var r=[],i;for(i=t;i<=n;i++)typeof e[i]!="undefined"&&r.push(e[i]);return r},remove:function(e,t,n){if(isNaN(t)){t=e.index(t);if(t===-1)return e}else t=t||0;var r=e.length,i=e.slice((n||t)+1||r);return e.length=t<0?r+t:t,e.push.apply(e,i),e},sort:function(e,t){var n=!1,r;!isNaN(e)&&!isNaN(t)&&(n=!0),e=n?N.parse(e):String(e),t=n?N.parse(t):String(t);switch(!0){case e<t:r=-1;break;case e>t:r=1;break;default:r=0}return r},sum:function(e){var t=0;return p.each(e,function(e){if(typeof e!="number")return;t+=N.parse(e)}),t},total:function(e){return p.indexed(e).length},toObject:function(e){var t={},n=e.length;while(n--)t[n.toString()]=e[n];return t}},d={items:{},clean:function(){return O.iterate(d.items,function(e,t){d.expired(t)&&d.expire(t)})},expire:function(e,t){return t=t===!0,typeof d.items[e]!="undefined"?(delete d.items[e],t||e.fire("beforeExpire, expire, afterExpire"),!0):!1},expired:function(e){var t=d.items[e];return typeof t!="undefined"&&typeof t.expires!="undefined"&&t.expires<new Date},get:function(e,t){return t=t!==!1,typeof d.items[e]=="undefined"?!1:t&&d.expired(e)?(d.expire(e),!1):O.clone(d.items[e])},set:function(e,t,n){return typeof d.items[e]=="undefined"&&(d.items[e]={},d.items[e].permission=0),t==="permission"?d.items[e].permission|=n:t==="!permission"?d.items[e].permission&=~n:d.items[e][t]=n,d.items[e]}},v={android:function(){return!i&&/android/i.test(r.userAgent)}(),blackberry:function(){return!i&&/blackberry/i.test(r.userAgent)}(),chrome:function(){return!i&&/chrome/i.test(r.userAgent)}(),firefox:function(){return!i&&/firefox/i.test(r.userAgent)}(),ie:function(){return!i&&/msie/i.test(r.userAgent)}(),ios:function(){return!i&&/ipad|iphone/i.test(r.userAgent)}(),linux:function(){return!i&&/linux|bsd|unix/i.test(r.userAgent)}(),mobile:function(){s.client.mobile=this.mobile=!i&&(/blackberry|iphone|webos/i.test(r.userAgent)||/android/i.test(r.userAgent)&&(s.client.size.height<720||s.client.size.width<720))},playbook:function(){return!i&&/playbook/i.test(r.userAgent)}(),opera:function(){return!i&&/opera/i.test(r.userAgent)}(),osx:function(){return!i&&/macintosh/i.test(r.userAgent)}(),safari:function(){return!i&&/safari/i.test(r.userAgent.replace(/chrome.*/i,""))}(),tablet:function(){s.client.tablet=this.tablet=!i&&(/ipad|playbook|webos/i.test(r.userAgent)||/android/i.test(r.userAgent)&&(s.client.size.width>=720||s.client.size.width>=720))},webos:function(){return!i&&/webos/i.test(r.userAgent)}(),windows:function(){return!i&&/windows/i.test(r.userAgent)}(),version:function(){var e=0;switch(!0){case this.chrome:e=r.userAgent.replace(/(.*chrome\/|safari.*)/gi,"");break;case this.firefox:e=r.userAgent.replace(/(.*firefox\/)/gi,"");break;case this.ie:e=parseInt(r.userAgent.replace(/(.*msie|;.*)/gi,"")),t.documentMode<e&&(e=t.documentMode);break;case this.opera:e=r.userAgent.replace(/(.*opera\/|\(.*)/gi,"");break;case this.safari:e=r.userAgent.replace(/(.*version\/|safari.*)/gi,"");break;default:e=typeof r!="undefined"?r.appVersion:0}return e=isNaN(parseInt(e))?0:parseInt(e),s.client.version=this.version=e,e},allows:function(e,t){if(e.isEmpty()||t.isEmpty())throw Error(S.error.invalidArguments);if(!d.get(e,!1))return undefined;t=t.toLowerCase();var n;switch(!0){case t==="delete":n=(v.permissions(e,t).bit&1)!==0;break;case/^(head|get|options)$/.test(t):n=(v.permissions(e,t).bit&4)!==0;break;case/^(post|put)$/.test(t):n=(v.permissions(e,t).bit&2)!==0;break;default:n=!1}return n},bit:function(e){var t=0;return e.each(function(e){switch(e.toLowerCase()){case"head":case"get":case"options":t|=4;break;case"post":case"put":t|=2;break;case"delete":t|=1}}),t},cors:function(e){return!i&&e.indexOf("//")>-1&&e.indexOf("//"+n.host)===-1},headers:function(e,t,n){var r=String(e.getAllResponseHeaders()).trim().split("\n"),i={},s={},o=null,u=new Date,a=v.cors(t),l=/.*:\s+/,c=/:.*/,h=/^allow$/i,p=/^access-control-allow-methods$/i;r.each(function(e){var t,n;n=e.replace(l,""),t=e.replace(c,""),t=t.indexOf("-")===-1?t.capitalize():function(){var e=[];return t.explode("-").each(function(t){e.push(t.capitalize())}),e.join("-")}(),i[t]=n,o===null&&(a&&p.test(t)?o=n:h.test(t)&&(o=n))});switch(!0){case typeof i["Cache-Control"]!="undefined"&&/no/.test(i["Cache-Control"]):case typeof i.Pragma!="undefined"&&/no/.test(i.Pragma):break;case typeof i["Cache-Control"]!="undefined"&&/\d/.test(i["Cache-Control"]):u=u.setSeconds(u.getSeconds()+parseInt(/\d{1,}/.exec(i["Cache-Control"])[0]));break;case typeof i.Expires!="undefined":u=new Date(i.Expires);break;default:u=u.setSeconds(u.getSeconds()+f.expires)}return s.expires=u,s.headers=i,s.permission=v.bit(o!==null?o.explode():[n]),n!=="head"&&(d.set(t,"expires",s.expires),d.set(t,"headers",s.headers),d.set(t,"permission",s.permission)),s},parse:function(e,t){t=t||"";var n,r;switch(!0){case(/json|plain|javascript/.test(t)||t.isEmpty())&&Boolean(r=E.decode(/[\{\[].*[\}\]]/.exec(e.responseText),!0)):n=r;break;case/xml/.test(t)&&String(e.responseText).isEmpty()&&e.responseXML!==null:n=D.decode(typeof e.responseXML.xml!="undefined"?e.responseXML.xml:e.responseXML);break;case/<[^>]+>[^<]*]+>/.test(e.responseText):n=D.decode(e.responseText);break;default:n=e.responseText}return n},permissions:function(e){var t=d.get(e,!1),n=t?t.permission:0,r={allows:[],bit:n,map:{read:4,write:2,"delete":1}};return n&1&&r.allows.push("DELETE"),n&2&&function(){r.allows.push("POST"),r.allows.push("PUT")}(),n&4&&r.allows.push("GET"),r},jsonp:function(t,n,r,i){var s=t,o=O.guid(!0),u,a,l;typeof h=="undefined"&&(typeof e.abaaso=="undefined"&&O.define("abaaso.callback",{},e),h="abaaso");switch(!0){case typeof i=="undefined":case i===null:case i instanceof Object&&(i.callback===null||typeof i.callback=="undefined"):case typeof i=="string"&&i.isEmpty():u="callback";break;case i instanceof Object&&typeof i.callback!="undefined":u=i.callback;break;default:u="callback"}s=s.replace(u+"=?",""),s.once("afterJSONP",function(e){this.un("failedJSONP",o),typeof n=="function"&&n(e)},o).once("failedJSONP",function(){this.un("failedJSONP",o),typeof r=="function"&&r()},o);do a=O.genId().slice(0,10);while(typeof e.abaaso.callback[a]!="undefined");return t=t.replace(u+"=?",u+"="+h+".callback."+a),e.abaaso.callback[a]=function(t){l.destroy(),clearTimeout(O.timer[a]),delete O.timer[a],delete e.abaaso.callback[a],s.fire("afterJSONP",t)},l=f("head")[0].create("script",{src:t,type:"text/javascript"}),O.defer(function(){s.fire("failedJSONP")},3e4,a),t},request:function(e,t,n,r,s,o){var u,a,f,l,h,p,m,g,y,b;if(/^(post|put)$/i.test(t)&&typeof s=="undefined")throw Error(S.error.invalidArguments);t=t.toLowerCase(),o=o instanceof Object?o:null,u=v.cors(e),a=v.ie&&v.version<10&&u?new XDomainRequest:new XMLHttpRequest,f=/^(post|put)$/i.test(t)&&typeof s!="undefined"?s:null,l=t==="get"?d.get(e):!1,h=t.capitalize(),p=O.guid(!0),m=null,g=typeof Document!="undefined",y=typeof ArrayBuffer!="undefined",b=typeof Blob!="undefined",t==="delete"&&e.once("afterDelete",function(){d.expire(this)}),e.once("after"+h,function(){e.un("failed"+h,p),typeof n=="function"&&n.apply(this,arguments)},p).once("failed"+h,function(){e.un("after"+h,p),typeof r=="function"&&r.apply(this,arguments)},p).fire("before"+h);if(!/^(head|options)$/.test(t)&&e.allows(t)===!1)return e.fire("failed"+h,null,{status:405});if(t==="get"&&Boolean(l))i&&(a.readyState=4,a.status=200,a._resheaders=l.headers),e.fire("afterGet",l.response,i?a:undefined);else{a[a instanceof XMLHttpRequest?"onreadystatechange":"onload"]=function(){v.response(a,e,t)},typeof a.ontimeout!="undefined"&&(a.ontimeout=function(t){e.fire("timeout"+h,t)}),typeof a.onprogress!="undefined"&&(a.onprogress=function(t){e.fire("progress"+h,t)}),typeof a.upload!="undefined"&&typeof a.upload.onprogress!="undefined"&&(a.upload.onprogress=function(t){e.fire("progressUpload"+h,t)});try{a.open(t.toUpperCase(),e,!0),o!==null&&o.hasOwnProperty("Content-Type")&&(m=o["Content-Type"]),u&&m===null&&(m="text/plain"),f!==null&&(f.hasOwnProperty("xml")&&(f=f.xml),g&&f instanceof Document&&(f=D.decode(f)),typeof f=="string"&&/<[^>]+>[^<]*]+>/.test(f)&&(m="application/xml"),!(y&&f instanceof ArrayBuffer)&&!(b&&f instanceof Blob)&&f instanceof Object&&(m="application/json",f=E.encode(f)),m===null&&(y&&f instanceof ArrayBuffer||b&&f instanceof Blob)&&(m="application/octet-stream"),m===null&&(m="application/x-www-form-urlencoded; charset=UTF-8")),typeof a.setRequestHeader!="undefined"&&(typeof l=="object"&&l.headers.hasOwnProperty("ETag")&&a.setRequestHeader("ETag",l.headers.ETag),o===null&&(o={}),m!==null&&(o["Content-Type"]=m),o.hasOwnProperty("callback")&&delete o.callback,O.iterate(o,function(e,t){e!==null&&t!=="withCredentials"&&a.setRequestHeader(t,e)})),typeof a.withCredentials=="boolean"&&o!==null&&typeof o.withCredentials=="boolean"&&(a.withCredentials=o.withCredentials),e.fire("beforeXHR",e,a),f!==null?a.send(f):a.send()}catch(w){c(w,arguments,this,!0),e.fire("failed"+h,v.parse(a),a)}}return e},response:function(e,t,r){var o=r.toLowerCase().capitalize(),u=n,a=null,f,l,h,p,m,g;f=function(e,n){c(e,arguments,this,!0),t.fire("failed"+o,v.parse(n),n)};switch(!0){case e.readyState===2:t.fire("received"+o,null,e);break;case e.readyState===4:t.fire("afterXHR",null,e);switch(e.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 301:l=s.state,h=v.headers(e,t,r),p=v.cors(t);switch(!0){case r==="head":return t.fire("afterHead",h.headers);case r==="options":return t.fire("afterOptions",h.headers);case r!=="delete"&&/200|201/.test(e.status):g=typeof h.headers["Content-Type"]!="undefined"?h.headers["Content-Type"]:"",m=v.parse(e,g);if(typeof m=="undefined")throw Error(S.error.serverError);d.set(t,"response",h.response=O.clone(m))}l.header!==null&&Boolean(a=h.headers[l.header])&&l.current!==a&&(typeof l.change=="function"?l.change(a):l.current=a),t.fire("headers",h.headers,e);switch(e.status){case 200:case 201:t.fire("after"+o,m,e);break;case 202:case 203:case 204:case 206:t.fire("after"+o,null,e);break;case 205:t.fire("reset",null,e);break;case 301:t.fire("moved",m,e)}break;case 401:f(i?S.error.serverUnauthorized:Error(S.error.serverUnauthorized),e);break;case 403:d.set(t,"!permission",v.bit([r])),f(i?S.error.serverForbidden:Error(S.error.serverForbidden),e);break;case 405:d.set(t,"!permission",v.bit([r])),f(i?S.error.serverInvalidMethod:Error(S.error.serverInvalidMethod),e);break;default:f(i?S.error.serverError:Error(S.error.serverError),e)}break;case v.ie&&v.cors(t):var m,y;switch(!0){case Boolean(y=E.decode(/[\{\[].*[\}\]]/.exec(e.responseText))):m=y;break;case/<[^>]+>[^<]*]+>/.test(e.responseText):m=D.decode(e.responseText);break;default:m=e.responseText}d.set(t,"permission",v.bit(["get"])),d.set(t,"response",m),t.fire("afterGet",m,e)}return t},size:function(){var e=i?{clientHeight:0,clientWidth:0}:typeof t.documentElement!="undefined"?t.documentElement:t.body;return{height:e.clientHeight,width:e.clientWidth}}},m={expire:function(e,t,n){return typeof m.get(e)!="undefined"&&m.set(e,"","-1s",t,n),e},get:function(e){return O.coerce(m.list()[e])},list:function(){var e={},n,r;return typeof t.cookie!="undefined"&&!t.cookie.isEmpty()&&(r=t.cookie.explode(";"),r.each(function(t){n=t.explode("="),e[decodeURIComponent(n[0].toString().trim())]=decodeURIComponent(n[1].toString().trim())})),e},set:function(e,n,r,i,s){typeof n=="undefined"&&(n=""),n+=";",typeof r=="undefined"&&(r=""),i=typeof i=="string"?" domain="+i+";":"",s=s===!0?"; secure":"";var o="",u=null,a=null,f=["d","h","m","s"],l=new RegExp,c=f.length;if(!r.isEmpty()){while(c--){O.compile(l,f[c]);if(l.test(r)){a=f[c],u=parseInt(r);break}}if(isNaN(u))throw Error(S.error.invalidArguments);o=new Date;switch(a){case"d":o.setDate(o.getDate()+u);break;case"h":o.setHours(o.getHours()+u);break;case"m":o.setMinutes(o.getMinutes()+u);break;case"s":o.setSeconds(o.getSeconds()+u)}}return o instanceof Date&&(o=" expires="+o.toUTCString()+";"),t.cookie=e.toString().trim()+"="+n+o+i+" path=/"+s,m.get(e)}},g={methods:{batch:function(e,t,n){e=e.toString().toLowerCase(),n=n===!0;if(!/^(set|delete)$/.test(e)||typeof t!="object")throw Error(S.error.invalidArguments);var r=this.parentNode,i=this,s=0,o=0,u=!1,a=O.genId(!0),f=/^\/[^\/]/,l,c,h,d,v,m;l=function(){e==="delete"&&i.reindex(),i.loaded=!0,r.fire("afterDataBatch")},c=function(e){r.fire("failedDataSet, failedDataBatch",e)},d=function(e,t){var a=O.genId(),f={};typeof f.batch!="function"?f=O.clone(e):O.iterate(e,function(e,t){i.collections.contains(t)||(f[t]=O.clone(e))}),i.key!==null&&typeof f[i.key]!="undefined"&&(t=f[i.key],delete f[i.key]),r.once("afterDataSet",function(){this.un("failedDataSet",a),++s&&s===o&&l()},a).once("failedDataSet",function(){this.un("afterDataSet",a),u||(u=!0,this.fire("failedDataBatch"))},a),f instanceof Array&&i.uri!==null?i.generate(t):i.set(t,f,n)},r.fire("beforeDataBatch",t),e==="delete"&&r.on("afterDataDelete",function(){s++&&s===o&&(r.un("afterDataDelete, failedDataDelete",a),l())},a).once("failedDataDelete",function(){r.un("afterDataDelete",a),u||(u=!0,r.fire("failedDataBatch"))},a);if(t instanceof Array){o=t.length;switch(o){case 0:l();break;default:t.sort().reverse().each(function(t,r){r=r.toString();if(e==="set")switch(!0){case typeof t=="object":d(t,r);break;case t.indexOf("//")===-1:t.charAt(0)!=="/"?t=i.uri+"/"+t:i.uri!==null&&f.test(t)&&(m=O.parse(i.uri),t=m.protocol+"//"+m.host+t);default:r=t.replace(/.*\//,"");if(r.isEmpty())break;t.get(function(e){d(i.source===null?e:O.walk(e,i.source),r)},c,O.merge({withCredentials:i.credentials},i.headers))}else i.del(t,!1,n)})}}else o=p.cast(t,!0).length,O.iterate(t,function(t,r){e==="set"?(i.key!==null&&typeof t[i.key]!="undefined"?(h=t[i.key],delete t[i.key]):h=r.toString(),i.set(h,t,n)):i.del(t,!1,n)});return this},clear:function(e){e=e===!0;var t=this.parentNode;return e?(this.collections=[],this.crawled=!1,this.keys={},this.loaded=!1,this.records=[],this.total=0,this.views={}):(t.fire("beforeDataClear"),this.callback=null,this.collections=[],this.crawled=!1,this.credentials=null,this.expires=null,this._expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.key=null,this.keys={},this.leafs=[],this.loaded=!1,this.pointer=null,this.records=[],this.recursive=!1,this.retrieve=!1,this.source=null,this.total=0,this.views={},this.uri=null,this._uri=null,t.fire("afterDataClear")),this},crawl:function(e,t,n){var r=!1,i=this,s;if(typeof e!="number"&&typeof e!="string")throw Error(S.error.invalidArguments);return this.crawled=!0,this.loaded=!1,s=this.get(e),s=this.records[this.keys[s.key].index],n=n||this.key,typeof t=="string"&&(r=!0,t=t.explode()),O.iterate(s.data,function(e,o){switch(!0){case r&&t.contains(o):case!(e instanceof Array)&&typeof e!="string":return}if(e instanceof Array)i.collections.contains(o)||i.collections.push(o),s.data[o]=g.factory({id:s.key+"-"+o},null,{key:n,pointer:i.pointer,source:i.source}),s.data[o].data.headers=O.merge(s.data[o].data.headers,i.headers),r&&t.each(function(e){s.data[o].data.ignore.add(e)}),i.leafs.each(function(e){s.data[o].data.leafs.add(e)}),!i.leafs.contains(o)&&i.recursive&&i.retrieve&&(s.data[o].data.recursive=!0,s.data[o].data.retrieve=!0),e.length>0&&(s.data[o].once("afterDataBatch",function(){this.fire("afterDataRetrieve")},"dataRetrieve"),s.data[o].data.batch("set",e,!0));else if(e.charAt(0)==="/"||e.indexOf("//")>-1)i.collections.contains(o)||i.collections.push(o),s.data[o]=g.factory({id:s.key+"-"+o},null,{key:n,pointer:i.pointer,source:i.source}),s.data[o].once("afterDataSync",function(){this.fire("afterDataRetrieve")},"dataRetrieve"),s.data[o].data.headers=O.merge(s.data[o].data.headers,i.headers),r&&t.each(function(e){s.data[o].data.ignore.add(e)}),i.leafs.each(function(e){s.data[o].data.leafs.add(e)}),!i.leafs.contains(o)&&i.recursive&&i.retrieve&&(s.data[o].data.recursive=!0,s.data[o].data.retrieve=!0),typeof s.data[o].data.setUri=="function"?s.data[o].data.setUri(e):s.data[o].data.uri=e}),this.get(e)},del:function(e,t,n){if(typeof e=="undefined"||!/number|string/.test(typeof e))throw Error(S.error.invalidArguments);t=t!==!1,n=n===!0;var r=this.parentNode,i=/true|undefined/,s,o,u,a;switch(typeof e){case"string":s=e,e=this.keys[s];if(typeof s=="undefined")throw Error(S.error.invalidArguments);e=e.index;break;default:s=this.records[e];if(typeof s=="undefined")throw Error(S.error.invalidArguments);s=s.key}o={key:s,record:e,reindex:t},!n&&this.callback===null&&this.uri!==null&&(u=this.uri+"/"+s,a=u.allows("delete")),r.fire("beforeDataDelete",o);switch(!0){case n:case this.callback!==null:case this.uri===null:r.fire("syncDataDelete",o);break;case i.test(a):u.del(function(){r.fire("syncDataDelete",o)},function(){r.fire("failedDataDelete",o)},O.merge({withCredentials:this.credentials},this.headers));break;default:r.fire("failedDataDelete",o)}return this},find:function(e,t,n){if(typeof e=="undefined")throw Error(S.error.invalidArguments);e=typeof e=="string"?e.explode():[e],t=typeof t=="string"?t.explode():null;var r=[],i=this.parentNode,s=[],o=new RegExp;if(this.total===0)return r;switch(!0){case typeof n=="undefined":case String(n).isEmpty():n="gi";break;case n===null:n=""}return t===null?this.records.each(function(t){O.iterate(t.data,function(i,u){if(s.contains(t.key))return!1;if(typeof i.data=="object")return;e.each(function(e){O.compile(o,e,n);if(o.test(i))return s.push(t.key),r.add(t),!1})})}):this.records.each(function(i){t.each(function(t){if(s.contains(i.key))return!1;if(typeof i.data[t]=="undefined"||typeof i.data[t].data=="object")return;e.each(function(e){O.compile(o,e,n);if(o.test(i.data[t]))return s.push(i.key),r.add(i),!1})})}),r},form:function(e,t,n){n=n!==!1;var r=e===null,i=this,s,o,u,a,l,c;switch(!0){case r:e=this.get(0);break;case!(e instanceof Object):e=this.get(e)}switch(!0){case typeof e=="undefined":throw Error(S.error.invalidArguments);case this.uri!==null&&!this.uri.allows("post"):throw Error(S.error.serverInvalidMethod)}return l=e.key,c=e.data,typeof t!="undefined"&&(t=O.object(t)),this.uri!==null?(s=this.uri.replace(/.*\//,"").replace(/\?.*/,""),s.isDomain()&&(s=s.replace(/\..*/g,""))):s="record",u=function(e){var t=e.srcElement.parentNode,r=f("#"+t.id+" input"),s=r[0].name.match(/(.*)\[/)[1],o=!0,u={},a;i.parentNode.fire("beforeDataFormSubmit"),n&&(o=t.validate());switch(o){case!1:i.parentNode.fire("failedDataFormSubmit");break;case!0:r.each(function(e){if(typeof e.type!="undefined"&&/button|submit|reset/.test(e.type))return;O.define(e.name.replace("[",".").replace("]",""),e.value,u)}),a=O.genId(!0),i.parentNode.once("afterDataSet",function(){t.destroy()}),i.set(l,u[s])}i.parentNode.fire("afterDataFormSubmit",l)},a=function(e,t,n){var i,s;O.iterate(e,function(e,o){switch(!0){case e instanceof Array:i=0,e.each(function(e){a(e,t,n+"["+o+"]["+i++ +"]")});break;case e instanceof Object:a(e,t,n+"["+o+"]");break;default:s=(n+"["+o+"]").replace(/\[|\]/g,""),t.create("label",{"for":s}).html(o.capitalize()),t.create("input",{id:s,name:n+"["+o+"]",type:"text",value:r?"":e})}})},this.parentNode.fire("beforeDataForm"),o=b.create("form",{style:"display:none;"},t),a(c,o,s),o.create("input",{type:"button",value:S.common.submit}).on("click",function(e){u(e)}),o.create("input",{type:"reset",value:S.common.reset}),o.css("display","inherit"),this.parentNode.fire("afterDataForm",o),o},generate:function(e,t){var n,r;return n={headers:this.headers,ignore:p.clone(this.ignore),leafs:p.clone(this.leafs),key:this.key,pointer:this.pointer,recursive:this.recursive,retrieve:this.retrieve,source:this.source},typeof this.keys[e]!="undefined"?(r=this.keys[e].index,typeof this.records[r].data.teardown=="function"&&this.records[r].data.teardown()):(this.set(e,{},!0),r=this.keys[e].index,this.collections.add(e)),this.records[r]=g.factory({id:this.parentNode.id+"-"+e},null,n),this.uri!==null&&typeof t=="undefined"&&(t=this.uri+"/"+e,typeof this.records[r].data.setUri=="function"?this.records[r].data.setUri(t):this.records[r].data.uri=t),this.records[r].data},get:function(e,t){var n=this.records,r=this.parentNode,i=typeof e,s=this,o;switch(!0){case i==="undefined":case String(e).length===0:o=n;break;case i==="string"&&e.indexOf(",")>-1:o=[],e.explode().each(function(e){isNaN(e)||(e=parseInt(e)),o.push(s.get(e))});break;case i==="string"&&typeof this.keys[e]!="undefined":o=n[this.keys[e].index];break;case i==="number"&&typeof t=="undefined":o=n[parseInt(e)];break;case i==="number"&&typeof t=="number":o=n.range(parseInt(e),parseInt(t));break;default:o=undefined}return o},reindex:function(){var e=this.total,t=this.parentNode,n=this.key!==null,r;this.views={};if(e===0)return this;for(r=0;r<e;r++)!n&&this.records[r].key.isNumber()&&(delete this.keys[this.records[r].key],this.keys[r.toString()]={},this.records[r].key=r.toString()),this.keys[this.records[r].key].index=r;return this},set:function(e,t,n){e===null&&(e=undefined),n=n===!0;switch(!0){case(typeof e=="undefined"||String(e).isEmpty())&&this.uri===null:case typeof t=="undefined":throw Error(S.error.invalidArguments);case t instanceof Array:return this.generate(e).batch("set",t,!0);case t instanceof Number:case t instanceof String:case typeof t!="object":throw Error(S.error.invalidArguments)}var r=typeof e=="undefined"?undefined:this.get(e),i=this.parentNode,s=typeof e=="undefined"?"post":"put",o=this,u={data:{},key:e,record:undefined},a=this.uri,f=/true|undefined/,l,c,h;typeof r!="undefined"?(u.record=this.records[this.keys[r.key].index],O.iterate(u.record.data,function(e,t){!o.collections.contains(t)&&!o.ignore.contains(t)&&(u.data[t]=e)}),O.merge(u.data,t)):u.data=t,c=function(e){u.result=e,i.fire("syncDataSet",u)},h=function(e){i.fire("failedDataSet")},!n&&this.callback===null&&a!==null&&(typeof r!="undefined"&&(a+="/"+r.key),l=a.allows(s)),i.fire("beforeDataSet",{key:e,data:t});switch(!0){case n:case this.callback!==null:case this.uri===null:i.fire("syncDataSet",u);break;case f.test(l):a[s](c,h,t,O.merge({withCredentials:this.credentials},this.headers));break;default:i.fire("failedDataSet",u)}return this},sort:function(e,t,n){if(typeof e=="undefined"||String(e).isEmpty())throw Error(S.error.invalidArguments);/ci|cs|ms/.test(n)||(n="ci"),t=t===!0;var r=e.replace(/\s*asc/g,"").replace(/,/g," ").toCamelCase()+n.toUpperCase(),i=e.explode(),s=/:::(.*)$/,o=/\s*asc$/i,u=/\s*desc$/i,a=/^null/,f=this.key,l=[],c,h,d;return i.each(function(e){if(String(e).isEmpty())throw Error(S.error.invalidArguments)}),!t&&this.views[r]instanceof Array?this.views[r]:this.total===0?[]:(d=function(e,t){var n=e.clone(),r=e.first(),i={},s=[];return n.remove(0),i=c(r,t,u.test(r)),i.order.each(function(e){if(i.registry[e].length<2)return;n.length>0&&(i.registry[e]=d(n,i.registry[e]))}),i.order.each(function(e){s=s.concat(i.registry[e])}),s},c=function(e,t,r){e=e.replace(o,"");var i=e.replace(u,""),s=f===i,a=[],l={};return t.each(function(e){var t=s?e.key:e.data[i],r=t===null?"null":String(t);switch(n){case"ci":r=r.toCamelCase();break;case"cs":r=r.trim();break;case"ms":r=r.trim().slice(0,1).toLowerCase()}l[r]instanceof Array||(l[r]=[],a.push(r)),l[r].push(e)}),a.sort(p.sort),r&&a.reverse(),a.each(function(t){if(l[t].length===1)return;l[t]=h(l[t],e,i,r,s)}),{order:a,registry:l}},h=function(e,t,n,r,i){var o=[],u=[];return e.each(function(e,t){var r=i?e.key:e.data[n];r=String(r).trim()+":::"+t,o.push(r.replace(a,'""'))}),o.length>1&&(o.sort(p.sort),r&&o.reverse()),o.each(function(t){u.push(e[s.exec(t)[1]])}),u},l=d(i,this.records),this.views[r]=l,l)},storage:function(e,t,n){var r=!1,i=n==="session"&&typeof sessionStorage!="undefined",s=/number|string/,o,u,a;if(!/number|object|string/.test(typeof e)||!/get|remove|set/.test(t))throw Error(S.error.invalidArguments);r=s.test(e)||e.hasOwnProperty("key")&&!e.hasOwnProperty("parentNode"),r&&!(e instanceof Object)&&(e=this.get(e)),u=r?e.key:e.parentNode.id;switch(t){case"get":o=i?sessionStorage.getItem(u):localStorage.getItem(u);if(o===null)throw Error(S.error.invalidArguments);o=E.decode(o),r?this.set(u,o,!0):O.merge(this,o),o=r?e:this;break;case"remove":i?sessionStorage.removeItem(u):localStorage.removeItem(u),o=this;break;case"set":a=E.encode(r?e.data:{total:this.total,keys:this.keys,records:this.records}),i?sessionStorage.setItem(u,a):localStorage.setItem(u,a),o=this}return o},sync:function(e){if(this.uri===null||this.uri.isEmpty())throw Error(S.error.invalidArguments);e=e===!0;var t=this,n=t.parentNode,r=O.guid(!0),i,s;return i=function(r){try{if(typeof r!="object")throw Error(S.error.expectedObject);var i,s=!1,o=O.genId(!0);t.source!==null&&(r=O.walk(r,t.source)),r instanceof Array?i=r:O.iterate(r,function(e){!s&&e instanceof Array&&(s=!0,i=e)}),typeof i=="undefined"&&(i=[r]),n.once("afterDataBatch",function(n){e&&t.reindex(),this.un("failedDataBatch",o).fire("afterDataSync",t.get())},o),n.once("failedDataBatch",function(e){t.clear(!0),this.un("afterDataBatch",o).fire("failedDataSync")},o),t.batch("set",i,!0)}catch(u){c(u,arguments,this),n.fire("failedDataSync",r)}},s=function(e){n.fire("failedDataSync",e)},n.fire("beforeDataSync"),this.callback!==null?this.uri.jsonp(i,s,{callback:this.callback}):this.uri.get(i,s,O.merge({withCredentials:this.credentials},this.headers)),this},teardown:function(){var e=this.uri,t,n;return e!==null&&(d.expire(e,!0),C.remove(e),n=this.parentNode.id+"DataExpire",O.clearTimers(n),t=this.get(),t.each(function(t){d.expire(e+"/"+t.key,!0),C.remove(e+"/"+t.key),O.iterate(t.data,function(e,t){if(e===null)return;e.hasOwnProperty("data")&&typeof e.data.teardown=="function"&&(C.remove(e.id),e.data.teardown())})})),this.clear(!0),this}},factory:function(e,t,n){var r={expires:{getter:function(){return this._expires},setter:function(e){if(e!==null&&this.uri===null||e!==null&&(isNaN(e)||e<1e3))throw Error(S.error.invalidArguments);if(this._expires===e)return;this._expires=e;var t=this.parentNode.id+"DataExpire",n=e,r=this;O.clearTimers(t);if(e===null)return;O.repeat(function(){if(r.uri===null)return typeof r.setExpires=="function"?r.setExpires(null):r.expires=null,!1;d.expire(r.uri)||r.uri.fire("beforeExpire, expire, afterExpire")},n,t)}},uri:{getter:function(){return this._uri},setter:function(e){if(e!==null&&e.isEmpty())throw Error(S.error.invalidArguments);switch(!0){case this._uri===e:return;case this._uri!==null:this._uri.un();default:this._uri=e}e!==null&&(e.on("expire",function(){this.sync(!0)},"dataSync",this),d.expire(e,!0),this.sync())}}};e=O.object(e),O.genId(e),typeof e.fire=="undefined"&&C.hook(e),e.fire("beforeDataStore"),e.data=O.extend(g.methods),e.data.parentNode=e,e.data.clear(),n instanceof Object&&O.merge(e.data,n),e.on("syncDataDelete",function(e){var t=this.get(e.record);return this.records.remove(this.keys[e.key].index),delete this.keys[e.key],this.total--,this.views={},e.reindex&&this.reindex(),O.iterate(t.data,function(e,t){if(e===null)return;typeof e.data!="undefined"&&typeof e.data.teardown=="function"&&e.data.teardown()}),this.parentNode.fire("afterDataDelete",t),this.parentNode},"recordDelete",e.data),e.on("syncDataSet",function(e){var t=typeof e.record=="undefined"?O.clone(e):e,n=!0,r=this,i,s;switch(!0){case typeof t.record=="undefined":var o=this.total;this.total++;if(typeof t.key=="undefined"){if(typeof t.result=="undefined")throw this.fire("failedDataSet"),Error(S.error.expectedObject);this.source!==null&&(t.result=O.walk(t.result,this.source)),this.key===null?t.key=p.cast(t.result).first():(t.key=t.result[this.key],delete t.result[this.key]),typeof t.key!="string"&&(t.key=t.key.toString()),t.data=t.result}this.keys[t.key]={},this.keys[t.key].index=o,this.records[o]={},i=this.records[o],i.key=t.key;if(this.pointer===null||typeof t.data[this.pointer]=="undefined")i.data=t.data,this.key!==null&&this.records[o].data.hasOwnProperty(this.key)&&delete this.records[o].data[this.key];else{n=!1,s=t.data[this.pointer];if(typeof s=="undefined"||s===null)throw delete this.records[o],delete this.keys[t.key],this.fire("failedDataSet"),Error(S.error.expectedObject);i.data={},s.get(function(e){r.source!==null&&(e=O.walk(e,r.source)),typeof e[r.key]!="undefined"&&delete e[r.key],O.merge(i.data,e),r.retrieve&&(r.crawl(i.key,r.ignore.length>0?r.ignore.join(","):undefined,r.key),r.loaded=!0),r.parentNode.fire("afterDataSet",i)},function(){r.parentNode.fire("failedDataSet")},r.headers)}break;default:i=this.records[this.keys[t.record.key].index],O.merge(i.data,t.data)}this.views={},this.retrieve&&this.crawl(i.key,this.ignore.length>0?this.ignore.join(","):undefined,this.key),n&&this.parentNode.fire("afterDataSet",i)},"recordSet",e.data);switch(!0){case!v.ie||v.version>8:O.property(e.data,"uri",{enumerable:!0,get:r.uri.getter,set:r.uri.setter}),O.property(e.data,"expires",{enumerable:!0,get:r.expires.getter,set:r.expires.setter});break;default:e.data.setExpires=function(t){e.data.expires=t,r.expires.setter.call(e.data,t)},e.data.setUri=function(t){e.data.uri=t,r.uri.setter.call(e.data,t)}}return typeof t=="object"&&t!==null&&e.data.batch("set",t),e.fire("afterDataStore"),e}},y={position:/top|bottom/,methods:{page:function(e){if(isNaN(e))throw Error(S.error.invalidArguments);return this.pageIndex=e,this.refresh(),this},pages:function(){var e=this.element,t=f("#"+e.id+"-pages-top, #"+e.id+"-pages-bottom"),n=this.pageIndex,r=this.pagination,i=this.pageRange,s=i.half().roundDown(),o=n-s,u=n+s,a=this,l=y.pages.call(this),c=0,h,p,d;if(!y.position.test(r))throw Error(S.error.invalidArguments);return t.each(function(e){typeof e!="undefined"&&e.destroy()}),this.total===0||l===1?this:(o<1&&(h=o.diff(1),o+=h,u+=h),u>l&&(u=l,o=u-i+1,o<1&&(o=1)),r.explode().each(function(r){t=e[r==="bottom"?"after":"before"]("ul",{"class":"list pages "+r,id:e.id+"-pages-"+r}),n>1?t.create("li").create("a",{"class":"first page","data-page":1}).html("&lt;&lt;").on("click",function(){a.page(this.data("page"))},"click"):t.create("li").create("span",{"class":"first page"}).html("&lt;&lt;"),n>1?t.create("li").create("a",{"class":"prev page","data-page":n-1}).html("&lt;").on("click",function(){a.page(this.data("page"))},"click"):t.create("li").create("span",{"class":"prev page"}).html("&lt;");for(r=o;r<=u;r++)r!==n?t.create("li").create("a",{"class":r===n?"current page":"page","data-page":r}).html(r).on("click",function(e){a.page(this.data("page"))},"click"):t.create("li").create("span",{"class":"page"}).html(r);n+1<=l?t.create("li").create("a",{"class":"next page","data-page":n+1}).html("&gt;").on("click",function(){a.page(this.data("page"))},"click"):t.create("li").create("span",{"class":"next page"}).html("&gt;"),n<l?t.create("li").create("a",{"class":"last page","data-page":l}).html("&gt;&gt;").on("click",function(){a.page(this.data("page"))},"click"):t.create("li").create("span",{"class":"last page"}).html("&gt;&gt;"),t.find("a").on("click",function(e){window.scrollTo(0,0)})}),this)},refresh:function(e){e=e!==!1;var t=this.element,n=typeof this.template=="object",r=!n&&String(this.template).replace(/\{\{|\}\}/g,"")===this.store.key,i=[],s=[],o=this,u=typeof this.callback=="function",a=/\{\{.*\}\}/g,l=new RegExp,c=[],h=[],p,d;return this.ready||(this.ready=!0,this.store.parentNode.on("afterDataSet",function(e){if(y.garbage(this.store.parentNode,t.id,"afterDataSet","set-"+t.id))return;this.refreshing||this.refresh()},"set-"+t.id,this)),this.element.fire("beforeDataListRefresh"),this.refreshing=!0,n?p=function(e){var t=E.encode(o.template);return t=t.replace("{{"+o.store.key+"}}",e.key),E.iterate(e.data,function(e,n){l.compile("{{"+n+"}}","g"),t=t.replace(l,E.encode(e).replace(/(^")|("$)/g,""))}),t=E.decode(t.replace(a,o.placeholder)),{li:t}}:p=function(e){var t=String(o.template);return t=t.replace("{{"+o.store.key+"}}",e.key),O.iterate(e.data,function(e,n){l.compile("{{"+n+"}}","g"),t=t.replace(l,e)}),{li:t.replace(a,o.placeholder)}},i=this.order.isEmpty()?this.store.get():this.store.sort(this.order,!1,this.sensitivity),i.each(function(e){o.filter!==null&&o.filter instanceof Object?O.iterate(o.filter,function(t,n){if(c.index(e.key)>-1)return;var r=0,i=new RegExp,u;t=String(t).explode(),u=t.length;for(r=0;r<u;r++){i.compile(t[r],"i");if(n===o.store.key&&i.test(e.key)||typeof e.data[n]!="undefined"&&i.test(e.data[n])){c.push(e.key),s.push({key:e.key,template:p(e)});return}}}):s.push({key:e.key,template:p(e)})}),this.total=s.length,typeof this.pageIndex=="number"&&typeof this.pageSize=="number"&&(h=y.range.call(this),s=s.range(h[0],h[1])),e?(t.clear(),s.each(function(e){var n=t.tpl(e.template);n.data("key",e.key),u&&o.callback(n)})):(t.find("> li").addClass("hidden"),s.each(function(e){t.find("> li[data-key='"+e.key+"']").removeClass("hidden")})),y.position.test(this.pagination)&&typeof this.pageIndex=="number"&&typeof this.pageSize=="number"?this.pages():(f("#"+this.element.id+"-pages-top, #"+this.element.id+"-pages-bottom"),typeof d!="undefined"&&d.destroy()),this.refreshing=!1,this.element.fire("afterDataListRefresh",t),this},sort:function(e,t){if(typeof e!="string")throw Error(S.error.invalidArguments);return this.element.fire("beforeDataListSort"),this.order=e,this.sensitivity=t||"ci",this.refresh(),this.element.fire("afterDataListSort"),this},teardown:function(){var e=this.element.id;return this.store.parentNode.un("afterDataDelete","delete-"+e).un("afterDataRetrieve, afterDataSync","refresh-"+e),this}},factory:function(e,t,n,r){var i=[t],s={},o={},u,a;if(e instanceof Element&&typeof t=="object"&&!!/string|object/.test(typeof n))return u=e.fire("beforeDataList").create("ul",{"class":"list",id:t.parentNode.id+"-datalist"}),o={callback:null,filter:null,pageIndex:1,pageSize:null,pageRange:5,pagination:"bottom",placeholder:"",order:"",ready:!1,refreshing:!1,template:n,total:0,sensitivity:"ci"},s=O.extend(y.methods,o),s.element=u,s.store=i[0],r instanceof Object&&O.iterate(r,function(e,t){s[t]=e}),s.store.parentNode.on("afterDataDelete",function(e){this.element.fire("beforeDataListRefresh");if(y.garbage(this.store.parentNode,u.id,"afterDataDelete","delete-"+u.id))return;typeof this.pageIndex=="number"&&typeof this.pageSize=="number"?this.refresh():this.element.find("> li[data-key='"+e.key+"']").destroy(),this.element.fire("afterDataListRefresh")},"delete-"+u.id,s),a=function(){var e=this.store.retrieve?"afterDataRetrieve":"afterDataSync";this.store.parentNode.once(e,function(){if(y.garbage(this.store.parentNode,u.id,e,"refresh-"+u.id))return;!this.refreshing&&(e==="afterDataRetrieve"||this.store.loaded)&&this.refresh(),a.call(this)},"refresh-"+u.id,this),y.now.call(s)&&s.refresh()},y.now.call(s)?a.call(s):s.store.parentNode.once(s.store.parentNode.retrieve?"afterDataRetrieve":"afterDataSync",a,"initialize-"+u.id,s),e.fire("afterDataList",u),s;throw Error(S.error.invalidArguments)},garbage:function(e,t,n,r){var i=!1;return typeof f("#"+t)=="undefined"&&(e.un(n,r),i=!0),i},now:function(){return this.store.uri===null||this.store.loaded},pages:function(){if(isNaN(this.pageSize))throw Error(S.error.invalidArguments);return(this.total/this.pageSize).roundUp()},range:function(){var e=this.pageIndex*this.pageSize-this.pageSize,t=e+this.pageSize-1;return[e,t]}},b={attr:function(e,t,n){typeof n=="string"&&(n=n.trim());var r=/checked|disabled/,i;e=O.object(e);if(!(e instanceof Element&&typeof t!="undefined"&&!String(t).isEmpty()))throw Error(S.error.invalidArguments);switch(!0){case r.test(t)&&typeof n=="undefined":return e[t];case r.test(t)&&typeof n!="undefined":return e[t]=n,e;case e.nodeName==="SELECT"&&t==="selected"&&typeof n=="undefined":return f("#"+e.id+' option[selected="selected"]').first()||f("#"+e.id+" option").first();case e.nodeName==="SELECT"&&t==="selected"&&typeof n!="undefined":return i=f("#"+e.id+' option[selected="selected"]').first(),typeof i!="undefined"&&(i.selected=!1,i.removeAttribute("selected")),i=f("#"+e.id+' option[value="'+n+'"]').first(),i.selected=!0,i.setAttribute("selected","selected"),e;case typeof n=="undefined":return e.getAttribute(t);case n===null:return e.removeAttribute(t),e;default:return e.setAttribute(t,n),e}},clear:function(e){e=O.object(e);if(e instanceof Element){e.fire("beforeClear");switch(!0){case typeof e.reset=="function":e.reset();break;case typeof e.value!="undefined":e.update({innerHTML:"",value:""});break;default:e.update({innerHTML:""})}return e.fire("afterClear"),e}throw Error(S.error.invalidArguments)},create:function(e,n,r,i){if(typeof e=="undefined"||String(e).isEmpty())throw Error(S.error.invalidArguments);var s,o,u;switch(!0){case typeof r!="undefined":r=O.object(r);break;case typeof n!="undefined"&&(typeof n=="string"||typeof n.childNodes!="undefined"):r=O.object(n);break;default:r=t.body}if(typeof r=="undefined")throw Error(S.error.invalidArguments);u=!(r instanceof Element),o=typeof n!="undefined"&&typeof n!="string"&&typeof n.childNodes=="undefined"&&typeof n.id!="undefined"&&typeof f("#"+n.id)=="undefined"?n.id:O.genId(),typeof n!="undefined"&&typeof n.id!="undefined"&&delete n.id,f.fire("beforeCreate",o),u?u&&r.parentNode!==null&&r.parentNode.fire("beforeCreate",o):r.fire("beforeCreate",o),s=/svg/i.test(e)?t.createElementNS("http://www.w3.org/2000/svg","svg"):t.createElement(e),s.id=o,typeof n=="object"&&typeof n.childNodes=="undefined"&&s.update(n);switch(!0){case typeof i=="undefined":case i==="last":r.appendChild(s);break;case i==="first":r.prependChild(s);break;case i==="after":i={},i.after=r,r=r.parentNode;case typeof i.after!="undefined":r.insertBefore(s,i.after.nextSibling);break;case i==="before":i={},i.before=r,r=r.parentNode;case typeof i.before!="undefined":r.insertBefore(s,i.before);break;default:r.appendChild(s)}return u?u&&r.parentNode!==null&&r.parentNode.fire("afterCreate",s):r.fire("afterCreate",s),f.fire("afterCreate",s),s},css:function(e,t,n){e=O.object(e),t=t.indexOf("-")>-1?A.toCamelCase(t,!0):t;var r,i;return typeof n!="undefined"?(e.style[t]=n,i=e):i=e.style[t],i},data:function(e,t,n){var r;return e=O.object(e),typeof n!="undefined"?(typeof e.dataset=="object"?e.dataset[t]=n:b.attr(e,"data-"+t,n),r=e):r=O.coerce(typeof e.dataset=="object"?e.dataset[t]:b.attr(e,"data-"+t)),r},destroy:function(e){e=O.object(e);if(e instanceof Element)return f.fire("beforeDestroy",e),e.fire("beforeDestroy"),C.remove(e.id),e.parentNode!==null&&e.parentNode.removeChild(e),e.fire("afterDestroy"),f.fire("afterDestroy",e.id),undefined;throw Error(S.error.invalidArguments)},disable:function(e){e=O.object(e);if(e instanceof Element)return typeof e.disabled=="boolean"&&!e.disabled&&(e.fire("beforeDisable"),e.disabled=!0,e.fire("afterDisable")),e;throw Error(S.error.invalidArguments)},enable:function(e){e=O.object(e);if(e instanceof Element)return typeof e.disabled=="boolean"&&e.disabled&&(e.fire("beforeEnable"),e.disabled=!1,e.fire("afterEnable")),e;throw Error(S.error.invalidArguments)},find:function(e,t){var n=[];e=O.object(e);if(e instanceof Element&&typeof t=="string")return O.genId(e),t.explode().each(function(t){f("#"+e.id+" "+t).each(function(e){n.add(e)})}),n;throw Error(S.error.invalidArguments)},has:function(e,t){var n=b.find(e,t);return!isNaN(n.length)&&n.length>0},hasClass:function(e,t){return e=O.object(e),e.classList.contains(t)},hide:function(e){e=O.object(e);if(e instanceof Element){e.fire("beforeHide");switch(!0){case typeof e.hidden=="boolean":e.hidden=!0;break;default:e["data-display"]=e.style.display,e.style.display="none"}return e.fire("afterHide"),e}throw Error(S.error.invalidArguments)},hidden:function(e){e=O.object(e);if(e instanceof Element)return e.style.display==="none"||typeof e.hidden=="boolean"&&e.hidden;throw Error(S.error.invalidArguments)},is:function(e,t){e=O.object(e);if(e instanceof Element&&typeof t=="string")return O.genId(e),/^:/.test(t)?b.find(e.parentNode,e.nodeName.toLowerCase()+t).contains(e):(new RegExp(t,"i")).test(e.nodeName);throw Error(S.error.invalidArguments)},klass:function(e,t,n){var r;e=O.object(e);if(e instanceof Element&&!String(t).isEmpty())return e.fire("beforeClassChange"),n=n!==!1,t=t.explode(" "),n?t.each(function(t){e.classList.add(t)}):t.each(function(t){if(t==="*")return e.classList.each(function(e){this.remove(e)}),!1;e.classList.remove(t)}),e.fire("afterClassChange"),e;throw Error(S.error.invalidArguments)},position:function(n){n=O.object(n);if(n instanceof Element){var r,i,s,o;r=i=0,o=n.offsetWidth,s=n.offsetHeight;if(n.offsetParent){i=n.offsetTop,r=n.offsetLeft;while(n=n.offsetParent)r+=n.offsetLeft,i+=n.offsetTop}return{top:i,right:t.documentElement.clientWidth-(r+o),bottom:t.documentElement.clientHeight+e.scrollY-(i+s),left:r}}throw Error(S.error.invalidArguments)},prependChild:function(e,t){e=O.object(e);if(e instanceof Element&&t instanceof Element)return e.childNodes.length===0?e.appendChild(t):e.insertBefore(t,e.childNodes[0]);throw Error(S.error.invalidArguments)},show:function(e){e=O.object(e);if(e instanceof Element){e.fire("beforeShow");switch(!0){case typeof e.hidden=="boolean":e.hidden=!1;break;default:e.style.display=e.getAttribute("data-display")!==null?e.getAttribute("data-display"):"inherit"}return e.fire("afterShow"),e}throw Error(S.error.invalidArguments)},size:function(e){e=O.object(e);var t,n,r;if(e instanceof Element)return t=function(e){return isNaN(e)?0:parseInt(e)},n=e.offsetHeight+t(e.style.paddingTop)+t(e.style.paddingBottom)+t(e.style.borderTop)+t(e.style.borderBottom),r=e.offsetWidth+t(e.style.paddingLeft)+t(e.style.paddingRight)+t(e.style.borderLeft)+t(e.style.borderRight),{height:n,width:r};throw Error(S.error.invalidArguments)},text:function(e,t){e=O.object(e);var n=typeof e.textContent!="undefined"?"textContent":"innerText",r={},i=!1;return typeof t!="undefined"&&(i=!0,r[n]=t),i?b.update(e,r):e[n]},toggleClass:function(e,t){e=O.object(e);if(e instanceof Element)return e.classList.toggle(t),e;throw Error(S.error.invalidArguments)},update:function(e,t){var n;e=O.object(e),t=t||{};if(e instanceof Element)return e.fire("beforeUpdate"),n=/innerHTML|innerText|textContent|type|src/,O.iterate(t,function(t,r){switch(!0){case n.test(r):e[r]=t;break;case r==="class":t.isEmpty()?e.removeClass("*"):e.addClass(t);break;case r.indexOf("data-")===0:b.data(e,r.replace("data-",""),t);break;case"id":var i=C.listeners;typeof i[e.id]!="undefined"&&(i[r]=O.clone(i[e.id]),delete i[e.id]);default:e.attr(r,t)}}),e.fire("afterUpdate"),e;throw Error(S.error.invalidArguments)},val:function(e,t){var n=null,r=/^select$/i,i=/^(radio|checkbox)$/i,s;e=O.object(e);if(e instanceof Element){switch(!0){case typeof t=="undefined":switch(!0){case i.test(e.type):if(e.name.isEmpty())throw Error(S.error.expectedProperty);s=f("input[name='"+e.name+"']"),s.each(function(e){if(n!==null)return;e.checked&&(n=e.value)});break;case r.test(e.type):n=e.options[e.selectedIndex].value;break;default:n=typeof e.value!="undefined"?e.value:b.text(e)}typeof n=="string"&&(n=n.trim());break;default:t=String(t),e.fire("beforeValue");switch(!0){case i.test(e.type):s=f("input[name='"+e.name+"']"),s.each(function(e){if(e.value===t)return e.checked=!0,n=e,!1});break;case r.test(e.type):e.find("> *").each(function(e){if(e.value===t)return e.selected=!0,n=e,!1});break;default:typeof e.value!="undefined"?e.value=t:b.text(e,t)}e.fire("afterValue"),n=e}return n}throw Error(S.error.invalidArguments)}},w={methods:{init:function(){return this.element.on("keyup",this.update,"filter",this),this},set:function(e){var t={};if(typeof e!="string"||String(e).isEmpty())throw Error(f.label.error.invalidArguments);return e.explode().each(function(e){t[e]=""}),this.filters=t,this},teardown:function(){return this.element.un("keyup","filter"),this},update:function(e){var t=this.element.val();return t.isEmpty()?this.datalist.filter=null:(O.iterate(this.filters,function(e,n){this[n]="^"+t.escape().replace("\\*",".*")}),this.datalist.filter=this.filters),this.datalist.pageIndex=1,this.datalist.refresh(),this}},factory:function(e,t,n){var r={},i=[t];if(!(e instanceof Element)||typeof t!="undefined"&&typeof t.store=="undefined"||typeof n!="string"||String(n).isEmpty())throw Error(f.label.error.invalidArguments);return r=O.extend(w.methods,{filters:{}}),r.datalist=i[0],r.element=e,r.set(n),r.element.on("afterValue",r.update,"value",r),r.init()}},E={decode:function(e,t){try{return JSON.parse(e)}catch(n){return t!==!0&&c(n,arguments,this),undefined}},encode:function(e,t){try{return JSON.stringify(e)}catch(n){return t!==!0&&c(n,arguments,this),undefined}}},S={common:{back:"Back",cancel:"Cancel",clear:"Clear",close:"Close",cont:"Continue",create:"Create",del:"Delete",edit:"Edit",find:"Find",gen:"Generate",go:"Go",loading:"Loading",next:"Next",login:"Login",ran:"Random",reset:"Reset",save:"Save",search:"Search",submit:"Submit"},day:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},error:{databaseNotOpen:"Failed to open the Database, possibly exceeded Domain quota",databaseNotSupported:"Client does not support local database storage",databaseWarnInjection:"Possible SQL injection in database transaction, use the &#63; placeholder",elementNotCreated:"Could not create the Element",elementNotFound:"Could not find the Element",expectedArray:"Expected an Array",expectedArrayObject:"Expected an Array or Object",expectedBoolean:"Expected a Boolean value",expectedNumber:"Expected a Number",expectedProperty:"Expected a property, and it was not set",expectedObject:"Expected an Object",invalidArguments:"One or more arguments is invalid",invalidDate:"Invalid Date",invalidFields:"The following required fields are invalid: ",invalidRoute:"The route could not be found",notAvailable:"Requested method is not available",notSupported:"This feature is not supported by this platform",propertyNotFound:"Could not find the requested property",promiseResolved:"The promise has been resolved: {{outcome}}",serverError:"Server error has occurred",serverForbidden:"Forbidden to access URI",serverInvalidMethod:"Method not allowed",serverUnauthorized:"Authorization required to access URI"},month:{0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"}},x={clear:function(t){return typeof t=="undefined"&&(t="all"),f.un(e,"message","message",t)},send:function(e,t){try{e.postMessage(t,"*")}catch(n){c(n,arguments,this)}return e},recv:function(t,n){return typeof n=="undefined"&&(n="all"),f.on(e,"message",t,"message",e,n)}},T={enabled:!1,log:!1,diff:{x:null,y:null},pos:{x:null,y:null},prev:{x:null,y:null},track:function(e){var n=s.mouse,e="mousemove",r="tracking";if(i)return n;switch(!0){case typeof e=="object":var o=t[v.ie&&v.version<9?"documentElement":"body"],u=e.pageX?e.pageX:o.scrollLeft+e.clientX,a=e.pageY?e.pageY:o.scrollTop+e.clientY,l=!1;n.pos.x!==u&&(l=!0),f.mouse.prev.x=n.prev.x=Number(n.pos.x),f.mouse.pos.x=n.pos.x=u,f.mouse.diff.x=n.diff.x=n.pos.x-n.prev.x,n.pos.y!==a&&(l=!0),f.mouse.prev.y=n.prev.y=Number(n.pos.y),f.mouse.pos.y=n.pos.y=a,f.mouse.diff.y=n.diff.y=n.pos.y-n.prev.y,l&&n.log&&O.log(n.pos.x+" ["+n.diff.x+"], "+n.pos.y+" ["+n.diff.y+"]");break;case typeof e=="boolean":e?C.add(t,e,s.mouse.track,r):C.remove(t,e,r),f.mouse.enabled=n.enabled=e}return n}},N={diff:function(e,t){if(isNaN(e)||isNaN(t))throw Error(S.error.expectedNumber);return Math.abs(e-t)},even:function(e){return e%2===0},format:function(e,t,n){if(isNaN(e))throw Error(S.error.expectedNumber);e=e.toString(),t=t||",",n=n||3;var r=e.indexOf(".")>-1?"."+e.replace(/.*\./,""):"",i=e.replace(/\..*/,"").split("").reverse(),s=Math.floor(i.length/n),o=1,u,a;for(a=0;a<s;a++)u=o===1?n:n*o+(o===2?1:o-1),i.splice(u,0,t),o++;return i=i.reverse().join(""),i.charAt(0)===t&&(i=i.substring(1)),i+r},half:function(e,t){return typeof t!="undefined"?e/t===.5:e/2},odd:function(e){return e%2!==0},parse:function(e){return String(e).indexOf(".")<0?parseInt(e):parseFloat(e)},round:function(e,t){return String(e).indexOf(".")<0?e:(/down|up/.test(t)||(t="down"),Math[t==="down"?"floor":"ceil"](e))}},C={listeners:{},log:!1,add:function(e,t,n,r,i,o){e=O.object(e),i=i||s,o=o||s.state.current;if(e instanceof Array)return e.each(function(e){C.add(e,t,n,r,i,o)});typeof t!="undefined"&&(t=t.explode());if(typeof r=="undefined"||!/\w/.test(r))r=O.guid(!0);var u=null,a=C.listeners,f=C.id(e),l=!1,c=s.state.current,h=/body|document|window/i,p=/click|error|key|mousedown|mouseup/i,d,v,m,g;if(typeof f=="undefined"||t===null||typeof t=="undefined"||typeof n!="function")throw Error(S.error.invalidArguments);return g=function(t,n){p.test(t.type)||O.stop(t),C.fire(e,n,t)},t.each(function(t){l=!1,typeof a[f]=="undefined"&&(a[f]={}),typeof a[f][t]=="undefined"&&(l=!0)&&(a[f][t]={}),typeof a[f][t][o]=="undefined"&&(a[f][t][o]={});if(l){switch(!0){case h.test(f):case!/\//g.test(f)&&f!=="abaaso":u=e;break;default:u=null}u!==null&&typeof u!="undefined"&&t.toLowerCase()!=="afterjsonp"&&(h.test(f)||typeof u.listeners=="function")&&(v=typeof u.addEventListener=="function",m=typeof u.attachEvent=="object"||v,m&&u[v?"addEventListener":"attachEvent"]((v?"":"on")+t,function(e){g(e,t)},!1))}d={fn:n,scope:i},a[f][t][o][r]=d}),e},id:function(n){var r;switch(!0){case n===s:r="abaaso";break;case n===e:r="window";break;case n===!i&&t:r="document";break;case n===!i&&t.body:r="body";break;default:r=typeof n.id!="undefined"?n.id:typeof n.toString=="function"?n.toString():n}return r},fire:function(e,t){e=O.object(e);if(e instanceof Array)return e.each(function(n){C.fire(e[n],t,p.cast(arguments).remove(1).remove(0))});var n=C.id(e),r=p.cast(arguments).remove(1).remove(0),i=s.state.current,o=f.observer.log||s.observer.log,u,a,l;if(typeof n=="undefined"||String(n).isEmpty()||typeof e=="undefined"||typeof t=="undefined")throw Error(S.error.invalidArguments);return t.explode().each(function(t){o&&O.log(n+" firing "+t),l=C.list(e,t),a=l.all,typeof a!="undefined"&&O.iterate(a,function(e,t){e.fn.apply(e.scope,r)}),i!=="all"&&(a=l[i],typeof a!="undefined"&&O.iterate(a,function(e,t){e.fn.apply(e.scope,r)}))}),e},hook:function(e){return e.fire=function(){return C.fire.apply(C,[this].concat(p.cast(arguments))),this},e.listeners=function(e){return f.listeners.call(this,e)},e.on=function(e,t,n,r,i){return f.on.call(this,e,t,n,r,i)},e.once=function(e,t,n,r,i){return f.once.call(this,e,t,n,r,i)},e.un=function(e,t){return f.un.call(this,e,t)},e},list:function(e,t){e=O.object(e);var n=C.listeners,r=C.id(e),i;switch(!0){case typeof n[r]=="undefined"&&typeof t=="undefined":i={};break;case typeof n[r]!="undefined"&&(typeof t=="undefined"||String(t).isEmpty()):i=n[r];break;case typeof n[r]!="undefined"&&typeof n[r][t]!="undefined":i=n[r][t];break;default:i={}}return i},once:function(e,t,n,r,i,o){var u=r||O.genId();e=O.object(e),i=i||s,o=o||s.state.current;if(typeof e=="undefined"||t===null||typeof t=="undefined"||typeof n!="function")throw Error(S.error.invalidArguments);return e instanceof Array?e.each(function(e){C.once(e,t,n,r,i,o)}):(C.add(e,t,function(){C.remove(e,t,u,o),n.apply(i,arguments)},u,i,o),e)},remove:function(e,t,n,r){e=O.object(e),r=r||s.state.current;if(e instanceof Array)return e.each(function(e){C.remove(e,t,n,r)});var i=null,o=C.listeners,u=C.id(e);switch(!0){case typeof u=="undefined":case typeof o[u]=="undefined":return e}return typeof t=="undefined"||t===null?delete o[u]:t.explode().each(function(t){if(typeof o[u][t]=="undefined")return e;typeof n=="undefined"?o[u][t][r]={}:delete o[u][t][r][n]}),e}},k={state:{broken:"failed",initial:"unfulfilled",resolved:"fulfilled"},methods:{fail:function(e){return k.vouch.call(this,k.state.broken,e)},reject:function(e){return k.resolve.call(this,k.state.broken,e)},resolve:function(e){return k.resolve.call(this,k.state.resolved,e)},resolved:function(){return this.state===k.state.broken||this.state===k.state.resolved},status:function(){return this.state},then:function(e,t){var n=this,r=k.factory(),i;return i=function(i){var s=i?e:t,o;try{if(typeof s!="function")throw n.outcome;o=s(n.outcome),!i&&typeof r.fulfilled=="function"&&(n.state=k.state.resolved)}catch(u){o=u.message||u,n.state=k.state.broken}finally{typeof o!="undefined"&&(n.outcome=o);switch(!0){case r.fulfilled===null&&r.error===null:o=n;break;case n.state===k.state.resolved&&r.fulfilled!==null:o=r.resolve(n.outcome);break;case n.state===k.state.broken&&r.error!==null:o=r.reject(n.outcome)}}return n.state=o.state,n.outcome=o.outcome,n.outcome},k.vouch.call(this,k.state.resolved,function(){i(!0)}),typeof t=="function"&&this.fail(function(){i(!1)}),r}},factory:function(){var e={},t={};return t={error:null,fulfilled:null,outcome:null,state:k.state.initial},e=O.extend(k.methods,t),e},resolve:function(e,t){var n=e===k.state.resolved?"fulfilled":"error";if(this.state!==k.state.initial)throw Error(S.error.promiseResolved.replace("{{outcome}}",this.outcome));return this.state=e,this.outcome=t,this[n](t),this.error=null,this.fulfilled=null,typeof Object.freeze=="function"&&Object.freeze(this),this},vouch:function(e,t){if(String(e).isEmpty())throw Error(S.error.invalidArguments);switch(this.state){case k.state.initial:this[e===k.state.resolved?"fulfilled":"error"]=t;break;case e:t(this.outcome)}return this}},L={bang:/\#|\!\//g,nget:/^(head|options)$/i,methods:/^(all|delete|get|put|post|head|options)$/i,regex:new RegExp,routes:{all:{all:{error:function(){if(!!i)throw Error(S.error.invalidRoute);if(L.hash()==="")return history.go(-1);O.error(S.error.invalidRoute),s.route.initial!==null&&L.hash(s.route.initial)}},"delete":{},get:{},put:{},post:{}}},method:function(e){return L.methods.test(e)?e.toLowerCase():"all"},del:function(e,t,n){typeof n=="undefined"&&(n="all"),t=L.method(t);var r=e==="error";if(r&&t!=="all"||!r&&L.routes[n][t].hasOwnProperty(e))return s.route.initial===e&&(s.route.initial=null),delete L.routes[n][t][e];throw Error(S.error.invalidArguments)},hash:function(e){var n="";switch(!0){case i:break;case typeof e=="undefined":n=t.location.hash.replace(L.bang,"");break;default:n=e.replace(L.bang,""),t.location.hash="!/"+n}return n},hostname:function(e){return L.routes.hasOwnProperty(e)||(L.routes[e]={all:{},"delete":{},get:{},post:{},put:{}}),L.routes[e]},init:function(){var e=t.location.hash;return e.isEmpty()?L.hash(s.route.initial!==null?s.route.initial:p.cast(L.routes.all.all,!0).remove("error").first()):L.load(e),e.replace(L.bang,"")},list:function(e,t){typeof t=="undefined"&&(t="all");var n;switch(!0){case!i:n=p.cast(L.routes.all.all,!0);break;case typeof e!="undefined"&&L.routes.hasOwnProperty(t):n=p.cast(L.routes[t][L.method(e)],!0);break;default:n=[],L.routes.hasOwnProperty(t)&&O.iterate(L.routes[t],function(e,t){n[t]=[],O.iterate(e,function(e,r){n[t].push(r)})})}return!i&&t!=="all"&&O.iterate(L.routes.all,function(e,t){typeof n[t]=="undefined"&&(n[t]=[]),O.iterate(e,function(e,r){n[t].push(r)})}),n},load:function(e,t,n,r){typeof n=="undefined"&&(n="all"),typeof r=="undefined"&&(r="all");var i="",s="",o=!0,u=L.method(n.method||n),a,f;return L.nget.test(u)&&(u="get"),e=e.replace(L.bang,""),a=function(e,t,n){switch(!0){case typeof L.routes[e][t][n]!="undefined":i=n,s=t;break;case t!=="all"&&typeof L.routes[e].all[n]!="undefined":i=n,s="all";break;default:O.iterate(L.routes[e][t],function(e,r){return f(r,t,n)}),i.isEmpty()&&t!=="all"&&O.iterate(L.routes[e].all,function(e,t){return f(t,"all",n)})}},f=function(e,t,n){if(O.compile(L.regex,"^"+e+"$","i")&&L.regex.test(n))return i=e,s=t,!1},r!=="all"&&!L.routes.hasOwnProperty(r)&&(r="all"),a(r,u,e),i.isEmpty()&&(r!=="all"&&a("all",u,e),i.isEmpty()&&(r="all",i="error",s="all",o=!1)),L.routes[r][s][i](t||i,n),o},server:function(e,t,n){var r=require("url"),a,l,h;e=e||{},n=n===!0||e.port===443,a=function(e,t){var n=r.parse(e.url),i=e.headers.host.replace(/:.*/,"");L.load(n.pathname,t,e,i)},l=function(e){c(e,this,arguments),typeof t=="function"&&t(e)};if(!i)throw Error(S.error.notSupported);return f.route.enabled=s.route.enabled=!0,e.host=e.host||undefined,e.port=parseInt(e.port)||8e3,h=n?u.createServer(e,a).on("error",l).listen(e.port):o.createServer(a).on("error",l).listen(e.port,e.host),h},set:function(e,t,n,r){r=i?r||"all":"all",n=i?L.method(n):"all";if(typeof e!="string"||e.isEmpty()||typeof t!="function")throw Error(S.error.invalidArguments);return L.hostname(r)[n][e]=t,!0}},A={capitalize:function(e){return e=A.trim(e),e.charAt(0).toUpperCase()+e.slice(1)},escape:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},explode:function(e,t){if(typeof t=="undefined"||t.toString()==="")t=",";return A.trim(e).split(new RegExp("\\s*"+t+"\\s*"))},hyphenate:function(e,t){var n;return t=t===!0,n=A.trim(e).replace(/\s+/g,"-"),t&&(n=n.replace(/([A-Z])/g,"-$1").toLowerCase()),n},singular:function(e){return/s$/.test(e)?e.slice(0,-1):e},toCamelCase:function(e){var t=A.trim(e).toLowerCase().split(/\s|-/),n=[];return t.each(function(e,t){e=A.trim(e);if(e.isEmpty())return;n.push(t===0?e:A.capitalize(e))}),n.join("")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},uncapitalize:function(e){return e=A.trim(e),e.charAt(0).toLowerCase()+e.slice(1)}},O={timer:{},$:function(e,n){var r=[],s=[],o,u;if(i||String(e).indexOf("?")>-1)return undefined;e=e.trim(),n=n===!0,e.indexOf(",")>-1&&(e=e.explode());if(e instanceof Array)return e.each(function(e){s.push(f(e,n))}),s.each(function(e){r=r.concat(e)}),r;switch(!0){case/\s|>/.test(e):u=e.split(" ").filter(function(e){if(e.trim()!==""&&e!==">")return!0}).last(),o=t[u.indexOf("#")>-1&&u.indexOf(":")===-1?"querySelector":"querySelectorAll"](e);break;case e.indexOf("#")===0&&e.indexOf(":")===-1:o=isNaN(e.charAt(1))?t.querySelector(e):t.getElementById(e.substring(1));break;case e.indexOf("#")>-1&&e.indexOf(":")===-1:o=t.querySelector(e);break;default:o=t.querySelectorAll(e)}return typeof o!="undefined"&&o!==null&&!(o instanceof Element)&&!n&&(o=p.cast(o)),o===null&&(o=undefined),o},alias:function(e,t){var n=e,r=t;return O.iterate(r,function(e,t){var i,s;switch(!0){case!(e instanceof RegExp)&&typeof e=="function":n[t]=e.bind(n[t]);break;case!(e instanceof RegExp)&&!(e instanceof Array)&&e instanceof Object:typeof n[t]=="undefined"&&(n[t]={}),O.alias(n[t],r[t]);break;default:i=function(){return r[t]},s=function(e){r[t]=e},O.property(n,t,{enumerable:!0,get:i,set:s,value:r[t]})}}),e},clearTimers:function(e){if(typeof e=="undefined"||String(e).isEmpty())throw Error(S.error.invalidArguments);typeof O.timer[e]!="undefined"&&(clearTimeout(O.timer[e]),delete O.timer[e]),typeof f.repeating[e]!="undefined"&&(clearTimeout(f.repeating[e]),delete f.repeating[e])},clone:function(e){var t;switch(!0){case e instanceof Array:return[].concat(e);case typeof e=="boolean":return Boolean(e);case typeof e=="function":return e;case typeof e=="number":return Number(e);case typeof e=="string":return String(e);case!v.ie&&!i&&e instanceof Document:return D.decode(D.encode(e));case e instanceof Object:return t=E.decode(E.encode(e)),typeof t!="undefined"&&(e.hasOwnProperty("constructor")&&(t.constructor=e.constructor),e.hasOwnProperty("prototype")&&(t.prototype=e.prototype)),t;default:return e}},coerce:function(e){var t=O.clone(e),n;switch(!0){case/^\d$/.test(t):t=N.parse(t);break;case/^(true|false)$/i.test(t):t=/true/i.test(t);break;case t==="undefined":t=undefined;break;case t==="null":t=null;break;case(n=E.decode(t,!0))&&typeof n!="undefined":t=n}return t},compile:function(e,t,n){return e.compile(t,n),!0},css:function(e,n){var r,i;return r=f("head")[0].create("style",{type:"text/css",media:n||"print, screen"}),r.styleSheet?r.styleSheet.cssText=e:(i=t.createTextNode(e),r.appendChild(i)),r},define:function(e,t,n){var r=n,i=e.length;return e=e.split("."),typeof n=="undefined"&&(n=this),typeof t=="undefined"&&(t=null),n===f&&(n=s),e.each(function(n,s){var o=s+1<i&&!isNaN(parseInt(e[s+1])),u=t;isNaN(parseInt(n))||(n=parseInt(n));switch(!0){case typeof r[n]=="undefined":r[n]=o?[]:{};break;case r[n]instanceof Object&&o:r[n]=p.cast(r[n]);break;case r[n]instanceof Object:break;case r[n]instanceof Array&&!o:r[n]=r[n].toObject();break;default:r[n]={}}s+1===i?r[n]=u:r=r[n]}),n},defer:function(e,t,n){var r;return t=t||10,n=n||O.guid(!0),r=function(){delete O.timer[n],e()},O.timer[n]=setTimeout(r,t),undefined},domId:function(e){return"a"+e.replace(/-/g,"").slice(1)},error:function(e,t,n,r){var i;return typeof e!="undefined"&&(r=r===!0,i={arguments:t,message:typeof e.message!="undefined"?e.message:e,number:typeof e.number!="undefined"?e.number&65535:undefined,scope:n,stack:typeof e.stack=="string"?e.stack:undefined,timestamp:(new Date).toUTCString(),type:typeof e.type!="undefined"?e.type:"TypeError"},typeof console!="undefined"&&(console[r?"warn":"error"](i.message),typeof i.stack!="undefined"&&console[r?"warn":"error"](i.stack)),f.error.log.push(i),f.fire("error",i)),undefined},extend:function(e,t){var n,r;if(typeof e=="undefined")throw Error(S.error.invalidArguments);typeof t=="undefined"&&(t={});switch(!0){case typeof Object.create=="function":n=Object.create(e);break;default:r=function(){},r.prototype=e,n=new r}return O.merge(n,t),n},genId:function(e){var t;if(typeof e!="undefined")switch(!0){case typeof e.id!="undefined"&&e.id!=="":case e instanceof Array:case e instanceof String||typeof e=="string":return e}do t=O.domId(O.guid(!0));while(typeof f("#"+t)!="undefined");return typeof e=="object"?(e.id=t,e):t},guid:function(e){var t=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},n=[8,9,"a","b"],r;return e=e===!0,r=(t()+t()+"-"+t()+"-4"+t().substr(0,3)+"-"+n[Math.floor(Math.random()*n.length)]+t().substr(0,3)+"-"+t()+t()+t()).toLowerCase(),e&&(r=r.replace(/-/gi,"")),r},iterate:function(e,t){var n=Object.prototype.hasOwnProperty,r,i;if(typeof t!="function")throw Error(S.error.invalidArguments);for(r in e)if(n.call(e,r)){i=t.call(e,e[r],r);if(i===!1)break}return e},loading:function(e){var t=s.loading;e=O.object(e);if(e instanceof Array)return e.each(function(e){O.loading(e)});if(t.url===null)throw Error(S.error.elementNotFound);if(typeof e=="undefined")throw Error(S.error.invalidArguments);return typeof t.image=="undefined"&&(t.image=new Image,t.image.src=t.url),e.clear(),e.create("div",{"class":"loading"}).create("img",{alt:S.common.loading,src:t.image.src}),e},log:function(e){var t=!i||typeof e!="object";try{console.log((t?"["+(new Date).toLocaleTimeString()+"] ":"")+e)}catch(n){c(n,arguments,this)}return undefined},merge:function(e,t){return O.iterate(t,function(t,n){e[n]=O.clone(t)}),e},module:function(e,t){if(typeof f[e]!="undefined"||typeof s[e]!="undefined"||!t instanceof Object)throw Error(S.error.invalidArguments);return s[e]=t,typeof t=="function"?f[e]=!v.ie||v.version>8?s[e].bind(f[e]):s[e]:(f[e]={},O.alias(f[e],s[e])),f[e]},object:function(e){return typeof e=="object"?e:e.toString().charAt(0)==="#"?f(e):e},parse:function(e){var r=t.createElement("a"),i={};return r.href=e,i={protocol:r.protocol,hostname:r.hostname,port:String(r.port).isEmpty()?"":parseInt(r.port),pathname:r.pathname,search:r.search,hash:r.hash,host:r.host},v.ie&&(i.protocol===":"&&(i.protocol=n.protocol),i.hostname.isEmpty()&&(i.hostname=n.hostname),i.host.isEmpty()&&(i.host=n.host),i.pathname.charAt(0)!=="/"&&(i.pathname="/"+i.pathname)),i},property:function(e,t,n){var r;if(n instanceof Object){if(i&&e.hasOwnProperty(t))return;return r=(!v.ie||v.version>8)&&typeof Object.defineProperty=="function",r&&typeof n.value!="undefined"&&typeof n.get!="undefined"&&delete n.value,r?Object.defineProperty(e,t,n):e[t]=n.value,e}throw Error(S.error.invalidArguments)},proto:function(e,t){var n,r={array:{add:function(e){return p.add(this,e)},addClass:function(e){return this.each(function(t){t.addClass(e)})},after:function(e,t){var n=[];return this.each(function(r){n.push(r.after(e,t))}),n},append:function(e,t){var n=[];return this.each(function(r){n.push(r.append(e,t))}),n},attr:function(e,t){var n=[];return this.each(function(r){n.push(r.attr(e,t))}),n},before:function(e,t){var n=[];return this.each(function(r){n.push(r.before(e,t))}),n},clear:function(e){return this.each(function(e){e.clear()})},clone:function(){return O.clone(this)},contains:function(e){return p.contains(this,e)},create:function(e,t,n){var r=[];return this.each(function(i){r.push(i.create(e,t,n))}),r},css:function(e,t){return this.each(function(n){n.css(e,t)})},data:function(e,t){var n=[];return this.each(function(r){n.push(r.data(e,t))}),n},diff:function(e){return p.diff(this,e)},disable:function(){return this.each(function(e){e.disable()})},destroy:function(){return this.each(function(e){e.destroy()}),[]},each:function(e){return p.each(this,e)},enable:function(){return this.each(function(e){e.enable()})},find:function(e){var t=[];return this.each(function(n){n.find(e).each(function(e){t.contains(e)||t.push(e)})}),t},fire:function(){var e=arguments;return this.each(function(t){t.fire.apply(t,e)})},first:function(){return p.first(this)},get:function(e,t){return this.each(function(n){n.get(e,t)}),[]},has:function(e){var t=[];return this.each(function(n){t.push(n.has(e))}),t},hasClass:function(e){var t=[];return this.each(function(n){t.push(n.hasClass(e))}),t},hide:function(){return this.each(function(e){e.hide()})},html:function(e){if(typeof e!="undefined")return this.each(function(t){t.html(e)});var t=[];return this.each(function(e){t.push(e.html())}),t},index:function(e){return p.index(this,e)},indexed:function(){return p.indexed(this)},intersect:function(e){return p.intersect(this,e)},is:function(e){var t=[];return this.each(function(n){t.push(n.is(e))}),t},isAlphaNum:function(){var e=[];return this.each(function(t){e.push(t.isAlphaNum())}),e},isBoolean:function(){var e=[];return this.each(function(t){e.push(t.isBoolean())}),e},isChecked:function(){var e=[];return this.each(function(t){e.push(t.isChecked())}),e},isDate:function(){var e=[];return this.each(function(t){e.push(t.isDate())}),e},isDisabled:function(){var e=[];return this.each(function(t){e.push(t.isDisabled())}),e},isDomain:function(){var e=[];return this.each(function(t){e.push(t.isDomain())}),e},isEmail:function(){var e=[];return this.each(function(t){e.push(t.isEmail())}),e},isEmpty:function(){var e=[];return this.each(function(t){e.push(t.isEmpty())}),e},isHidden:function(){var e=[];return this.each(function(t){e.push(t.isHidden())}),e},isIP:function(){var e=[];return this.each(function(t){e.push(t.isIP())}),e},isInt:function(){var e=[];return this.each(function(t){e.push(t.isInt())}),e},isNumber:function(){var e=[];return this.each(function(t){e.push(t.isNumber())}),e},isPhone:function(){var e=[];return this.each(function(t){e.push(t.isPhone())}),e},isUrl:function(){var e=[];return this.each(function(t){e.push(t.isUrl())}),e},keys:function(){return p.keys(this)},last:function(e){return p.last(this)},listeners:function(e){var t=[];return this.each(function(n){t=t.concat(n.listeners(e))}),t},loading:function(){return this.each(function(e){e.loading()})},max:function(){return p.max(this)},min:function(){return p.min(this)},on:function(e,t,n,r,i){return this.each(function(s){s.on(e,t,n,typeof r!="undefined"?r:s,i)})},once:function(e,t,n,r,i){return this.each(function(s){s.once(e,t,n,typeof r!="undefined"?r:s,i)})},position:function(){var e=[];return this.each(function(t){e.push(t.position())}),e},prepend:function(e,t){var n=[];return this.each(function(r){n.push(r.prepend(e,t))}),n},range:function(e,t){return p.range(this,e,t)},remove:function(e,t){return p.remove(this,e,t)},removeClass:function(e){return this.each(function(t){t.removeClass(e)})},show:function(){return this.each(function(e){e.show()})},size:function(){var e=[];return this.each(function(t){e.push(t.size())}),e},sum:function(){return p.sum(this)},text:function(e){return this.each(function(t){typeof t!="object"&&(t=O.object(t)),typeof t.text=="function"&&t.text(e)})},tpl:function(e){return this.each(function(t){t.tpl(e)})},toggleClass:function(e){return this.each(function(t){t.toggleClass(e)})},total:function(){return p.total(this)},toObject:function(){return p.toObject(this)},un:function(e,t,n){return this.each(function(r){r.un(e,t,n)})},update:function(e){return this.each(function(t){b.update(t,e)})},val:function(e){var t=[],n=null,r=!0;return this.each(function(i){n!==null&&(r=n===i.type),n=i.type,typeof i.val=="function"&&t.push(i.val(e))}),r?t[0]:t},validate:function(){var e=[];return this.each(function(t){e.push(t.validate())}),e}},element:{addClass:function(e){return O.genId(this),b.klass(this,e,!0)},after:function(e,t){return O.genId(this),b.create(e,t,this,"after")},append:function(e,t){return O.genId(this),b.create(e,t,this,"last")},attr:function(e,t){return O.genId(this),b.attr(this,e,t)},before:function(e,t){return O.genId(this),b.create(e,t,this,"before")},clear:function(){return O.genId(this),b.clear(this)},create:function(e,t,n){return O.genId(this),b.create(e,t,this,n)},css:function(e,t){return O.genId(this),b.css(this,e,t)},data:function(e,t){return O.genId(this),b.data(this,e,t)},destroy:function(){return b.destroy(this)},disable:function(){return b.disable(this)},enable:function(){return b.enable(this)},find:function(e){return O.genId(this),b.find(this,e)},fire:function(){return O.genId(this),C.fire.apply(C,[this].concat(p.cast(arguments))),this},genId:function(){return O.genId(this)},get:function(e,t){this.fire("beforeGet");var n=d.get(e),r=this;return n?this.html(n.response).fire("afterGet"):e.get(function(e){r.html(e).fire("afterGet")},function(e){r.fire("failedGet",{response:v.parse(e),xhr:e})},t),this},has:function(e){return O.genId(this),b.has(this,e)},hasClass:function(e){return O.genId(this),b.hasClass(this,e)},hide:function(){return O.genId(this),b.hide(this)},html:function(e){return O.genId(this),typeof e=="undefined"?this.innerHTML:this.update({innerHTML:e})},is:function(e){return O.genId(this),b.is(this,e)},isAlphaNum:function(){return this.nodeName==="FORM"?!1:M.test({alphanum:typeof this.value!="undefined"?this.value:b.text(this)}).pass},isBoolean:function(){return this.nodeName==="FORM"?!1:M.test({"boolean":typeof this.value!="undefined"?this.value:b.text(this)}).pass},isChecked:function(){return this.nodeName!=="INPUT"?!1:this.attr("checked")},isDate:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isDate():b.text(this).isDate()},isDisabled:function(){return this.nodeName!=="INPUT"?!1:this.attr("disabled")},isDomain:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isDomain():b.text(this).isDomain()},isEmail:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isEmail():b.text(this).isEmail()},isEmpty:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isEmpty():b.text(this).isEmpty()},isHidden:function(e){return O.genId(this),b.hidden(this)},isIP:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isIP():b.text(this).isIP()},isInt:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isInt():b.text(this).isInt()},isNumber:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isNumber():b.text(this).isNumber()},isPhone:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isPhone():b.text(this).isPhone()},isUrl:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isUrl():b.text(this).isUrl()},jsonp:function(e,t,n){var r=this,i=t,s;return s=function(e){var t=r,n=e,s=i,o,u,a;try{typeof s!="undefined"?(s=s.replace(/]|'|"/g,"").replace(/\./g,"[").split("["),s.each(function(e){n=n[isNaN(e)?e:parseInt(e)];if(typeof n=="undefined")throw Error(S.error.propertyNotFound)}),a=n):a=e}catch(f){a=S.error.serverError,c(f,arguments,this)}t.text(a)},v.jsonp(e,s,function(){r.text(S.error.serverError)},n),this},listeners:function(e){return O.genId(this),f.listeners.call(this,e)},loading:function(){return O.loading(this)},on:function(e,t,n,r,i){return O.genId(this),f.on.call(this,e,t,n,r,i)},once:function(e,t,n,r,i){return O.genId(this),f.once.call(this,e,t,n,r,i)},prepend:function(e,t){return O.genId(this),b.create(e,t,this,"first")},prependChild:function(e){return O.genId(this),b.prependChild(this,e)},position:function(){return O.genId(this),b.position(this)},removeClass:function(e){return O.genId(this),b.klass(this,e,!1)},show:function(){return O.genId(this),b.show(this)},size:function(){return O.genId(this),b.size(this)},text:function(e){return O.genId(this),b.text(this,e)},toggleClass:function(e){return O.genId(this),b.toggleClass(this,e)},tpl:function(e){return O.tpl(e,this)},un:function(e,t,n){return O.genId(this),f.un.call(this,e,t,n)},update:function(e){return O.genId(this),b.update(this,e)},val:function(e){return O.genId(this),b.val(this,e)},validate:function(){return this.nodeName==="FORM"?M.test(this):typeof this.value!="undefined"?!this.value.isEmpty():!b.text(this).isEmpty()}},"function":{reflect:function(){return O.reflect(this)}},number:{diff:function(e){return N.diff(this,e)},fire:function(){return C.fire.apply(C,[this.toString()].concat(p.cast(arguments)))},format:function(e,t){return N.format(this,e,t)},half:function(e){return N.half(this,e)},isEven:function(){return N.even(this)},isOdd:function(){return N.odd(this)},listeners:function(e){return f.listeners.call(this.toString(),e)},on:function(e,t,n,r,i){return f.on.call(this.toString(),e,t,n,r||this,i),this},once:function(e,t,n,r,i){return f.once.call(this.toString(),e,t,n,r||this,i),this},roundDown:function(){return N.round(this,"down")},roundUp:function(){return N.round(this,"up")},un:function(e,t,n){return f.un.call(this.toString(),e,t,n),this}},string:{allows:function(e){return v.allows(this,e)},capitalize:function(){return A.capitalize(this)},del:function(e,t,n){return v.request(this,"DELETE",e,t,null,n)},escape:function(){return A.escape(this)},expire:function(e){return d.expire(this,e)},explode:function(e){return A.explode(this,e)},fire:function(){return C.fire.apply(C,[this].concat(p.cast(arguments)))},get:function(e,t,n){return v.request(this,"GET",e,t,null,n)},headers:function(e,t){return v.request(this,"HEAD",e,t)},hyphenate:function(e){return A.hyphenate(this,e)},isAlphaNum:function(){return M.test({alphanum:this}).pass},isBoolean:function(){return M.test({"boolean":this}).pass},isDate:function(){return M.test({date:this}).pass},isDomain:function(){return M.test({domain:this}).pass},isEmail:function(){return M.test({email:this}).pass},isEmpty:function(){return A.trim(this)===""},isIP:function(){return M.test({ip:this}).pass},isInt:function(){return M.test({integer:this}).pass},isNumber:function(){return M.test({number:this}).pass},isPhone:function(){return M.test({phone:this}).pass},isUrl:function(){return M.test({url:this}).pass},jsonp:function(e,t,n){return v.jsonp(this,e,t,n)},listeners:function(e){return f.listeners.call(this,e)},post:function(e,t,n,r){return v.request(this,"POST",e,t,n,r)},put:function(e,t,n,r){return v.request(this,"PUT",e,t,n,r)},on:function(e,t,n,r,i){return f.on.call(this,e,t,n,r,i)},once:function(e,t,n,r,i){return f.once.call(this,e,t,n,r,i)},options:function(e,t){return v.request(this,"OPTIONS",e,t)},permissions:function(){return v.permissions(this)},singular:function(){return A.singular(this)},toCamelCase:function(){return A.toCamelCase(this)},toNumber:function(){return N.parse(this)},trim:function(){return A.trim(this)},un:function(e,t,n){return f.un.call(this,e,t,n)},uncapitalize:function(){return A.uncapitalize(this)}}};return O.iterate(r[t],function(t,n){O.property(e.prototype,n,{value:t})}),e},queryString:function(e){var t={},r=n.search.isEmpty()?null:n.search.replace("?",""),i;return e=e||".*",r!==null&&(r=r.split("&"),r.each(function(e){i=e.split("=");if(i[0].isEmpty())return;switch(!0){case typeof i[1]=="undefined":case i[1].isEmpty():i[1]="";break;case i[1].isNumber():i[1]=Number(i[1]);break;case i[1].isBoolean():i[1]=i[1]==="true"}switch(!0){case typeof t[i[0]]=="undefined":t[i[0]]=i[1];break;case!(t[i[0]]instanceof Array):t[i[0]]=[t[i[0]]];default:t[i[0]].push(i[1])}})),t},reflect:function(e){return typeof e=="undefined"&&(e=this),typeof e=="undefined"&&(e=f),e=e.toString().match(/function\s+\w*\s*\((.*?)\)/)[1],e!==""?e.explode():[]},repeat:function(e,t,n){return t=t||10,n=n||O.guid(!0),O.defer(function(){var r=function(e,t,n){var r=this;e()!==!1?f.repeating[n]=setTimeout(function(){r.call(r,e,t,n)},t):delete f.repeating[n]};r.call(r,e,t,n)},t,n),n},script:function(e,t,n){return b.create("script",{type:"application/javascript",src:e},t||f("head")[0],n)},stylesheet:function(e,t){return b.create("link",{rel:"stylesheet",type:"text/css",href:e,media:t||"print, screen"},f("head")[0])},stop:function(e){return typeof e.cancelBubble!="undefined"&&(e.cancelBubble=!0),typeof e.preventDefault=="function"&&e.preventDefault(),typeof e.stopPropagation=="function"&&e.stopPropagation(),e},tpl:function(e,n){var r;switch(!0){case typeof e!="object":case!/object|undefined/.test(typeof n)&&typeof (n=n.charAt(0)==="#"?f(n):f(n)[0])=="undefined":throw Error(S.error.invalidArguments)}typeof n=="undefined"&&(n=f("body")[0]),r=t.createDocumentFragment();switch(!0){case e instanceof Array:e.each(function(e,t){b.create(p.cast(e,!0)[0],r).html(p.cast(e)[0])});break;default:O.iterate(e,function(e,t){switch(!0){case typeof e=="string":b.create(t,r).html(e);break;case e instanceof Array:case e instanceof Object:O.tpl(e,b.create(t,r))}})}return n.appendChild(r),p.last(n.childNodes)},walk:function(e,t){return t.replace(/\]$/,"").replace(/\]/g,".").split(/\.|\[/).each(function(t){e=e[t]}),e}},M={pattern:{alphanum:/^[a-zA-Z0-9]+$/,"boolean":/^(0|1|true|false)?$/,domain:/^[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/,email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,integer:/(^-?\d\d*$)/,notEmpty:/\w{1,}/,number:/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/,phone:/^([0-9\(\)\/\+ \-\.]+)$/,url:/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i},test:function(e){var t=!1,n=[],r={},i=null,s=[],o=[],u=[],a=[],l,c,h,p,d;return typeof e.nodeName!="undefined"&&e.nodeName==="FORM"?(e.id.isEmpty()&&e.genId(),u=f("#"+e.id+" input"),a=f("#"+e.id+" select"),u.length>0&&(o=o.concat(u)),a.length>0&&(o=o.concat(a)),o.each(function(e){var r={},i,s,o;i=M.pattern[e.nodeName.toLowerCase()]?M.pattern[e.nodeName.toLowerCase()]:!e.id.isEmpty()&&M.pattern[e.id.toLowerCase()]?M.pattern[e.id.toLowerCase()]:"notEmpty",s=e.val(),s===null&&(s=""),r[i]=s,o=M.test(r),o.pass||(n.push({element:e,test:i,value:s}),t=!0)})):O.iterate(e,function(e,r){if(typeof r=="undefined"||typeof e=="undefined"){n.push({test:r,value:e}),t=!0;return}i=String(e).charAt(0)==="#"?typeof f(e)!="undefined"?f(e).val():"":e;switch(r){case"date":isNaN((new Date(i)).getYear())&&(n.push({test:r,value:i}),t=!0);break;case"domain":M.pattern.domain.test(i.replace(/.*\/\//,""))||(n.push({test:r,value:i}),t=!0);break;case"domainip":if(!M.pattern.domain.test(i.replace(/.*\/\//,""))||!M.pattern.ip.test(i))n.push({test:r,value:i}),t=!0;break;default:c=typeof M.pattern[r]!="undefined"?M.pattern[r]:r,c.test(i)||(n.push({test:r,value:i}),t=!0)}}),{pass:!t,invalid:n}}},_=function(){var e=0,t=1,n=2,r=3,i=4,s=RegExp(n+"|"+r),f,l,c,h,p;return l={"User-Agent":"abaaso/3.1.0 node.js/"+process.versions.node.replace(/^v/,"")+" ("+A.capitalize(process.platform)+" V8/"+process.versions.v8+")","Content-Type":"text/plain",Accept:"*/*"},p=function(e){return this.readyState!==e&&(this.readyState=e,this.dispatchEvent("readystatechange"),this.readyState===i&&!this._error&&(this.dispatchEvent("load"),this.dispatchEvent("loadend"))),this},c=function(e){var t=this;p.call(this,n),this.status=e.statusCode,this._resheaders=e.headers,typeof this._resheaders["set-cookie"]!="undefined"&&this._resheaders["set-cookie"]instanceof Array&&(this._resheaders["set-cookie"]=this._resheaders["set-cookie"].join(";")),e.on("data",function(n){e.setEncoding("utf8"),t._send&&(n&&(t.responseText+=n),p.call(t,r))}),e.on("end",function(){t._send&&(p.call(t,i),t._send=!1)}),e.on("close",function(e){h.call(t,e)})},h=function(e){this.status=503,this.statusText=e,this.responseText=e.stack||e,this._error=!0,this.dispatchEvent("error"),p.call(this,i)},f=function(){this.onabort=null,this.onerror=null,this.onload=null,this.onloadend=null,this.onloadstart=null,this.onreadystatechange=null,this.readyState=e,this.response=null,this.responseText="",this.responseType="",this.responseXML=null,this.status=e,this.statusText="",this._id=O.genId(),this._error=!1,this._headers={},this._listeners={},this._params={},this._request=null,this._resheaders={},this._send=!1},f.prototype.abort=function(){this._request!==null&&(this._request.abort(),this._request=null),this.responseText="",this.responseXML="",this._error=!0,this._headers={};if(this._send===!0||s.test(this.readyState))this._send=!1,p.call(this,i);return this.dispatchEvent("abort"),this.readyState=e,this},f.prototype.addEventListener=function(e,t){return this._listeners.hasOwnProperty(e)||(this._listeners[e]=[]),this._listeners[e].add(t),this},f.prototype.dispatchEvent=function(e){var t=this;return typeof this["on"+e]=="function"&&this["on"+e](),this._listeners.hasOwnProperty(e)&&this._listeners[e].each(function(e){typeof e=="function"&&e.call(t)}),this},f.prototype.getAllResponseHeaders=function(){var e="";if(this.readyState<n||this._error)throw Error("INVALID_STATE_ERR: Headers have not been received");return O.iterate(this._resheaders,function(t,n){e+=n+": "+t+"\n"}),e},f.prototype.getResponseHeader=function(e){var t;if(this.readyState<n||this._error)throw Error("INVALID_STATE_ERR: Headers have not been received");return t=this._resheaders[e]||this._resheaders[e.toLowerCase()],t},f.prototype.open=function(e,n,r,i,s){var o=this;if(typeof r!="undefined"&&r!==!0)throw Error("Synchronous XMLHttpRequest requests are not supported");return this.abort(),this._error=!1,this._params={method:e,url:n,async:r||!0,user:i||null,password:s||null},O.iterate(l,function(e,t){o._headers[t]=e}),this.readyState=t,this},f.prototype.overrideMimeType=function(e){return this._headers["Content-Type"]=e,this},f.prototype.removeEventListener=function(e,t){if(!this._listeners.hasOwnProperty(e))return;return this._listeners[e].remove(t),this},f.prototype.send=function(e){e=e||null;var n=this,r,i,s,f;switch(!0){case this.readyState<t:throw Error("INVALID_STATE_ERR: Object is not open");case this._send:throw Error("INVALID_STATE_ERR: Object is sending")}return i=a.parse(this._params.url),i.port=i.port||(i.protocol==="https"?443:80),this._params.user!==null&&this._params.password!==null&&(i.auth=this._params.user+":"+this._params.password),/post|put/i.test(this._params.method)&&(this._headers["Content-Length"]=e!==null?Buffer.byteLength(e):0),this._headers.Host=i.hostname+(/80|443/.test(i.port)?"":":"+i.port),r={hostname:i.hostname,path:i.path,port:i.port,method:this._params.method,headers:this._headers},typeof i.auth!="undefined"&&(r.auth=i.auth),n._send=!0,n.dispatchEvent("readystatechange"),f=i.protocol==="http:"?o:u,s=f.request(r,function(e){c.call(n,e)}).on("error",function(e){h.call(n,e)}),e===null?s.setSocketKeepAlive(!0,1e4):s.write(e,"utf8"),this._request=s,s.end(),n.dispatchEvent("loadstart"),this},f.prototype.setRequestHeader=function(e,n){switch(!0){case this.readyState!==t:throw Error("INVALID_STATE_ERR: Object is not usable");case this._send:throw Error("INVALID_STATE_ERR: Object is sending")}return this._headers[e]=n,this},f},D={decode:function(e){try{var t;if(typeof e!="string"||e.isEmpty())throw Error(S.error.invalidArguments);return v.ie?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t}catch(n){return c(n,arguments,this),undefined}},encode:function(e,t){try{if(typeof e=="undefined")throw Error(S.error.invalidArguments);t=t!==!1;var n=t?"<xml>":"",r=arguments[2]!==!1,i,s;e!==null&&typeof e.xml!="undefined"&&(e=e.xml),e instanceof Document&&(e=(new XMLSerializer).serializeToString(e)),i=function(e,t){var n="<n>v</n>";return/\&|\<|\>|\"|\'|\t|\r|\n|\@|\$/g.test(t)&&(n=n.replace(/v/,"<![CDATA[v]]>")),n.replace(/n/g,e).replace(/v/,t)};switch(!0){case typeof e=="boolean":case typeof e=="number":case typeof e=="string":n+=i("item",e);break;case typeof e=="object":O.iterate(e,function(e,t){n+=D.encode(e,typeof e=="object",!1).replace(/item|xml/g,isNaN(t)?t:"item")})}return n+=t?"</xml>":"",r&&(n='<?xml version="1.0" encoding="UTF8"?>'+n),n}catch(o){return c(o,arguments,this),undefined}}};return c=O.error,l=function(){var r,o;typeof s.bootstrap=="function"&&delete s.bootstrap,s.client.size=v.size(),v.version(),v.mobile(),v.tablet();if(v.ie&&v.version<8)return;r=function(e){var t=[];C.remove(e),e.childNodes.length>0&&(t=p.cast(e.childNodes)),t.length>0&&t.each(function(e){r(e)})},o=function(e){if(/complete|loaded/.test(t.readyState))return typeof s.init=="function"&&s.init(),!1},typeof Array.prototype.filter=="undefined"&&(Array.prototype.filter=function(e){if(this===void 0||this===null||typeof e!="function")throw Error(S.error.invalidArguments);var t=null,n=Object(this),r=n.length>>>0,i=[],s=arguments[1],o=null;for(t=0;t<r;t++)t in n&&(o=n[t],e.call(s,o,t,n)&&i.push(o));return i}),typeof Array.prototype.forEach=="undefined"&&(Array.prototype.forEach=function(e,t){if(this===null||typeof e!="function")throw Error(S.error.invalidArguments);var n,r=0,i=Object(this),s=i.length>>>0;t&&(n=t);while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}}),typeof Array.prototype.indexOf=="undefined"&&(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1}),!i&&typeof t.documentElement.classList=="undefined"&&function(e){var t,n,r,i,s;if(!("HTMLElement"in e||"Element"in e))return;t=function(e){var t=e.className.isEmpty()?[]:e.className.explode(" "),n=this;t.each(function(e){n.push(e)}),this.updateClassName=function(){e.className=this.join(" ")}},n=function(){return new t(this)},r=t.prototype=[],i=(e.HTMLElement||e.Element).prototype,r.add=function(e){p.contains(this,e)||(this.push(e),this.updateClassName())},r.contains=function(e){return p.contains(this,e)},r.remove=function(e){p.contains(this,e)&&(p.remove(this,e),this.updateClassName())},r.toggle=function(e){p[p.contains(this,e)?"remove":"add"](this,e),this.updateClassName()};if(Object.defineProperty)s={get:n,enumerable:!v.ie||v.version>8?!0:!1,configurable:!0},Object.defineProperty(i,"classList",s);else{if(!Object.prototype.__defineGetter__)throw Error("Could not create classList shim");i.__defineGetter__("classList",n)}}(e),typeof Function.prototype.bind=="undefined"&&(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,r=n.call(arguments,1);return function(){return t.apply(e,r.concat(n.call(arguments)))}}),i&&(delete s.cookie,XMLHttpRequest=_()),f=s.$.bind(f),O.alias(f,s),delete f.$,delete f.bootstrap,delete f.callback,delete f.init,delete f.loading,s.route.initial=null,f.loading=s.loading.create.bind(f.loading),f.fire=s.fire,f.on=s.on,f.once=s.once,f.un=s.un,f.listeners=s.listeners,s.state._current=s.state.current="initial",f.state._current=f.state.current=s.state.current;if(!i)switch(!0){case typeof e.$=="undefined"||e.$===null:e.$=f;break;default:e.a$=f,s.aliased="a$"}O.proto(Array,"array"),typeof Element!="undefined"&&O.proto(Element,"element"),typeof HTMLDocument!="undefined"&&O.proto(HTMLDocument,"element"),O.proto(Function,"function"),O.proto(Number,"number"),O.proto(String,"string"),s.constructor=s,f.error.log=s.error.log=[],f.on(e,"error",function(e){f.fire("error",e)},"error",e,"all"),i||(f.on(e,"hashchange",function(){f.fire("beforeHash, hash, afterHash",n.hash)},"hash",e,"all"),f.on(e,"resize",function(){f.client.size=s.client.size=v.size(),f.fire("resize",s.client.size)},"resize",e,"all"),f.on(e,"load",function(){f.fire("render").un("render")}),f.on(e,"DOMNodeInserted",function(e){var t=e.target;typeof t.id!="undefined"&&t.id.isEmpty()&&(O.genId(t),t.parentNode instanceof Element&&t.parentNode.fire("afterCreate",t),f.fire("afterCreate",t))},"mutation",e,"all"),f.on(e,"DOMNodeRemoved",function(e){r(e.target)},"mutation",e,"all"),f.on("hash",function(e){(f.route.enabled||s.route.enabled)&&L.load(e)},"route",s.route,"all"));var u,a;u=function(){return this._current},a=function(e){if(e===null||typeof e!="string"||this.current===e||e.isEmpty())throw Error(S.error.invalidArguments);return s.state.previous=s.state._current,s.state._current=e,s.fire(e)};switch(!0){case!v.ie||v.version>8:O.property(s.state,"current",{enumerable:!0,get:u,set:a}),O.property(f.state,"current",{enumerable:!0,get:u,set:a});break;default:s.state.change=function(e){return a.call(s.state,e),s.state.current=e},f.state.change=function(e){return a.call(s.state,e),s.state.current=e}}f.ready=!0;switch(!0){case i:s.init();break;case typeof e.define=="function":e.define("abaaso",function(){return s.init()});break;case/complete|loaded/.test(t.readyState):s.init();break;case typeof t.addEventListener=="function":t.addEventListener("DOMContentLoaded",s.init,!1);break;case typeof t.attachEvent=="function":t.attachEvent("onreadystatechange",o);break;default:O.repeat(o)}},{array:p,callback:{},client:{android:v.android,blackberry:v.blackberry,chrome:v.chrome,firefox:v.firefox,ie:v.ie,ios:v.ios,linux:v.linux,mobile:v.mobile,opera:v.opera,osx:v.osx,playbook:v.playbook,safari:v.safari,tablet:v.tablet,size:{height:0,width:0},version:0,webos:v.webos,windows:v.windows,del:function(e,t,n,r){return v.request(e,"DELETE",t,n,null,r)},get:function(e,t,n,r){return v.request(e,"GET",t,n,null,r)},headers:function(e,t,n){return v.request(e,"HEAD",t,n)},post:function(e,t,n,r,i){return v.request(e,"POST",t,n,r,i)},put:function(e,t,n,r,i){return v.request(e,"PUT",t,n,r,i)},jsonp:function(e,t,n,r){return v.jsonp(e,t,n,r)},options:function(e,t,n){return v.request(e,"OPTIONS",t,n)},permissions:v.permissions},cookie:m,element:b,json:E,label:S,loading:{create:O.loading,url:null},message:x,mouse:T,number:N,observer:{log:C.log,add:C.add,fire:C.fire,hook:C.hook,list:C.list,once:C.once,remove:C.remove},repeating:{},route:{enabled:!1,del:L.del,hash:L.hash,init:L.init,list:L.list,load:L.load,server:L.server,set:L.set},state:{_current:null,header:null,previous:null},string:A,validate:M,xml:D,$:O.$,alias:O.alias,aliased:"$",allows:v.allows,append:function(e,t,n){return n instanceof Element&&n.genId(),b.create(e,t,n,"last")},bootstrap:l,clear:b.clear,clone:O.clone,coerce:O.coerce,compile:O.compile,create:b.create,css:O.css,data:g.factory,datalist:y.factory,decode:E.decode,defer:O.defer,define:O.define,del:function(e,t,n,r){return v.request(e,"DELETE",t,n,null,r)},destroy:b.destroy,encode:E.encode,error:O.error,expire:d.clean,expires:12e4,extend:O.extend,filter:w.factory,fire:function(e){var t=typeof e=="string",n=p.cast(arguments),r=this;return t&&(r===f&&(r=s),n=[r].concat(n)),C.fire.apply(C,n),this},genId:O.genId,get:function(e,t,n,r){return v.request(e,"GET",t,n,null,r)},guid:O.guid,headers:function(e,t,n){return v.request(e,"HEAD",t,n)},hidden:b.hidden,id:"abaaso",init:function(){return delete s.init,f.fire("init").un("init").fire("ready").un("ready")},iterate:O.iterate,jsonp:function(e,t,n,r){return v.jsonp(e,t,n,r)},listeners:function(e){var t=this;if(typeof t=="undefined"||t===f)t=s;return C.list(t,e)},log:O.log,merge:O.merge,module:O.module,object:O.object,on:function(e,t,n,r,i,o){var u=typeof n=="function",a,l,c,h,p,d;a=u?e:this,l=u?t:e,c=u?n:t,h=u?r:n,p=u?i:r,d=u?o:i;if(typeof a=="undefined"||a===f)a=s;return typeof p=="undefined"&&(p=a),C.add(a,l,c,h,p,d)},once:function(e,t,n,r,i,o){var u=typeof n=="function",a,l,c,h,p,d;a=u?e:this,l=u?t:e,c=u?n:t,h=u?r:n,p=u?i:r,d=u?o:i;if(typeof a=="undefined"||a===f)a=s;return typeof p=="undefined"&&(p=a),C.once(a,l,c,h,p,d)},options:function(e,t,n){return v.request(e,"OPTIONS",t,n)},parse:O.parse,permissions:v.permissions,position:b.position,post:function(e,t,n,r,i){return v.request(e,"POST",t,n,r,i)},prepend:function(e,t,n){return n instanceof Element&&n.genId(),b.create(e,t,n,"first")},promise:k.factory,property:O.property,put:function(e,t,n,r,i){return v.request(e,"PUT",t,n,r,i)},queryString:O.queryString,ready:!1,reflect:O.reflect,repeat:O.repeat,stylesheet:O.stylesheet,script:O.script,stop:O.stop,store:g.factory,tpl:O.tpl,un:function(e,t,n,r){var i=typeof n!="undefined",o,u,a,l;o=i?e:this,u=i?t:e,a=i?n:t,l=i?r:n;if(typeof o=="undefined"||o===f)o=s;return C.remove(o,u,a,l)},update:b.update,version:"3.1.0",walk:O.walk}}(),typeof s.bootstrap=="function"&&s.bootstrap();switch(!0){case typeof exports!="undefined":module.exports=s;break;case typeof define=="function":define("abaaso",function(){return s});break;default:e.abaaso=s}})(this);