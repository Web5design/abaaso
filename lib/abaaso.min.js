/**
 * abaaso
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright Jason Mulligan 2012
 * @license BSD-3 <http://opensource.org/licenses/BSD-3-Clause>
 * @link http://abaaso.com
 * @module abaaso
 * @version 2.8.21
 */
(function(a){var b=a.document,c=a.location,d=a.navigator,f=typeof b=="undefined",g;f&&(typeof Storage=="undefined"&&(localStorage=require("localStorage")),typeof XMLHttpRequest=="undefined"&&(XMLHttpRequest=null)),g=a.abaaso||function(){"use strict";var h,i,j,k,l={add:function(a,b){return l.contains(a,b)||a.push(b),a},cast:function(a,b){b=b===!0;var c=[],d,e;switch(!0){case!isNaN(a.length):!n.ie||n.version>8?c=Array.prototype.slice.call(a):z.iterate(a,function(a,b){b!=="length"&&c.push(a)});break;default:b?c=l.keys(a):z.iterate(a,function(a){c.push(a)})}return c},clone:function(a){return z.clone(a)},contains:function(a,b){return l.index(a,b)>-1},diff:function(a,b){var c=[];return a.each(function(a){b.contains(a)||c.add(a)}),b.each(function(b){a.contains(b)||c.add(b)}),c},each:function(a,b){var c=a.length,d,e;for(d=0;d<c;d++){e=b.call(a,a[d],d);if(e===!1)break}return a},first:function(a){return a[0]},index:function(a,b){return a.indexOf(b)},indexed:function(a){var b=[];return z.iterate(a,function(a,c){typeof a=="object"?b=b.concat(l.indexed(a)):b.push(a)}),b},intersect:function(a,b){var c=a.length>b.length?a:b,d=c===a?b:a;return c.filter(function(a){return l.contains(d,a)})},keys:function(a){var b=[];return typeof Object.keys=="function"?b=Object.keys(a):z.iterate(a,function(a,c){b.push(c)}),b},last:function(a){return a[a.length-1]},range:function(a,b,c){var d=[],e;for(e=b;e<=c;e++)typeof a[e]!="undefined"&&d.push(a[e]);return d},remove:function(a,b,c){if(isNaN(b)){b=a.index(b);if(b===-1)return a}else b=b||0;var d=a.length,e=a.slice((c||b)+1||d);return a.length=b<0?d+b:b,a.push.apply(a,e),a},sort:function(a,b){var c=!1,d;!isNaN(a)&&!isNaN(b)&&(c=!0),a=c?v.parse(a):String(a),b=c?v.parse(b):String(b);switch(!0){case a<b:d=-1;break;case a>b:d=1;break;default:d=0}return d},total:function(a){return l.indexed(a).length},toObject:function(a){var b={},c=a.length;while(c--)b[c.toString()]=a[c];return b}},m={items:{},clean:function(){return z.iterate(m.items,function(a,b){m.expired(b)&&m.expire(b)})},expire:function(a,b){return b=b===!0,typeof m.items[a]!="undefined"?(delete m.items[a],b||a.fire("beforeExpire, expire, afterExpire"),!0):!1},expired:function(a){var b=m.items[a];return typeof b!="undefined"&&typeof b.expires!="undefined"&&b.expires<new Date},get:function(a,b){return b=b!==!1,typeof m.items[a]=="undefined"?!1:b&&m.expired(a)?(m.expire(a),!1):z.clone(m.items[a])},set:function(a,b,c){return typeof m.items[a]=="undefined"&&(m.items[a]={},m.items[a].permission=0),b==="permission"?m.items[a].permission|=c:b==="!permission"?m.items[a].permission&=~c:m.items[a][b]=c,m.items[a]}},n={android:function(){return!f&&/android/i.test(d.userAgent)}(),blackberry:function(){return!f&&/blackberry/i.test(d.userAgent)}(),chrome:function(){return!f&&/chrome/i.test(d.userAgent)}(),firefox:function(){return!f&&/firefox/i.test(d.userAgent)}(),ie:function(){return!f&&/msie/i.test(d.userAgent)}(),ios:function(){return!f&&/ipad|iphone/i.test(d.userAgent)}(),linux:function(){return!f&&/linux|bsd|unix/i.test(d.userAgent)}(),mobile:function(){g.client.mobile=this.mobile=!f&&(/blackberry|iphone|webos/i.test(d.userAgent)||/android/i.test(d.userAgent)&&(g.client.size.height<720||g.client.size.width<720))},playbook:function(){return!f&&/playbook/i.test(d.userAgent)}(),opera:function(){return!f&&/opera/i.test(d.userAgent)}(),osx:function(){return!f&&/macintosh/i.test(d.userAgent)}(),safari:function(){return!f&&/safari/i.test(d.userAgent.replace(/chrome.*/i,""))}(),tablet:function(){g.client.tablet=this.tablet=!f&&(/ipad|playbook|webos/i.test(d.userAgent)||/android/i.test(d.userAgent)&&(g.client.size.width>=720||g.client.size.width>=720))},webos:function(){return!f&&/webos/i.test(d.userAgent)}(),windows:function(){return!f&&/windows/i.test(d.userAgent)}(),version:function(){var a=0;switch(!0){case this.chrome:a=d.userAgent.replace(/(.*chrome\/|safari.*)/gi,"");break;case this.firefox:a=d.userAgent.replace(/(.*firefox\/)/gi,"");break;case this.ie:a=parseInt(d.userAgent.replace(/(.*msie|;.*)/gi,"")),b.documentMode<a&&(a=b.documentMode);break;case this.opera:a=d.userAgent.replace(/(.*opera\/|\(.*)/gi,"");break;case this.safari:a=d.userAgent.replace(/(.*version\/|safari.*)/gi,"");break;default:a=typeof d!="undefined"?d.appVersion:0}return a=isNaN(parseInt(a))?0:parseInt(a),g.client.version=this.version=a,a},allows:function(a,b){if(a.isEmpty()||b.isEmpty())throw Error(s.error.invalidArguments);if(!m.get(a,!1))return undefined;b=b.toLowerCase();var c;switch(!0){case b==="delete":c=(n.permissions(a,b).bit&1)!==0;break;case b==="get":c=(n.permissions(a,b).bit&4)!==0;break;case/post|put/.test(b):c=(n.permissions(a,b).bit&2)!==0;break;default:c=!1}return c},bit:function(a){var b=0;return a.each(function(a){switch(a.toLowerCase()){case"get":b|=4;break;case"post":case"put":b|=2;break;case"delete":b|=1}}),b},cors:function(a){return!f&&a.indexOf("//")>-1&&a.indexOf("//"+c.host)===-1},headers:function(a,b,c){var d=String(a.getAllResponseHeaders()).split("\n"),e={},f={},g=null,i=new Date,j,k;d.each(function(a){a.isEmpty()||(j=a.toString(),k=j.substr(j.indexOf(":")+1,j.length).replace(/\s/,""),j=j.substr(0,j.indexOf(":")).replace(/\s/,""),j=function(){var a=[];return j.explode("-").each(function(b){a.push(b.capitalize())}),a.join("-")}(),e[j]=k,/allow|access-control-allow-methods/i.test(j)&&(g=k))});switch(!0){case typeof e["Cache-Control"]!="undefined"&&/no/.test(e["Cache-Control"]):case typeof e.Pragma!="undefined"&&/no/.test(e.Pragma):break;case typeof e["Cache-Control"]!="undefined"&&/\d/.test(e["Cache-Control"]):i=i.setSeconds(i.getSeconds()+parseInt(/\d{1,}/.exec(e["Cache-Control"])[0]));break;case typeof e.Expires!="undefined":i=new Date(e.Expires);break;default:i=i.setSeconds(i.getSeconds()+h.expires)}return f.expires=i,f.headers=e,f.permission=n.bit(g!==null?g.explode():[c]),c!=="head"&&(m.set(b,"expires",f.expires),m.set(b,"headers",f.headers),m.set(b,"permission",f.permission)),f},parse:function(a,b){b=b||"";var c,d;switch(!0){case(/json|plain|javascript/.test(b)||b.isEmpty())&&Boolean(d=r.decode(/[\{\[].*[\}\]]/.exec(a.responseText),!0)):c=d;break;case/xml/.test(b)&&String(a.responseText).isEmpty()&&a.responseXML!==null:c=C.decode(typeof a.responseXML.xml!="undefined"?a.responseXML.xml:a.responseXML);break;case/<[^>]+>[^<]*]+>/.test(a.responseText):c=C.decode(a.responseText);break;default:c=a.responseText}return c},permissions:function(a){var b=m.get(a,!1),c=b?b.permission:0,d={allows:[],bit:c,map:{read:4,write:2,"delete":1}};return c&1&&d.allows.push("DELETE"),c&2&&function(){d.allows.push("POST"),d.allows.push("PUT")}(),c&4&&d.allows.push("GET"),d},jsonp:function(b,c,d,e){var f=b,g=z.guid(!0),i,j,l;typeof k=="undefined"&&(typeof a.abaaso=="undefined"&&z.define("abaaso.callback",{},a),k="abaaso");switch(!0){case typeof e=="undefined":case e===null:case e instanceof Object&&(e.callback===null||typeof e.callback=="undefined"):case typeof e=="string"&&e.isEmpty():i="callback";break;case e instanceof Object&&typeof e.callback!="undefined":i=e.callback;break;default:i="callback"}f=f.replace(i+"=?",""),f.once("afterJSONP",function(a){this.un("failedJSONP",g),typeof c=="function"&&c(a)},g).once("failedJSONP",function(){this.un("failedJSONP",g),typeof d=="function"&&d()},g);do j=z.genId().slice(0,10);while(typeof a.abaaso.callback[j]!="undefined");return b=b.replace(i+"=?",i+"="+k+".callback."+j),a.abaaso.callback[j]=function(b){l.destroy(),clearTimeout(z.timer[j]),delete z.timer[j],delete a.abaaso.callback[j],f.fire("afterJSONP",b)},l=h("head")[0].create("script",{src:b,type:"text/javascript"}),z.defer(function(){f.fire("failedJSONP")},3e4,j),b},request:function(a,b,c,d,e,f){var g,h,i,k,l,o,p,q,t,u;if(/post|put/i.test(b)&&typeof e=="undefined")throw Error(s.error.invalidArguments);b=b.toLowerCase(),f=f instanceof Object?f:null,g=n.cors(a),h=n.ie&&n.version<10&&g?new XDomainRequest:new XMLHttpRequest,i=/post|put/i.test(b)&&typeof e!="undefined"?e:null,k=b==="get"?m.get(a):!1,l=b.capitalize(),o=z.guid(!0),p=null,q=typeof Document!="undefined",t=typeof ArrayBuffer!="undefined",u=typeof Blob!="undefined",b==="delete"&&a.once("afterDelete",function(){m.expire(this)}),a.once("after"+l,function(b){a.un("failed"+l,o),typeof c=="function"&&c(b)},o).once("failed"+l,function(b){a.un("after"+l,o),typeof d=="function"&&d(b)},o).fire("before"+l);if(b!=="head"&&a.allows(b)===!1)return a.fire("failed"+l);if(b==="get"&&Boolean(k))a.fire("afterGet",k.response);else{h[h instanceof XMLHttpRequest?"onreadystatechange":"onload"]=function(){n.response(h,a,b)},typeof h.ontimeout!="undefined"&&(h.ontimeout=function(b){a.fire("timeout"+l,b)}),typeof h.onprogress!="undefined"&&(h.onprogress=function(b){a.fire("progress"+l,b)}),typeof h.upload!="undefined"&&typeof h.upload.onprogress!="undefined"&&(h.upload.onprogress=function(b){a.fire("progressUpload"+l,b)});try{h.open(b.toUpperCase(),a,!0),f!==null&&f.hasOwnProperty("Content-Type")&&(p=f["Content-Type"]),g&&p===null&&(p="text/plain"),i!==null&&(i.hasOwnProperty("xml")&&(i=i.xml),q&&i instanceof Document&&(i=C.decode(i)),typeof i=="string"&&/<[^>]+>[^<]*]+>/.test(i)&&(p="application/xml"),!(t&&i instanceof ArrayBuffer)&&!(u&&i instanceof Blob)&&i instanceof Object&&(p="application/json",i=r.encode(i)),p===null&&(t&&i instanceof ArrayBuffer||u&&i instanceof Blob)&&(p="application/octet-stream"),p===null&&(p="application/x-www-form-urlencoded; charset=UTF-8")),typeof h.setRequestHeader!="undefined"&&(typeof k=="object"&&k.headers.hasOwnProperty("ETag")&&h.setRequestHeader("ETag",k.headers.ETag),f===null&&(f={}),p!==null&&(f["Content-Type"]=p),f.hasOwnProperty("callback")&&delete f.callback,z.iterate(f,function(a,b){a!==null&&b!=="withCredentials"&&h.setRequestHeader(b,a)})),typeof h.withCredentials=="boolean"&&f!==null&&typeof f.withCredentials=="boolean"&&(h.withCredentials=f.withCredentials),a.fire("beforeXHR",{xhr:h,uri:a}),i!==null?h.send(i):h.send()}catch(v){j(v,arguments,this,!0),a.fire("failed"+l,{response:n.parse(h),xhr:h})}}return a},response:function(a,b,d){var e=d.toLowerCase().capitalize(),f=c,h=null,i,k,l,o,p;switch(!0){case a.readyState===2:b.fire("received"+e);break;case a.readyState===4:b.fire("afterXHR",{xhr:a,uri:b});try{switch(a.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 301:i=g.state,k=n.headers(a,b,d),l=n.cors(b);switch(!0){case d==="head":return b.fire("afterHead",k.headers);case d!=="delete"&&/200|201/.test(a.status):p=typeof k.headers["Content-Type"]!="undefined"?k.headers["Content-Type"]:"",o=n.parse(a,p);if(typeof o=="undefined")throw Error(s.error.serverError);m.set(b,"response",k.response=z.clone(o))}i.header!==null&&Boolean(h=k.headers[i.header])&&i.current!==h&&(typeof i.change=="function"?i.change(h):i.current=h),b.fire("headers",k.headers);switch(a.status){case 200:case 201:b.fire("after"+e,o);break;case 202:case 203:case 204:case 206:b.fire("after"+e);break;case 205:b.fire("reset");break;case 301:b.fire("moved",o)}break;case 401:throw Error(s.error.serverUnauthorized);case 403:throw m.set(b,"!permission",n.bit([d])),Error(s.error.serverForbidden);case 405:throw m.set(b,"!permission",n.bit([d])),Error(s.error.serverInvalidMethod);case 0:default:throw Error(s.error.serverError)}}catch(q){j(q,arguments,this,!0),b.fire("failed"+e,{response:n.parse(a),xhr:a})}break;case n.ie&&n.cors(b):var o,t;switch(!0){case Boolean(t=r.decode(/[\{\[].*[\}\]]/.exec(a.responseText))):o=t;break;case/<[^>]+>[^<]*]+>/.test(a.responseText):o=C.decode(a.responseText);break;default:o=a.responseText}m.set(b,"permission",n.bit(["get"])),m.set(b,"response",o),b.fire("afterGet",o)}return b},size:function(){var a=f?{clientHeight:0,clientWidth:0}:typeof b.documentElement!="undefined"?b.documentElement:b.body;return{height:a.clientHeight,width:a.clientWidth}}},o={expire:function(a,b,c){return typeof o.get(a)!="undefined"&&o.set(a,"","-1s",b,c),a},get:function(a){return o.list()[a]},list:function(){var a={},c,d;return typeof b.cookie!="undefined"&&!b.cookie.isEmpty()&&(d=b.cookie.explode(";"),d.each(function(b){c=b.explode("="),a[decodeURIComponent(c[0].toString().trim())]=decodeURIComponent(c[1].toString().trim())})),a},set:function(a,c,d,e,f){typeof c=="undefined"&&(c=""),c+=";",typeof d=="undefined"&&(d=""),e=typeof e=="string"?" domain="+e+";":"",f=f===!0?"; secure":"";var g="",h=null,i=null,j=["d","h","m","s"],k=new RegExp,l=j.length;if(!d.isEmpty()){while(l--){z.compile(k,j[l]);if(k.test(d)){i=j[l],h=parseInt(d);break}}if(isNaN(h))throw Error(s.error.invalidArguments);g=new Date;switch(i){case"d":g.setDate(g.getDate()+h);break;case"h":g.setHours(g.getHours()+h);break;case"m":g.setMinutes(g.getMinutes()+h);break;case"s":g.setSeconds(g.getSeconds()+h)}}return g instanceof Date&&(g=" expires="+g.toUTCString()+";"),b.cookie=a.toString().trim()+"="+c+g+e+" path=/"+f,o.get(a)}},p={methods:{batch:function(a,b,c){a=a.toString().toLowerCase(),c=c===!0;if(!/^(set|del)$/.test(a)||typeof b!="object")throw Error(s.error.invalidArguments);var d=this.parentNode,e=this,f=0,g=0,i=!1,j=z.genId(!0),k,m,n,o,p;k=function(){a==="del"&&e.reindex(),e.loaded=!0,d.fire("afterDataBatch")},m=function(a){d.fire("failedDataSet, failedDataBatch",a)},o=function(a,b){var j=z.genId(),l={};typeof l.batch!="function"?l=z.clone(a):h.iterate(a,function(a,b){e.collections.contains(b)||(l[b]=z.clone(a))}),e.key!==null&&typeof l[e.key]!="undefined"&&(b=l[e.key],delete l[e.key]),d.once("afterDataSet",function(){this.un("failedDataSet",j),++f&&f===g&&k()},j).once("failedDataSet",function(){this.un("afterDataSet",j),i||(i=!0,this.fire("failedDataBatch"))},j),e.set(b,l,c)},d.fire("beforeDataBatch",b),a==="del"&&d.on("afterDataDelete",function(){f++&&f===g&&(d.un("afterDataDelete, failedDataDelete",j),k())},j).once("failedDataDelete",function(){d.un("afterDataDelete",j),i||(i=!0,d.fire("failedDataBatch"))},j);if(b instanceof Array){g=b.length;switch(g){case 0:k();break;default:b.sort().reverse().each(function(b,d){d=d.toString();if(a==="set")switch(!0){case typeof b=="object":o(b,d);break;case b.indexOf("//")===-1:b=e.uri+b;default:b.get(function(a){o(e.source===null?a:z.walk(a,e.source),d)},m,z.merge({withCredentials:e.credentials},e.headers))}else e.del(b,!1,c)})}}else g=l.cast(b,!0).length,z.iterate(b,function(b,d){a==="set"?(e.key!==null&&typeof b[e.key]!="undefined"?(n=b[e.key],delete b[e.key]):n=d.toString(),e.set(n,b,c)):e.del(b,!1,c)});return this},clear:function(a){a=a===!0;var b=this.parentNode;return a?(this.collections=[],this.crawled=!1,this.keys={},this.loaded=!1,this.records=[],this.total=0,this.views={}):(b.fire("beforeDataClear"),this.callback=null,this.collections=[],this.crawled=!1,this.credentials=null,this.expires=null,this._expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.key=null,this.keys={},this.loaded=!1,this.pointer=null,this.records=[],this.recursive=!1,this.retrieve=!1,this.source=null,this.total=0,this.views={},this.uri=null,this._uri=null,b.fire("afterDataClear")),this},crawl:function(a,b,c){var d=!1,e=this,f;if(typeof a!="number"&&typeof a!="string")throw Error(s.error.invalidArguments);return this.crawled=!0,this.loaded=!1,f=this.get(a),f=this.records[this.keys[f.key].index],c=c||this.key,typeof b=="string"&&(d=!0,b=b.explode()),z.iterate(f.data,function(a,g){if(typeof a!="string"||d&&b.contains(g))return;a.indexOf("//")>=0&&(e.collections.contains(g)||e.collections.push(g),f.data[g]=p.register({id:f.key+"-"+g}),f.data[g].once("afterDataSync",function(){this.fire("afterDataRetrieve")},"dataRetrieve"),f.data[g].data.headers=z.merge(f.data[g].data.headers,e.headers),b.each(function(a){f.data[g].data.ignore.add(a)}),f.data[g].data.key=c,f.data[g].data.pointer=e.pointer,f.data[g].data.source=e.source,e.recursive&&e.retrieve&&(f.data[g].data.recursive=!0,f.data[g].data.retrieve=!0),typeof f.data[g].data.setUri=="function"?f.data[g].data.setUri(a):f.data[g].data.uri=a)}),this.get(a)},del:function(a,b,c){if(typeof a=="undefined"||!/number|string/.test(typeof a))throw Error(s.error.invalidArguments);b=b!==!1,c=c===!0;var d=this.parentNode,e=/true|undefined/,f,g,h,i;switch(typeof a){case"string":f=a,a=this.keys[f];if(typeof f=="undefined")throw Error(s.error.invalidArguments);a=a.index;break;default:f=this.records[a];if(typeof f=="undefined")throw Error(s.error.invalidArguments);f=f.key}g={key:f,record:a,reindex:b},!c&&this.callback===null&&this.uri!==null&&(h=this.uri+"/"+f,i=h.allows("delete")),d.fire("beforeDataDelete",g);switch(!0){case c:case this.callback!==null:case this.uri===null:d.fire("syncDataDelete",g);break;case e.test(i):h.del(function(){d.fire("syncDataDelete",g)},function(){d.fire("failedDataDelete",g)},z.merge({withCredentials:this.credentials},this.headers));break;default:d.fire("failedDataDelete",g)}return this},find:function(a,b,c){if(typeof a=="undefined")throw Error(s.error.invalidArguments);a=typeof a=="string"?a.explode():[a],b=typeof b=="string"?b.explode():null;var d=[],e=this.parentNode,f=[],g=new RegExp;if(this.total===0)return d;switch(!0){case typeof c=="undefined":case String(c).isEmpty():c="gi";break;case c===null:c=""}return b===null?this.records.each(function(b){z.iterate(b.data,function(e,h){if(f.contains(b.key))return!1;if(typeof e.data=="object")return;a.each(function(a){z.compile(g,a,c);if(g.test(e))return f.push(b.key),d.add(b),!1})})}):this.records.each(function(e){b.each(function(b){if(f.contains(e.key))return!1;if(typeof e.data[b]=="undefined"||typeof e.data[b].data=="object")return;a.each(function(a){z.compile(g,a,c);if(g.test(e.data[b]))return f.push(e.key),d.add(e),!1})})}),d},form:function(a,b,c){c=c!==!1;var d=a===null,e=this,f,g,i,j,k,l;switch(!0){case d:a=this.get(0);break;case!(a instanceof Object):a=this.get(a)}switch(!0){case typeof a=="undefined":throw Error(s.error.invalidArguments);case this.uri!==null&&!this.uri.allows("post"):throw Error(s.error.serverInvalidMethod)}return k=a.key,l=a.data,typeof b!="undefined"&&(b=z.object(b)),this.uri!==null?(f=this.uri.replace(/.*\//,"").replace(/\?.*/,""),f.isDomain()&&(f=f.replace(/\..*/g,""))):f="record",i=function(a){var b=a.srcElement.parentNode,d=h("#"+b.id+" input"),f=d[0].name.match(/(.*)\[/)[1],g=!0,i={},j;e.parentNode.fire("beforeDataFormSubmit"),c&&(g=b.validate());switch(g){case!1:e.parentNode.fire("failedDataFormSubmit");break;case!0:d.each(function(a){if(typeof a.type!="undefined"&&/button|submit|reset/.test(a.type))return;z.define(a.name.replace("[",".").replace("]",""),a.value,i)}),j=z.genId(!0),e.parentNode.once("afterDataSet",function(){b.destroy()}),e.set(k,i[f])}e.parentNode.fire("afterDataFormSubmit",k)},j=function(a,b,c){var e,f;z.iterate(a,function(a,g){switch(!0){case a instanceof Array:e=0,a.each(function(a){j(a,b,c+"["+g+"]["+e++ +"]")});break;case a instanceof Object:j(a,b,c+"["+g+"]");break;default:f=(c+"["+g+"]").replace(/\[|\]/g,""),b.create("label",{"for":f}).html(g.capitalize()),b.create("input",{id:f,name:c+"["+g+"]",type:"text",value:d?"":a})}})},this.parentNode.fire("beforeDataForm"),g=q.create("form",{style:"display:none;"},b),j(l,g,f),g.create("input",{type:"button",value:s.common.submit}).on("click",function(a){i(a)}),g.create("input",{type:"reset",value:s.common.reset}),g.css("display","inherit"),this.parentNode.fire("afterDataForm",g),g},get:function(a,b){var c=this.records,d=this.parentNode,e;switch(!0){case typeof a=="undefined":case String(a).length===0:e=c;break;case typeof a=="string"&&typeof this.keys[a]!="undefined":e=c[this.keys[a].index];break;case typeof a=="number"&&typeof b=="undefined":e=c[parseInt(a)];break;case typeof a=="number"&&typeof b=="number":e=c.range(parseInt(a),parseInt(b));break;default:e=undefined}return e},reindex:function(){var a=this.total,b=this.parentNode,c=this.key!==null,d;this.views={};if(a===0)return this;for(d=0;d<a;d++)!c&&this.records[d].key.isNumber()&&(delete this.keys[this.records[d].key],this.keys[d.toString()]={},this.records[d].key=d.toString()),this.keys[this.records[d].key].index=d;return this},storage:function(a,b,c){var d=!1,e=c==="session"&&typeof sessionStorage!="undefined",f=/number|string/,g,h,i;if(!/number|object|string/.test(typeof a)||!/get|remove|set/.test(b))throw Error(s.error.invalidArguments);d=f.test(a)||a.hasOwnProperty("key")&&!a.hasOwnProperty("parentNode"),d&&!(a instanceof Object)&&(a=this.get(a)),h=d?a.key:a.parentNode.id;switch(b){case"get":g=e?sessionStorage.getItem(h):localStorage.getItem(h);if(g===null)throw Error(s.error.invalidArguments);g=r.decode(g),d?this.set(h,g,!0):z.merge(this,g),g=d?a:this;break;case"remove":e?sessionStorage.removeItem(h):localStorage.removeItem(h),g=this;break;case"set":i=r.encode(d?a.data:{total:this.total,keys:this.keys,records:this.records}),e?sessionStorage.setItem(h,i):localStorage.setItem(h,i),g=this}return g},set:function(a,b,c){a===null&&(a=undefined),c=c===!0;switch(!0){case(typeof a=="undefined"||String(a).isEmpty())&&this.uri===null:case typeof b=="undefined":case b instanceof Array:case b instanceof Number:case b instanceof String:case typeof b!="object":throw Error(s.error.invalidArguments)}var d=typeof a=="undefined"?undefined:this.get(a),e=this.parentNode,f=typeof a=="undefined"?"post":"put",g={data:typeof d!="undefined"?z.merge(d.data,b):b,key:a,record:undefined},h=this.uri,i=/true|undefined/,j;typeof d!="undefined"&&(g.record=this.records[this.keys[d.key].index]),this.collections.each(function(a){typeof g.data[a]=="object"&&delete g.data[a]}),!c&&this.callback===null&&h!==null&&(typeof d!="undefined"&&(h+="/"+d.key),j=h.allows(f)),e.fire("beforeDataSet",{key:a,data:b});switch(!0){case c:case this.callback!==null:case this.uri===null:e.fire("syncDataSet",g);break;case i.test(j):h[f](function(a){g.result=a,e.fire("syncDataSet",g)},function(a){e.fire("failedDataSet")},b,z.merge({withCredentials:this.credentials},this.headers));break;default:e.fire("failedDataSet",g)}return this},sort:function(a,b,c){if(typeof a=="undefined"||String(a).isEmpty())throw Error(s.error.invalidArguments);/ci|cs|ms/.test(c)||(c="ci"),b=b===!0;var d=a.replace(/\s*asc/g,"").replace(/,/g," ").toCamelCase()+c.toUpperCase(),e=a.explode(),f=/:::(.*)$/,g=/\s*asc$/i,h=/\s*desc$/i,i=/^null/,j=this.key,k=[],m,n,o;return e.each(function(a){if(String(a).isEmpty())throw Error(s.error.invalidArguments)}),!b&&this.views[d]instanceof Array?this.views[d]:this.total===0?[]:(o=function(a,b){var c=a.clone(),d=a.first(),e={},f=[];return c.remove(0),e=m(d,b,h.test(d)),e.order.each(function(a){if(e.registry[a].length<2)return;c.length>0&&(e.registry[a]=o(c,e.registry[a]))}),e.order.each(function(a){f=f.concat(e.registry[a])}),f},m=function(a,b,d){a=a.replace(g,"");var e=a.replace(h,""),f=j===e,i=[],k={};return b.each(function(a){var b=f?a.key:a.data[e],d=b===null?"null":String(b);switch(c){case"ci":d=d.toCamelCase();break;case"cs":d=d.trim();break;case"ms":d=d.trim().slice(0,1).toLowerCase()}k[d]instanceof Array||(k[d]=[],i.push(d)),k[d].push(a)}),i.sort(l.sort),d&&i.reverse(),i.each(function(b){if(k[b].length===1)return;k[b]=n(k[b],a,e,d,f)}),{order:i,registry:k}},n=function(a,b,c,d,e){var g=[],h=[];return a.each(function(a,b){var d=e?a.key:a.data[c];d=String(d).trim()+":::"+b,g.push(d.replace(i,'""'))}),g.length>1&&(g.sort(l.sort),d&&g.reverse()),g.each(function(b){h.push(a[f.exec(b)[1]])}),h},k=o(e,this.records),this.views[d]=k,k)},sync:function(a){if(this.uri===null||this.uri.isEmpty())throw Error(s.error.invalidArguments);a=a===!0;var b=this,c=b.parentNode,d=z.guid(!0),e,f;return e=function(d){try{if(typeof d!="object")throw Error(s.error.expectedObject);var e,f=!1,g=z.genId(!0);b.source!==null&&(d=z.walk(d,b.source)),d instanceof Array?e=d:z.iterate(d,function(a){!f&&a instanceof Array&&(f=!0,e=a)}),typeof e=="undefined"&&(e=[d]),c.once("afterDataBatch",function(c){a&&b.reindex(),this.un("failedDataBatch",g).fire("afterDataSync",b.get())},g),c.once("failedDataBatch",function(a){b.clear(!0),this.un("afterDataBatch",g).fire("failedDataSync")},g),b.batch("set",e,!0)}catch(h){j(h,arguments,this),c.fire("failedDataSync",d)}},f=function(a){c.fire("failedDataSync",a)},c.fire("beforeDataSync"),this.callback!==null?this.uri.jsonp(e,f,{callback:this.callback}):this.uri.get(e,f,z.merge({withCredentials:this.credentials},this.headers)),this},teardown:function(){var a=this.uri,b,c;return a!==null&&(m.expire(a,!0),w.remove(a),c=this.parentNode.id+"DataExpire",typeof h.repeating[c]!="undefined"&&(clearTimeout(h.repeating[c]),delete h.repeating[c]),b=this.get(),b.each(function(b){m.expire(a+"/"+b.key,!0),w.remove(a+"/"+b.key),z.iterate(b.data,function(a,b){if(a===null)return;a.hasOwnProperty("data")&&typeof a.data.teardown=="function"&&(w.remove(a.id),a.data.teardown())})})),this.clear(!0),this}},register:function(a,b,c){var d={expires:{getter:function(){return this._expires},setter:function(a){if(a!==null&&this.uri===null&&isNaN(a))throw Error(s.error.invalidArguments);if(this._expires===a)return;this._expires=a;var b=this.parentNode.id+"DataExpire",c=a,d=this;clearTimeout(h.repeating[b]),delete h.repeating[b];if(a===null)return;z.defer(function(){z.repeat(function(){if(d.uri===null)return typeof d.setExpires=="function"?d.setExpires(null):d.expires=null,!1;m.expire(d.uri)||d.uri.fire("beforeExpire, expire, afterExpire")},c,b)},c)}},uri:{getter:function(){return this._uri},setter:function(a){if(a!==null&&a.isEmpty())throw Error(s.error.invalidArguments);switch(!0){case this._uri===a:return;case this._uri!==null:this._uri.un("expire","dataSync"),this.teardown(!0);default:this._uri=a}a!==null&&(a.on("expire",function(){this.sync(!0)},"dataSync",this),m.expire(a,!0),this.sync())}}};a=z.object(a),z.genId(a),typeof a.fire=="undefined"&&(a.fire=function(a,b){return h.fire.call(this,a,b)}),typeof a.listeners=="undefined"&&(a.listeners=function(a){return h.listeners.call(this,a)}),typeof a.on=="undefined"&&(a.on=function(a,b,c,d,e){return h.on.call(this,a,b,c,d,e)}),typeof a.once=="undefined"&&(a.once=function(a,b,c,d,e){return h.once.call(this,a,b,c,d,e)}),typeof a.un=="undefined"&&(a.un=function(a,b){return h.un.call(this,a,b)}),a.fire("beforeDataStore"),a.data=z.extend(this.methods),a.data.parentNode=a,a.data.clear(),c instanceof Object&&z.merge(a.data,c),a.on("syncDataDelete",function(a){var b=this.get(a.record);return this.records.remove(this.keys[a.key].index),delete this.keys[a.key],this.total--,this.views={},a.reindex&&this.reindex(),z.iterate(b.data,function(a,b){if(a===null)return;typeof a.data!="undefined"&&typeof a.data.teardown=="function"&&a.data.teardown()}),this.parentNode.fire("afterDataDelete",b),this.parentNode},"recordDelete",a.data),a.on("syncDataSet",function(a){var b=typeof a.record=="undefined"?z.clone(a):a,c=!0,d=this,e,f;switch(!0){case typeof b.record=="undefined":var g=this.total;this.total++;if(typeof b.key=="undefined"){if(typeof b.result=="undefined")throw this.fire("failedDataSet"),Error(s.error.expectedObject);this.source!==null&&(b.result=z.walk(b.result,this.source)),this.key===null?b.key=l.cast(b.result).first():(b.key=b.result[this.key],delete b.result[this.key]),typeof b.key!="string"&&(b.key=b.key.toString()),b.data=b.result}this.keys[b.key]={},this.keys[b.key].index=g,this.records[g]={},e=this.records[g],e.key=b.key;if(this.pointer===null||typeof b.data[this.pointer]=="undefined")e.data=b.data,this.key!==null&&this.records[g].data.hasOwnProperty(this.key)&&delete this.records[g].data[this.key];else{c=!1,f=b.data[this.pointer];if(typeof f=="undefined"||f===null)throw delete this.records[g],delete this.keys[b.key],this.fire("failedDataSet"),Error(s.error.expectedObject);e.data={},f.get(function(a){d.source!==null&&(a=z.walk(a,d.source)),typeof a[d.key]!="undefined"&&delete a[d.key],z.merge(e.data,a),d.retrieve&&(d.crawl(e.key,d.ignore.length>0?d.ignore.join(","):undefined,d.key),d.loaded=!0),d.parentNode.fire("afterDataSet",e)},function(){d.parentNode.fire("failedDataSet")},d.headers)}break;default:b.record.data=b.data,e=b.record}this.views={},this.retrieve&&this.crawl(e.key,this.ignore.length>0?this.ignore.join(","):undefined,this.key),c&&this.parentNode.fire("afterDataSet",e)},"recordSet",a.data);switch(!0){case!n.ie||n.version>8:z.property(a.data,"uri",{enumerable:!0,get:d.uri.getter,set:d.uri.setter}),z.property(a.data,"expires",{enumerable:!0,get:d.expires.getter,set:d.expires.setter});break;default:a.data.setExpires=function(b){a.data.expires=b,d.expires.setter.call(a.data,b)},a.data.setUri=function(b){a.data.uri=b,d.uri.setter.call(a.data,b)}}return typeof b=="object"&&b!==null&&a.data.batch("set",b),a.fire("afterDataStore"),a}},q={attr:function(a,b,c){typeof c=="string"&&(c=c.trim());var d=/checked|disabled/,e;a=z.object(a);if(!(a instanceof Element&&typeof b!="undefined"&&!String(b).isEmpty()))throw Error(s.error.invalidArguments);switch(!0){case d.test(b)&&typeof c=="undefined":return a[b];case d.test(b)&&typeof c!="undefined":return a[b]=c,a;case a.nodeName==="SELECT"&&b==="selected"&&typeof c=="undefined":return h("#"+a.id+' option[selected="selected"]').first()||h("#"+a.id+" option").first();case a.nodeName==="SELECT"&&b==="selected"&&typeof c!="undefined":return e=h("#"+a.id+' option[selected="selected"]').first(),typeof e!="undefined"&&(e.selected=!1,e.removeAttribute("selected")),e=h("#"+a.id+' option[value="'+c+'"]').first(),e.selected=!0,e.setAttribute("selected","selected"),a;case typeof c=="undefined":return a.getAttribute(b);case c===null:return a.removeAttribute(b),a;default:return a.setAttribute(b,c),a}},clear:function(a){a=z.object(a);if(a instanceof Element){a.fire("beforeClear");switch(!0){case typeof a.reset=="function":a.reset();break;case typeof a.value!="undefined":a.update({innerHTML:"",value:""});break;default:a.update({innerHTML:""})}return a.fire("afterClear"),a}throw Error(s.error.invalidArguments)},create:function(a,c,d,e){if(typeof a=="undefined"||String(a).isEmpty())throw Error(s.error.invalidArguments);var f,g,i;switch(!0){case typeof d!="undefined":d=z.object(d);break;case typeof c!="undefined"&&(typeof c=="string"||typeof c.childNodes!="undefined"):d=z.object(c);break;default:d=b.body}if(typeof d=="undefined")throw Error(s.error.invalidArguments);i=!(d instanceof Element),g=typeof c!="undefined"&&typeof c!="string"&&typeof c.childNodes=="undefined"&&typeof c.id!="undefined"&&typeof h("#"+c.id)=="undefined"?c.id:z.genId(),typeof c!="undefined"&&typeof c.id!="undefined"&&delete c.id,h.fire("beforeCreate",g),i?i&&d.parentNode!==null&&d.parentNode.fire("beforeCreate",g):d.fire("beforeCreate",g),f=b.createElement(a),f.id=g,typeof c=="object"&&typeof c.childNodes=="undefined"&&f.update(c);switch(!0){case typeof e=="undefined":case e==="last":d.appendChild(f);break;case e==="first":d.prependChild(f);break;case e==="after":e={},e.after=d,d=d.parentNode;case typeof e.after!="undefined":d.insertBefore(f,e.after.nextSibling);break;case e==="before":e={},e.before=d,d=d.parentNode;case typeof e.before!="undefined":d.insertBefore(f,e.before);break;default:d.appendChild(f)}return i?i&&d.parentNode!==null&&d.parentNode.fire("afterCreate",f):d.fire("afterCreate",f),h.fire("afterCreate",f),f},css:function(a,b,c){a=z.object(a),b=b.indexOf("-")>-1?y.toCamelCase(b,!0):b;var d,e;return typeof c!="undefined"?(a.style[b]=c,e=a):e=a.style[b],e},data:function(a,b,c){var d;return a=z.object(a),typeof c!="undefined"?(typeof a.dataset=="object"?a.dataset[b]=c:q.attr(a,"data-"+b,c),d=a):d=z.coerce(typeof a.dataset=="object"?a.dataset[b]:q.attr(a,"data-"+b)),d},destroy:function(a){a=z.object(a);if(a instanceof Element)return h.fire("beforeDestroy",a),a.fire("beforeDestroy"),w.remove(a.id),a.parentNode!==null&&a.parentNode.removeChild(a),a.fire("afterDestroy"),h.fire("afterDestroy",a.id),undefined;throw Error(s.error.invalidArguments)},disable:function(a){a=z.object(a);if(a instanceof Element)return typeof a.disabled=="boolean"&&!a.disabled&&(a.fire("beforeDisable"),a.disabled=!0,a.fire("afterDisable")),a;throw Error(s.error.invalidArguments)},enable:function(a){a=z.object(a);if(a instanceof Element)return typeof a.disabled=="boolean"&&a.disabled&&(a.fire("beforeEnable"),a.disabled=!1,a.fire("afterEnable")),a;throw Error(s.error.invalidArguments)},find:function(a,b){var c=[];a=z.object(a);if(a instanceof Element&&typeof b=="string")return z.genId(a),b.explode().each(function(b){h("#"+a.id+" "+b).each(function(a){c.add(a)})}),c;throw Error(s.error.invalidArguments)},has:function(a,b){var c=q.find(a,b);return!isNaN(c.length)&&c.length>0},hasClass:function(a,b){return a=z.object(a),a.classList.contains(b)},hide:function(a){a=z.object(a);if(a instanceof Element){a.fire("beforeHide");switch(!0){case typeof a.hidden=="boolean":a.hidden=!0;break;default:a["data-display"]=a.style.display,a.style.display="none"}return a.fire("afterHide"),a}throw Error(s.error.invalidArguments)},hidden:function(a){a=z.object(a);if(a instanceof Element)return a.style.display==="none"||typeof a.hidden=="boolean"&&a.hidden;throw Error(s.error.invalidArguments)},is:function(a,b){a=z.object(a);if(a instanceof Element&&typeof b=="string")return z.genId(a),/^:/.test(b)?q.find(a.parentNode,a.nodeName.toLowerCase()+b).contains(a):(new RegExp(b,"i")).test(a.nodeName);throw Error(s.error.invalidArguments)},klass:function(a,b,c){var d;a=z.object(a);if(a instanceof Element&&!String(b).isEmpty())return a.fire("beforeClassChange"),c=c!==!1,b=b.explode(" "),c?b.each(function(b){a.classList.add(b)}):b.each(function(b){if(b!=="*")a.classList.remove(b);else return a.classList.each(function(a){this.remove(a)}),!1}),a.fire("afterClassChange"),a;throw Error(s.error.invalidArguments)},position:function(c){c=z.object(c);if(c instanceof Element){var d,e,f,g;d=e=0,g=c.offsetWidth,f=c.offsetHeight;if(c.offsetParent){e=c.offsetTop,d=c.offsetLeft;while(c=c.offsetParent)d+=c.offsetLeft,e+=c.offsetTop}return{top:e,right:b.documentElement.clientWidth-(d+g),bottom:b.documentElement.clientHeight+a.scrollY-(e+f),left:d}}throw Error(s.error.invalidArguments)},prependChild:function(a,b){a=z.object(a);if(a instanceof Element&&b instanceof Element)return a.childNodes.length===0?a.appendChild(b):a.insertBefore(b,a.childNodes[0]);throw Error(s.error.invalidArguments)},show:function(a){a=z.object(a);if(a instanceof Element){a.fire("beforeShow");switch(!0){case typeof a.hidden=="boolean":a.hidden=!1;break;default:a.style.display=a.getAttribute("data-display")!==null?a.getAttribute("data-display"):"inherit"}return a.fire("afterShow"),a}throw Error(s.error.invalidArguments)},size:function(a){a=z.object(a);var b,c,d;if(a instanceof Element)return b=function(a){return isNaN(parseInt(a))?0:parseInt(a)},c=a.offsetHeight+b(a.style.paddingTop)+b(a.style.paddingBottom)+b(a.style.borderTop)+b(a.style.borderBottom),d=a.offsetWidth+b(a.style.paddingLeft)+b(a.style.paddingRight)+b(a.style.borderLeft)+b(a.style.borderRight),{height:c,width:d};throw Error(s.error.invalidArguments)},text:function(a,b){a=z.object(a);var c=typeof a.textContent!="undefined"?"textContent":"innerText",d={},e=!1;return typeof b!="undefined"&&(e=!0,d[c]=b),e?q.update(a,d):a[c]},toggleClass:function(a,b){a=z.object(a);if(a instanceof Element)return a.classList.toggle(b),a;throw Error(s.error.invalidArguments)},update:function(a,b){a=z.object(a),b=b||{};var c;if(a instanceof Element)return a.fire("beforeUpdate"),c=/innerHTML|innerText|textContent|type|src/,z.iterate(b,function(b,d){switch(!0){case c.test(d):a[d]=b;break;case d==="class":b.isEmpty()?a.removeClass("*"):a.addClass(b);break;case d.indexOf("data-")===0:q.data(a,d.replace("data-",""),b);break;case"id":var e=w.listeners;typeof e[a.id]!="undefined"&&(e[d]=z.clone(e[a.id]),delete e[a.id]);default:a.attr(d,b)}}),a.fire("afterUpdate"),a;throw Error(s.error.invalidArguments)},val:function(a,b){var c=null,d;a=z.object(a);if(a instanceof Element){switch(!0){case typeof b=="undefined":switch(!0){case/radio|checkbox/gi.test(a.type):if(a.name.isEmpty())throw Error(s.error.expectedProperty);d=h("input[name='"+a.name+"']"),d.each(function(a){if(c!==null)return;a.checked&&(c=a.value)});break;case/select/gi.test(a.type):c=a.options[a.selectedIndex].value;break;default:c=typeof a.value!="undefined"?a.value:q.text(a)}typeof c=="string"&&(c=c.trim());break;default:b=String(b),a.fire("beforeValue");switch(!0){case/radio|checkbox/gi.test(a.type):d=h("input[name='"+a.name+"']"),d.each(function(a){if(c!==null)return;a.value===b&&(a.checked=!0,c=a)});break;case/select/gi.test(a.type):l.cast(a.options).each(function(a){if(c!==null)return;a.value===b&&(a.selected=!0,c=a)});break;default:typeof a.value!="undefined"?a.value=b:q.text(a,b)}a.fire("afterValue"),c=a}return c}throw Error(s.error.invalidArguments)}},r={decode:function(a,b){try{return JSON.parse(a)}catch(c){return b!==!0&&j(c,arguments,this),undefined}},encode:function(a,b){try{return JSON.stringify(a)}catch(c){return b!==!0&&j(c,arguments,this),undefined}}},s={common:{back:"Back",cancel:"Cancel",clear:"Clear",close:"Close",cont:"Continue",create:"Create",del:"Delete",edit:"Edit",find:"Find",gen:"Generate",go:"Go",loading:"Loading",next:"Next",login:"Login",ran:"Random",reset:"Reset",save:"Save",search:"Search",submit:"Submit"},day:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},error:{databaseNotOpen:"Failed to open the Database, possibly exceeded Domain quota",databaseNotSupported:"Client does not support local database storage",databaseWarnInjection:"Possible SQL injection in database transaction, use the &#63; placeholder",elementNotCreated:"Could not create the Element",elementNotFound:"Could not find the Element",expectedArray:"Expected an Array",expectedArrayObject:"Expected an Array or Object",expectedBoolean:"Expected a Boolean value",expectedNumber:"Expected a Number",expectedProperty:"Expected a property, and it was not set",expectedObject:"Expected an Object",invalidArguments:"One or more arguments is invalid",invalidDate:"Invalid Date",invalidFields:"The following required fields are invalid: ",invalidRoute:"The route could not be found",notAvailable:"Requested method is not available",notSupported:"This feature is not supported by this platform",propertyNotFound:"Could not find the requested property",serverError:"Server error has occurred",serverForbidden:"Forbidden to access URI",serverInvalidMethod:"Method not allowed",serverUnauthorized:"Authorization required to access URI"},month:{0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"}},t={clear:function(b){return typeof b=="undefined"&&(b="all"),h.un(a,"message","message",b)},send:function(a,b){try{a.postMessage(b,"*")}catch(c){j(c,arguments,this)}return a},recv:function(b,c){return typeof c=="undefined"&&(c="all"),h.on(a,"message",b,"message",a,c)}},u={enabled:!1,log:!1,diff:{x:null,y:null},pos:{x:null,y:null},prev:{x:null,y:null},track:function(a){var c=g.mouse;switch(!0){case typeof a=="object":var d=b[n.ie&&n.version<9?"documentElement":"body"],e=a.pageX?a.pageX:d.scrollLeft+a.clientX,f=a.pageY?a.pageY:d.scrollTop+a.clientY,i=!1;c.pos.x!==e&&(i=!0),h.mouse.prev.x=c.prev.x=Number(c.pos.x),h.mouse.pos.x=c.pos.x=e,h.mouse.diff.x=c.diff.x=c.pos.x-c.prev.x,c.pos.y!==f&&(i=!0),h.mouse.prev.y=c.prev.y=Number(c.pos.y),h.mouse.pos.y=c.pos.y=f,h.mouse.diff.y=c.diff.y=c.pos.y-c.prev.y,i&&c.log&&z.log(c.pos.x+" ["+c.diff.x+"], "+c.pos.y+" ["+c.diff.y+"]");break;case typeof a=="boolean":a?w.add(b,"mousemove",g.mouse.track,"tracking"):w.remove(b,"mousemove","tracking"),h.mouse.enabled=c.enabled=a}return c}},v={diff:function(a,b){if(isNaN(a)||isNaN(b))throw Error(s.error.expectedNumber);return Math.abs(a-b)},even:function(a){return a%2===0},format:function(a,b,c){if(isNaN(a))throw Error(s.error.expectedNumber);a=a.toString(),b=b||",",c=c||3;var d=a.indexOf(".")>-1?"."+a.replace(/.*\./,""):"",e=a.replace(/\..*/,"").split("").reverse(),f=Math.floor(e.length/c),g=1,h,i;for(i=0;i<f;i++)h=g===1?c:c*g+(g===2?1:g-1),e.splice(h,0,b),g++;return e=e.reverse().join(""),e.charAt(0)===b&&(e=e.substring(1)),e+d},half:function(a,b){return typeof b!="undefined"?a/b===.5:a/2},odd:function(a){return a%2!==0},parse:function(a){return String(a).indexOf(".")<0?parseInt(a):parseFloat(a)},round:function(a,b){return String(a).indexOf(".")<0?a:(/down|up/.test(b)||(b="down"),Math[b==="down"?"floor":"ceil"](a))}},w={listeners:{},log:!1,add:function(a,b,c,d,e,f){a=z.object(a),e=e||g,f=f||g.state.current;if(a instanceof Array)return a.each(function(a){w.add(a,b,c,d,e,f)});typeof b!="undefined"&&(b=b.explode());if(typeof d=="undefined"||!/\w/.test(d))d=z.guid(!0);var h=null,i=w.listeners,j=w.id(a),k=!1,l=g.state.current,m=/body|document|window/i,n=/click|error|key|mousedown|mouseup/i,o,p,q;if(typeof j=="undefined"||b===null||typeof b=="undefined"||typeof c!="function")throw Error(s.error.invalidArguments);return b.each(function(b){k=!1,typeof i[j]=="undefined"&&(i[j]={}),typeof i[j][b]=="undefined"&&(k=!0)&&(i[j][b]={}),typeof i[j][b][f]=="undefined"&&(i[j][b][f]={});if(k){switch(!0){case m.test(j):case!/\//g.test(j)&&j!=="abaaso":h=a;break;default:h=null}h!==null&&typeof h!="undefined"&&b.toLowerCase()!=="afterjsonp"&&(m.test(j)||typeof h.listeners=="function")&&(p=typeof h.addEventListener=="function",q=typeof h.attachEvent=="object"||p,q&&h[p?"addEventListener":"attachEvent"]((p?"":"on")+b,function(c){n.test(c.type)||z.stop(c),w.fire(a,b,c)},!1))}o={fn:c,scope:e},i[j][b][f][d]=o}),a},id:function(c){var d;switch(!0){case c===g:d="abaaso";break;case c===a:d="window";break;case c===!f&&b:d="document";break;case c===!f&&b.body:d="body";break;default:d=typeof c.id!="undefined"?c.id:typeof c.toString=="function"?c.toString():c}return d},fire:function(a,b,c){a=z.object(a);if(a instanceof Array)return a.each(function(d){w.fire(a[d],b,c)});typeof b=="string"&&(b=b.explode());var d=w.id(a),f=c,i=g.state.current,j=h.observer.log||g.observer.log,k,l,m;if(typeof d=="undefined"||String(d).isEmpty()||typeof a=="undefined"||typeof b=="undefined")throw Error(s.error.invalidArguments);return j&&z.log(d+" firing "+e),b.each(function(b){m=w.list(a,b),l=m.all,typeof l!="undefined"&&z.iterate(l,function(a,b){a.fn.call(a.scope,f)}),i!=="all"&&(l=m[i],typeof l!="undefined"&&z.iterate(l,function(a,b){a.fn.call(a.scope,f)}))}),a},list:function(a,b){a=z.object(a);var c=w.listeners,d=w.id(a),e;switch(!0){case typeof c[d]=="undefined"&&typeof b=="undefined":e={};break;case typeof c[d]!="undefined"&&(typeof b=="undefined"||String(b).isEmpty()):e=c[d];break;case typeof c[d]!="undefined"&&typeof c[d][b]!="undefined":e=c[d][b];break;default:e={}}return e},once:function(a,b,c,d,e,f){var h=d||z.genId();a=z.object(a),e=e||g,f=f||g.state.current;if(typeof a=="undefined"||b===null||typeof b=="undefined"||typeof c!="function")throw Error(s.error.invalidArguments);return a instanceof Array?a.each(function(a){w.once(a,b,c,d,e,f)}):(w.add(a,b,function(d){w.remove(a,b,h,f),c.call(e,d)},h,e,f),a)},remove:function(a,b,c,d){a=z.object(a),d=d||g.state.current;if(a instanceof Array)return a.each(function(a){w.remove(a,b,c,d)});var e=null,f=w.listeners,h=w.id(a);switch(!0){case typeof h=="undefined":case typeof f[h]=="undefined":return a}return typeof b=="undefined"||b===null?delete f[h]:b.explode().each(function(b){if(typeof f[h][b]=="undefined")return a;typeof c=="undefined"?f[h][b][d]={}:delete f[h][b][d][c]}),a}},x={bang:/\#|\!\//g,regex:new RegExp,routes:{all:{error:function(){if(!!f)throw Error(s.error.invalidRoute);if(x.hash()==="")return history.go(-1);z.error(s.error.invalidRoute),g.route.initial!==null&&x.hash(g.route.initial)}},del:{},get:{},put:{},post:{}},method:function(a){return/all|del|get|put|post/gi.test(a)?a.toLowerCase():"all"},del:function(a,b){b=x.method(b);var c=a==="error";if(c&&b!=="all"||!c&&x.routes[b].hasOwnProperty(a))return g.route.initial===a&&(g.route.initial=null),delete x.routes[b][a];throw Error(s.error.invalidArguments)},hash:function(a){var c="";return typeof a=="undefined"?c=b.location.hash.replace(x.bang,""):(c=a.replace(x.bang,""),b.location.hash="!/"+c),c},init:function(){var a=b.location.hash;return a.isEmpty()?x.hash(g.route.initial!==null?g.route.initial:l.cast(x.routes.all,!0).remove("error").first()):x.load(a),a.replace(x.bang,"")},list:function(a){var b;switch(!0){case!f:b=l.cast(x.routes.all,!0);break;case typeof a!="undefined":b=l.cast(x.routes[x.method(a)],!0);break;default:b={},z.iterate(x.routes,function(a,c){b[c]=[],z.iterate(a,function(a,d){b[c].push(d)})})}return b},load:function(a,b,c){c=x.method(c);var d="",e="",f=!0,g;a=a.replace(x.bang,""),g=function(a,b,c){if(z.compile(x.regex,"^"+a+"$","i")&&x.regex.test(c))return d=a,e=b,!1};switch(!0){case typeof x.routes[c][a]!="undefined":d=a,e=c;break;case c!=="all"&&typeof x.routes.all[a]!="undefined":d=a,e="all";break;default:z.iterate(x.routes[c],function(b,d){return g(d,c,a)}),d.isEmpty()&&c!=="all"&&z.iterate(x.routes.all,function(b,c){return g(c,"all",a)})}return d.isEmpty()&&(d="error",e="all",f=!1),x.routes[e][d](b||d),f},server:function(a,b,c){a=a||{},c=c===!0||a.port===443;if(!f)throw Error(s.error.notSupported);h.route.enabled=g.route.enabled=!0,a.host=a.host||"127.0.0.1",a.port=parseInt(a.port)||8e3,c?https.createServer(a,function(a,b){x.load(require("url").parse(a.url).pathname,b,a.method)}).on("error",function(a){j(a,this,arguments),typeof b=="function"&&b(a)}).listen(a.port):http.createServer(function(a,b){x.load(require("url").parse(a.url).pathname,b,a.method)}).on("error",function(a){j(a,this,arguments),typeof b=="function"&&b(a)}).listen(a.port,a.host)},set:function(a,b,c){c=f?x.method(c):"all";if(typeof a!="string"||a.isEmpty()||typeof b!="function")throw Error(s.error.invalidArguments);return x.routes[c][a]=b,!0}},y={capitalize:function(a){return a=y.trim(a),a.charAt(0).toUpperCase()+a.slice(1)},escape:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},explode:function(a,b){if(typeof b=="undefined"||b.toString()==="")b=",";return y.trim(a).split(new RegExp("\\s*"+b+"\\s*"))},hyphenate:function(a,b){b=b===!0;var c;return c=y.trim(a).replace(/\s+/g,"-"),b&&(c=c.replace(/([A-Z])/g,"-$1").toLowerCase()),c},singular:function(a){return/s$/.test(a)?a.slice(0,-1):a},toCamelCase:function(a){var b=y.trim(a).toLowerCase().split(/\s|-/),c=[];return b.each(function(a,b){a=y.trim(a);if(a.isEmpty())return;c.push(b===0?a:y.capitalize(a))}),c.join("")},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},uncapitalize:function(a){return a=y.trim(a),a.charAt(0).toLowerCase()+a.slice(1)}},z={timer:{},$:function(a,c){if(f||String(a).indexOf("?")>-1)return undefined;var d=[],e=[],g,i;a=a.trim(),c=c===!0,a.indexOf(",")>-1&&(a=a.explode());if(a instanceof Array)return a.each(function(a){e.push(h(a,c))}),e.each(function(a){d=d.concat(a)}),d;switch(!0){case/\s|>/.test(a):i=a.split(" ").filter(function(a){if(a.trim()!==""&&a!==">")return!0}).last(),g=b[i.indexOf("#")>-1&&i.indexOf(":")===-1?"querySelector":"querySelectorAll"](a);break;case a.indexOf("#")===0&&a.indexOf(":")===-1:g=isNaN(a.charAt(1))?b.querySelector(a):b.getElementById(a.substring(1));break;case a.indexOf("#")>-1&&a.indexOf(":")===-1:g=b.querySelector(a);break;default:g=b.querySelectorAll(a)}return typeof g!="undefined"&&g!==null&&!(g instanceof Element)&&!c&&(g=l.cast(g)),g===null&&(g=undefined),g},alias:function(a,b){var c=a,d=b;return z.iterate(d,function(a,b){var e,f;switch(!0){case!(a instanceof RegExp)&&typeof a=="function":c[b]=a.bind(c[b]);break;case!(a instanceof RegExp)&&!(a instanceof Array)&&a instanceof Object:typeof c[b]=="undefined"&&(c[b]={}),z.alias(c[b],d[b]);break;default:e=function(){return d[b]},f=function(a){d[b]=a},z.property(c,b,{enumerable:!0,get:e,set:f,value:d[b]})}}),a},clone:function(a){var b;switch(!0){case a instanceof Array:return[].concat(a);case typeof a=="boolean":return Boolean(a);case typeof a=="function":return a;case typeof a=="number":return Number(a);case typeof a=="string":return String(a);case!n.ie&&!f&&a instanceof Document:return C.decode(C.encode(a));case a instanceof Object:return b=r.decode(r.encode(a)),typeof b!="undefined"&&(a.hasOwnProperty("constructor")&&(b.constructor=a.constructor),a.hasOwnProperty("prototype")&&(b.prototype=a.prototype)),b;default:return a}},coerce:function(a){var b=z.clone(a),c;switch(!0){case/^\d$/.test(b):b=v.parse(b);break;case/^(true|false)$/i.test(b):b=/true/i.test(b);break;case b==="undefined":b=undefined;break;case b==="null":b=null;break;case(c=r.decode(b,!0))&&typeof c!="undefined":b=c}return b},compile:function(a,b,c){return a.compile(b,c),!0},css:function(a,c){var d,e;return d=h("head")[0].create("style",{type:"text/css",media:c||"print, screen"}),d.styleSheet?d.styleSheet.cssText=a:(e=b.createTextNode(a),d.appendChild(e)),d},define:function(a,b,c){a=a.split("."),typeof c=="undefined"&&(c=this),typeof b=="undefined"&&(b=null),c===h&&(c=g);var d=c,e=a.length;return a.each(function(c,f){var g=f+1<e&&!isNaN(parseInt(a[f+1])),h=b;isNaN(parseInt(c))||(c=parseInt(c));switch(!0){case typeof d[c]=="undefined":d[c]=g?[]:{};break;case d[c]instanceof Object&&g:d[c]=l.cast(d[c]);break;case d[c]instanceof Object:break;case d[c]instanceof Array&&!g:d[c]=d[c].toObject();break;default:d[c]={}}f+1===e?d[c]=h:d=d[c]}),c},defer:function(a,b,c){b=b||10,c=c||z.guid(!0);var d=function(){delete z.timer[c],a()};return z.timer[c]=setTimeout(d,b),undefined},domId:function(a){return"a"+a.replace(/-/g,"").slice(1)},error:function(a,b,c,d){var e;return typeof a!="undefined"&&(d=d===!0,e={arguments:b,message:typeof a.message!="undefined"?a.message:a,number:typeof a.number!="undefined"?a.number&65535:undefined,scope:c,stack:typeof a.stack=="string"?a.stack:undefined,timestamp:(new Date).toUTCString(),type:typeof a.type!="undefined"?a.type:"TypeError"},typeof console!="undefined"&&console[d?"warn":"error"](e.message),h.error.log.push(e),h.fire("error",e)),undefined},extend:function(a,b){var c,d;if(typeof a=="undefined")throw Error(s.error.invalidArguments);typeof b=="undefined"&&(b={});switch(!0){case typeof Object.create=="function":c=Object.create(a);break;default:d=function(){},d.prototype=a,c=new d}return z.merge(c,b),c},genId:function(a){var b;switch(!0){case a instanceof Array:case a instanceof String:case typeof a=="string":case typeof a!="undefined"&&typeof a.id!="undefined"&&a.id!=="":return a}do b=z.domId(z.guid(!0));while(typeof h("#"+b)!="undefined");return typeof a=="object"?(a.id=b,a):b},guid:function(a){a=a===!0;var b=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},c=[8,9,"a","b"],d;return d=(b()+b()+"-"+b()+"-4"+b().substr(0,3)+"-"+c[Math.floor(Math.random()*c.length)]+b().substr(0,3)+"-"+b()+b()+b()).toLowerCase(),a&&(d=d.replace(/-/gi,"")),d},iterate:function(a,b){var c,d;if(typeof b!="function")throw Error(s.error.invalidArguments);for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){d=b.call(a,a[c],c);if(d===!1)break}return a},loading:function(a){var b=g.loading;a=z.object(a);if(a instanceof Array)return a.each(function(a){z.loading(a)});if(b.url===null)throw Error(s.error.elementNotFound);if(typeof a=="undefined")throw Error(s.error.invalidArguments);return typeof b.image=="undefined"&&(b.image=new Image,b.image.src=b.url),a.clear(),a.create("div",{"class":"loading"}).create("img",{alt:s.common.loading,src:b.image.src}),a},log:function(a){try{console.log("["+(new Date).toLocaleTimeString()+"] "+a)}catch(b){j(b,arguments,this)}return undefined},merge:function(a,b){return z.iterate(b,function(b,c){a[c]=z.clone(b)}),a},module:function(a,b){if(typeof h[a]!="undefined"||typeof g[a]!="undefined"||!b instanceof Object)throw Error(s.error.invalidArguments);return g[a]=b,typeof b=="function"?h[a]=!n.ie||n.version>8?g[a].bind(h[a]):g[a]:(h[a]={},z.alias(h[a],g[a])),h[a]},object:function(a){return typeof a=="object"?a:a.toString().charAt(0)==="#"?h(a):a},property:function(a,b,c){if(c instanceof Object){var d;return d=(!n.ie||n.version>8)&&typeof Object.defineProperty=="function",d&&typeof c.value!="undefined"&&typeof c.get!="undefined"&&delete c.value,d?Object.defineProperty(a,b,c):a[b]=c.value,a}throw Error(s.error.invalidArguments)},proto:function(a,b){var c,d={array:{add:function(a){return l.add(this,a)},addClass:function(a){return this.each(function(b){b.addClass(a)})},after:function(a,b){var c=[];return this.each(function(d){c.push(d.after(a,b))}),c},append:function(a,b){var c=[];return this.each(function(d){c.push(d.append(a,b))}),c},attr:function(a,b){var c=[];return this.each(function(d){c.push(d.attr(a,b))}),c},before:function(a,b){var c=[];return this.each(function(d){c.push(d.before(a,b))}),c},clear:function(a){return this.each(function(a){a.clear()})},clone:function(){return z.clone(this)},contains:function(a){return l.contains(this,a)},create:function(a,b,c){var d=[];return this.each(function(e){d.push(e.create(a,b,c))}),d},css:function(a,b){return this.each(function(c){c.css(a,b)})},data:function(a,b){var c=[];return this.each(function(d){c.push(d.data(a,b))}),c},diff:function(a){return l.diff(this,a)},disable:function(){return this.each(function(a){a.disable()})},destroy:function(){return this.each(function(a){a.destroy()}),[]},each:function(a){return l.each(this,a)},enable:function(){return this.each(function(a){a.enable()})},find:function(a){var b=[];return this.each(function(c){c.find(a).each(function(a){b.contains(a)||b.push(a)})}),b},fire:function(a,b){return this.each(function(c){c.fire(a,b)})},first:function(){return l.first(this)},get:function(a,b){return this.each(function(c){c.get(a,b)}),[]},has:function(a){var b=[];return this.each(function(c){b.push(c.has(a))}),b},hasClass:function(a){var b=[];return this.each(function(c){b.push(c.hasClass(a))}),b},hide:function(){return this.each(function(a){a.hide()})},html:function(a){if(typeof a!="undefined")return this.each(function(b){b.html(a)});var b=[];return this.each(function(a){b.push(a.html())}),b},index:function(a){return l.index(this,a)},indexed:function(){return l.indexed(this)},intersect:function(a){return l.intersect(this,a)},is:function(a){var b=[];return this.each(function(c){b.push(c.is(a))}),b},isAlphaNum:function(){var a=[];return this.each(function(b){a.push(b.isAlphaNum())}),a},isBoolean:function(){var a=[];return this.each(function(b){a.push(b.isBoolean())}),a},isChecked:function(){var a=[];return this.each(function(b){a.push(b.isChecked())}),a},isDate:function(){var a=[];return this.each(function(b){a.push(b.isDate())}),a},isDisabled:function(){var a=[];return this.each(function(b){a.push(b.isDisabled())}),a},isDomain:function(){var a=[];return this.each(function(b){a.push(b.isDomain())}),a},isEmail:function(){var a=[];return this.each(function(b){a.push(b.isEmail())}),a},isEmpty:function(){var a=[];return this.each(function(b){a.push(b.isEmpty())}),a},isHidden:function(){var a=[];return this.each(function(b){a.push(b.isHidden())}),a},isIP:function(){var a=[];return this.each(function(b){a.push(b.isIP())}),a},isInt:function(){var a=[];return this.each(function(b){a.push(b.isInt())}),a},isNumber:function(){var a=[];return this.each(function(b){a.push(b.isNumber())}),a},isPhone:function(){var a=[];return this.each(function(b){a.push(b.isPhone())}),a},keys:function(){return l.keys(this)},last:function(a){return l.last(this)},listeners:function(a){var b=[];return this.each(function(c){b=b.concat(c.listeners(a))}),b},loading:function(){return this.each(function(a){a.loading()})},on:function(a,b,c,d,e){return this.each(function(f){f.on(a,b,c,typeof d!="undefined"?d:f,e)})},once:function(a,b,c,d,e){return this.each(function(f){f.once(a,b,c,typeof d!="undefined"?d:f,e)})},position:function(){var a=[];return this.each(function(b){a.push(b.position())}),a},prepend:function(a,b){var c=[];return this.each(function(d){c.push(d.prepend(a,b))}),c},range:function(a,b){return l.range(this,a,b)},remove:function(a,b){return l.remove(this,a,b)},removeClass:function(a){return this.each(function(b){b.removeClass(a)})},show:function(){return this.each(function(a){a.show()})},size:function(){var a=[];return this.each(function(b){a.push(b.size())}),a},text:function(a){return this.each(function(b){typeof b!="object"&&(b=z.object(b)),typeof b.text=="function"&&b.text(a)})},tpl:function(a){return this.each(function(b){b.tpl(a)})},toggleClass:function(a){return this.each(function(b){b.toggleClass(a)})},total:function(){return l.total(this)},toObject:function(){return l.toObject(this)},un:function(a,b,c){return this.each(function(d){d.un(a,b,c)})},update:function(a){return this.each(function(b){q.update(b,a)})},val:function(a){var b=[],c=null,d=!0;return this.each(function(e){c!==null&&(d=c===e.type),c=e.type,typeof e.val=="function"&&b.push(e.val(a))}),d?b[0]:b},validate:function(){var a=[];return this.each(function(b){a.push(b.validate())}),a}},element:{addClass:function(a){return z.genId(this),q.klass(this,a,!0)},after:function(a,b){return z.genId(this),q.create(a,b,this,"after")},append:function(a,b){return z.genId(this),q.create(a,b,this,"last")},attr:function(a,b){return z.genId(this),q.attr(this,a,b)},before:function(a,b){return z.genId(this),q.create(a,b,this,"before")},clear:function(){return z.genId(this),q.clear(this)},create:function(a,b,c){return z.genId(this),q.create(a,b,this,c)},css:function(a,b){return z.genId(this),q.css(this,a,b)},data:function(a,b){return z.genId(this),q.data(this,a,b)},destroy:function(){return q.destroy(this)},disable:function(){return q.disable(this)},enable:function(){return q.enable(this)},find:function(a){return z.genId(this),q.find(this,a)},fire:function(a,b){return z.genId(this),h.fire.call(this,a,b)},genId:function(){return z.genId(this)},get:function(a,b){this.fire("beforeGet");var c=m.get(a),d=this;return c?this.html(c.response).fire("afterGet"):a.get(function(a){d.html(a).fire("afterGet")},function(a){d.fire("failedGet",{response:n.parse(a),xhr:a})},b),this},has:function(a){return z.genId(this),q.has(this,a)},hasClass:function(a){return z.genId(this),q.hasClass(this,a)},hide:function(){return z.genId(this),q.hide(this)},html:function(a){return z.genId(this),typeof a=="undefined"?this.innerHTML:this.update({innerHTML:a})},is:function(a){return z.genId(this),q.is(this,a)},isAlphaNum:function(){return this.nodeName==="FORM"?!1:A.test({alphanum:typeof this.value!="undefined"?this.value:q.text(this)}).pass},isBoolean:function(){return this.nodeName==="FORM"?!1:A.test({"boolean":typeof this.value!="undefined"?this.value:q.text(this)}).pass},isChecked:function(){return this.nodeName!=="INPUT"?!1:this.attr("checked")},isDate:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isDate():q.text(this).isDate()},isDisabled:function(){return this.nodeName!=="INPUT"?!1:this.attr("disabled")},isDomain:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isDomain():q.text(this).isDomain()},isEmail:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isEmail():q.text(this).isEmail()},isEmpty:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isEmpty():q.text(this).isEmpty()},isHidden:function(a){return z.genId(this),q.hidden(this)},isIP:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isIP():q.text(this).isIP()},isInt:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isInt():q.text(this).isInt()},isNumber:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isNumber():q.text(this).isNumber()},isPhone:function(){return this.nodeName==="FORM"?!1:typeof this.value!="undefined"?this.value.isPhone():q.text(this).isPhone()},jsonp:function(a,b,c){var d=this,e=b,f;return f=function(a){var b=d,c=a,f=e,g,h,i;try{typeof f!="undefined"?(f=f.replace(/]|'|"/g,"").replace(/\./g,"[").split("["),f.each(function(a){c=c[isNaN(a)?a:parseInt(a)];if(typeof c=="undefined")throw Error(s.error.propertyNotFound)}),i=c):i=a}catch(k){i=s.error.serverError,j(k,arguments,this)}b.text(i)},n.jsonp(a,f,function(){d.text(s.error.serverError)},c),this},listeners:function(a){return z.genId(this),h.listeners.call(this,a)},loading:function(){return z.loading(this)},on:function(a,b,c,d,e){return z.genId(this),h.on.call(this,a,b,c,d,e)},once:function(a,b,c,d,e){return z.genId(this),h.once.call(this,a,b,c,d,e)},prepend:function(a,b){return z.genId(this),q.create(a,b,this,"first")},prependChild:function(a){return z.genId(this),q.prependChild(this,a)},position:function(){return z.genId(this),q.position(this)},removeClass:function(a){return z.genId(this),q.klass(this,a,!1)},show:function(){return z.genId(this),q.show(this)},size:function(){return z.genId(this),q.size(this)},text:function(a){return z.genId(this),q.text(this,a)},toggleClass:function(a){return z.genId(this),q.toggleClass(this,a)},tpl:function(a){return z.tpl(a,this)},un:function(a,b,c){return z.genId(this),h.un.call(this,a,b,c)},update:function(a){return z.genId(this),q.update(this,a)},val:function(a){return z.genId(this),q.val(this,a)},validate:function(){return this.nodeName==="FORM"?A.test(this):typeof this.value!="undefined"?!this.value.isEmpty():!q.text(this).isEmpty()}},"function":{reflect:function(){return z.reflect(this)}},number:{diff:function(a){return v.diff(this,a)},fire:function(a,b){return h.fire.call(this.toString(),a,b),this},format:function(a,b){return v.format(this,a,b)},half:function(a){return v.half(this,a)},isEven:function(){return v.even(this)},isOdd:function(){return v.odd(this)},listeners:function(a){return h.listeners.call(this.toString(),a)},on:function(a,b,c,d,e){return h.on.call(this.toString(),a,b,c,d||this,e),this},once:function(a,b,c,d,e){return h.once.call(this.toString(),a,b,c,d||this,e),this},roundDown:function(){return v.round(this,"down")},roundUp:function(){return v.round(this,"up")},un:function(a,b,c){return h.un.call(this.toString(),a,b,c),this}},string:{allows:function(a){return n.allows(this,a)},capitalize:function(){return y.capitalize(this)},del:function(a,b,c){return n.request(this,"DELETE",a,b,null,c)},escape:function(){return y.escape(this)},expire:function(a){return m.expire(this,a)},explode:function(a){return y.explode(this,a)},fire:function(a,b){return h.fire.call(this,a,b)},get:function(a,b,c){return n.request(this,"GET",a,b,null,c)},headers:function(a,b){return n.request(this,"HEAD",a,b)},hyphenate:function(a){return y.hyphenate(this,a)},isAlphaNum:function(){return A.test({alphanum:this}).pass},isBoolean:function(){return A.test({"boolean":this}).pass},isDate:function(){return A.test({date:this}).pass},isDomain:function(){return A.test({domain:this}).pass},isEmail:function(){return A.test({email:this}).pass},isEmpty:function(){return y.trim(this)===""},isIP:function(){return A.test({ip:this}).pass},isInt:function(){return A.test({integer:this}).pass},isNumber:function(){return A.test({number:this}).pass},isPhone:function(){return A.test({phone:this}).pass},jsonp:function(a,b,c){return n.jsonp(this,a,b,c)},listeners:function(a){return h.listeners.call(this,a)},post:function(a,b,c,d){return n.request(this,"POST",a,b,c,d)},put:function(a,b,c,d){return n.request(this,"PUT",a,b,c,d)},on:function(a,b,c,d,e){return h.on.call(this,a,b,c,d,e)},once:function(a,b,c,d,e){return h.once.call(this,a,b,c,d,e)},options:function(a,b){return n.request(this,"OPTIONS",a,b)},permissions:function(){return n.permissions(this)},singular:function(){return y.singular(this)},toCamelCase:function(){return y.toCamelCase(this)},toNumber:function(){return v.parse(this)},trim:function(){return y.trim(this)},un:function(a,b,c){return h.un.call(this,a,b,c)},uncapitalize:function(){return y.uncapitalize(this)}}};return z.iterate(d[b],function(b,c){z.property(a.prototype,c,{value:b})}),a},queryString:function(a){a=a||".*";var b={},d=c.search.isEmpty()?null:c.search.replace("?",""),e;return d!==null&&(d=d.split("&"),d.each(function(a){e=a.split("=");if(e[0].isEmpty())return;switch(!0){case typeof e[1]=="undefined":case e[1].isEmpty():e[1]="";break;case e[1].isNumber():e[1]=Number(e[1]);break;case e[1].isBoolean():e[1]=e[1]==="true"}switch(!0){case typeof b[e[0]]=="undefined":b[e[0]]=e[1];break;case!(b[e[0]]instanceof Array):b[e[0]]=[b[e[0]]];default:b[e[0]].push(e[1])}})),b},reflect:function(a){return typeof a=="undefined"&&(a=this),typeof a=="undefined"&&(a=h),a=a.toString().match(/function\s+\w*\s*\((.*?)\)/)[1],a!==""?a.explode():[]},repeat:function(a,b,c){b=b||10,c=c||z.guid(!0);var d=function(a,b,c){var d=this;a()!==!1&&z.defer(function(){d.call(d,a,b,c)},b)};return d.call(d,a,b,c),c},script:function(a,b,c){return q.create("script",{type:"application/javascript",src:a},b||h("head")[0],c)},stylesheet:function(a,b){return q.create("link",{rel:"stylesheet",type:"text/css",href:a,media:b||"print, screen"},h("head")[0])},stop:function(a){return typeof a.cancelBubble!="undefined"&&(a.cancelBubble=!0),typeof a.preventDefault=="function"&&a.preventDefault(),typeof a.stopPropagation=="function"&&a.stopPropagation(),a},tpl:function(a,c){var d;switch(!0){case typeof a!="object":case!/object|undefined/.test(typeof c)&&typeof (c=c.charAt(0)==="#"?h(c):h(c)[0])=="undefined":throw Error(s.error.invalidArguments)}typeof c=="undefined"&&(c=h("body")[0]),d=b.createDocumentFragment();switch(!0){case a instanceof Array:a.each(function(a,b){q.create(l.cast(a,!0)[0],d).html(l.cast(a)[0])});break;default:z.iterate(a,function(a,b){switch(!0){case typeof a=="string":q.create(b,d).html(a);break;case a instanceof Array:case a instanceof Object:z.tpl(a,q.create(b,d))}})}return c.appendChild(d),l.last(c.childNodes)},walk:function(a,b){return b.replace(/\]$/,"").replace(/\]/g,".").split(/\.|\[/).each(function(b){a=a[b]}),a}},A={pattern:{alphanum:/^[a-zA-Z0-9]+$/,"boolean":/^(0|1|true|false)?$/,domain:/^[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/,email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,integer:/(^-?\d\d*$)/,notEmpty:/\w{1,}/,number:/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/,phone:/^([0-9\(\)\/\+ \-\.]+)$/},test:function(a){var b=!1,c=[],d={},e=null,f=[],g=[],i=[],j=[],k,l,m,n,o;return typeof a.nodeName!="undefined"&&a.nodeName==="FORM"?(a.id.isEmpty()&&a.genId(),i=h("#"+a.id+" input"),j=h("#"+a.id+" select"),i.length>0&&(g=g.concat(i)),j.length>0&&(g=g.concat(j)),g.each(function(a){var d={},e,f,g;e=A.pattern[a.nodeName.toLowerCase()]?A.pattern[a.nodeName.toLowerCase()]:!a.id.isEmpty()&&A.pattern[a.id.toLowerCase()]?A.pattern[a.id.toLowerCase()]:"notEmpty",f=a.val(),f===null&&(f=""),d[e]=f,g=A.test(d),g.pass||(c.push({element:a,test:e,value:f}),b=!0)})):z.iterate(a,function(a,d){if(typeof d=="undefined"||typeof a=="undefined"){c.push({test:d,value:a}),b=!0;return}e=String(a).charAt(0)==="#"?typeof h(a)!="undefined"?h(a).val():"":a;switch(d){case"date":isNaN((new Date(e)).getYear())&&(c.push({test:d,value:e}),b=!0);break;case"domain":A.pattern.domain.test(e.replace(/.*\/\//,""))||(c.push({test:d,value:e}),b=!0);break;case"domainip":if(!A.pattern.domain.test(e.replace(/.*\/\//,""))||!A.pattern.ip.test(e))c.push({test:d,value:e}),b=!0;break;default:l=typeof A.pattern[d]!="undefined"?A.pattern[d]:d,l.test(e)||(c.push({test:d,value:e}),b=!0)}}),{pass:!b,invalid:c}}},B=function(){var a=require("url"),b=require("http"),c=require("https"),d=0,e=1,f=2,g=3,h=4,i,j,k;return j={"User-Agent":"abaaso/2.8.21 node.js/"+process.versions.node.replace(/^v/,"")+" ("+y.capitalize(process.platform)+" V8/"+process.versions.v8+")",Accept:"*/*"},k=function(a){return this.readyState!==a&&(this.readyState=a,(this._params.async||this.readyState<e||this.readyState===h)&&this.dispatchEvent("readystatechange"),this.readyState===h&&!this._error&&(this.dispatchEvent("load"),this.dispatchEvent("loadend"))),this},i=function(){return this.onabort=null,this.onerror=null,this.onload=null,this.onloadend=null,this.onloadstart=null,this.onreadystatechange=null,this.readyState=d,this.response=null,this.responseText="",this.responseType="",this.responseXML=null,this.status=d,this.statusText="",this._error=!1,this._headers=j,this._listeners={},this._params={},this._request=null,this._resheaders={},this._send=!1,this},i.prototype.abort=function(){this._request!==null&&(typeof this._request.abort=="function"&&this._request.abort(),this._request=null),this._headers=j,this.responseText="",this.responseXML="",this._error=!0;if(this._send===!0||RegExp(f+"|"+g).test(this.readyState))this._send=!1,k.call(this,h);return this.readyState=d,this},i.prototype.addEventListener=function(a,b){return this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]),this._listeners[a].add(b),this},i.prototype.dispatchEvent=function(a){var b=this;return typeof this["on"+a]=="function"&&this["on"+a](),this._listeners.hasOwnProperty(a)&&this._listeners[a].each(function(a){typeof a=="function"&&a.call(b)}),this},i.prototype.getAllResponseHeaders=function(){var a="";if(this.readyState<f)throw Error("INVALID_STATE_ERR: Headers have not been received");return z.iterate(this._resheaders,function(b,c){a+=c+": "+b+"\n"}),a},i.prototype.getResponseHeader=function(a){var b;if(this.readyState<f)throw Error("INVALID_STATE_ERR: Headers have not been received");return b=this._resheaders[a]||this._resheaders[a.toLowerCase()],b},i.prototype.open=function(a,b,c,d,f){if(typeof c!="undefined"&&c!==!0)throw Error("Synchronous XMLHttpRequest requests are not supported");return this.abort(),this._error=!1,this._params={method:a,url:b,async:c||!0,user:d||null,password:f||null},this.readyState=e,this},i.prototype.overrideMimeType=function(a){return this._headers["Content-Type"]=a,this},i.prototype.removeEventListener=function(a,b){if(!this._listeners.hasOwnProperty(a))return;return this._listeners[a].remove(b),this},i.prototype.send=function(d){d=d||null;var i=this,j,l,m,n,o,p;switch(!0){case this.readyState<e:throw Error("INVALID_STATE_ERR: Object is not open");case this._send:throw Error("INVALID_STATE_ERR: Object is sending")}return n=a.parse(this._params.url),n.port=n.port||(n.protocol==="https"?443:80),this._params.user!==null&&this._params.password!==null&&(n.auth=this._params.user+":"+this._params.password),d!==null&&(this._headers["Content-Length"]=d.length),m={hostname:n.hostname,path:n.path,port:n.port,method:this._params.method,headers:this._headers},typeof n.auth!="undefined"&&(m.auth=n.auth),j=function(a){k.call(i,f),i.status=a.statusCode,i._resheaders=a.headers,typeof i._resheaders["set-cookie"]!="undefined"&&i._resheaders["set-cookie"]instanceof Array&&(i._resheaders["set-cookie"]=i._resheaders["set-cookie"].join(";")),a.on("data",function(b){a.setEncoding("utf8"),b&&(i.responseText+=b),i._send&&k.call(i,g)}),a.on("end",function(){i._send&&(k.call(i,h),i._send=!1)}),a.on("error",function(a){l(a)})},l=function(a){i.status=503,i.statusText=a,i.responseText=a.stack,i._error=!0,i.dispatchEvent("error"),k.call(i,h)},i._send=!0,i.dispatchEvent("readystatechange"),p=n.protocol==="http:"?b:c,o=p.request(m,j).on("error",l),i._request=o,d!==null&&o.write(d,"utf8"),o.end(),i.dispatchEvent("loadstart"),this},i.prototype.setRequestHeader=function(a,b){switch(!0){case this.readyState!==e:throw Error("INVALID_STATE_ERR: Object is not usable");case this._send:throw Error("INVALID_STATE_ERR: Object is sending")}return this._headers[a]=b,this},i},C={decode:function(a){try{if(typeof a!="string"||a.isEmpty())throw Error(s.error.invalidArguments);var b;return n.ie?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b}catch(c){return j(c,arguments,this),undefined}},encode:function(a,b){try{if(typeof a=="undefined")throw Error(s.error.invalidArguments);b=b!==!1;var c=b?"<xml>":"",d=arguments[2]!==!1,e,f;a!==null&&typeof a.xml!="undefined"&&(a=a.xml),a instanceof Document&&(a=(new XMLSerializer).serializeToString(a)),e=function(a,b){var c="<n>v</n>";return/\&|\<|\>|\"|\'|\t|\r|\n|\@|\$/g.test(b)&&(c=c.replace(/v/,"<![CDATA[v]]>")),c.replace(/n/g,a).replace(/v/,b)};switch(!0){case typeof a=="boolean":case typeof a=="number":case typeof a=="string":c+=e("item",a);break;case typeof a=="object":z.iterate(a,function(a,b){c+=C.encode(a,typeof a=="object",!1).replace(/item|xml/g,isNaN(b)?b:"item")})}return c+=b?"</xml>":"",d&&(c='<?xml version="1.0" encoding="UTF8"?>'+c),c}catch(g){return j(g,arguments,this),undefined}}};return j=z.error,i=function(){var d,e;typeof g.bootstrap=="function"&&delete g.bootstrap,g.client.size=n.size(),n.version(),n.mobile(),n.tablet();if(n.ie&&n.version<8)return;d=function(a){var b=[];w.remove(a),a.childNodes.length>0&&(b=l.cast(a.childNodes)),b.length>0&&b.each(function(a){d(a)})},e=function(a){if(/complete|loaded/.test(b.readyState))return typeof g.init=="function"&&g.init(),!1},typeof Array.prototype.filter=="undefined"&&(Array.prototype.filter=function(a){if(this===void 0||this===null||typeof a!="function")throw Error(s.error.invalidArguments);var b=null,c=Object(this),d=c.length>>>0,e=[],f=arguments[1],g=null;for(b=0;b<d;b++)b in c&&(g=c[b],a.call(f,g,b,c)&&e.push(g));return e}),typeof Array.prototype.forEach=="undefined"&&(Array.prototype.forEach=function(a,b){if(this===null||typeof a!="function")throw Error(s.error.invalidArguments);var c,d=0,e=Object(this),f=e.length>>>0;b&&(c=b);while(d<f){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),typeof Array.prototype.indexOf=="undefined"&&(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(this[c]===a)return c;return-1}),!f&&typeof b.documentElement.classList=="undefined"&&function(a){var b,c,d,e,f;if(!("HTMLElement"in a||"Element"in a))return;b=function(a){var b=a.className.isEmpty()?[]:a.className.explode(" "),c=this;b.each(function(a){c.push(a)}),this.updateClassName=function(){a.className=this.join(" ")}},c=function(){return new b(this)},d=b.prototype=[],e=(a.HTMLElement||a.Element).prototype,d.add=function(a){l.contains(this,a)||(this.push(a),this.updateClassName())},d.contains=function(a){return l.contains(this,a)},d.remove=function(a){l.contains(this,a)&&(l.remove(this,a),this.updateClassName())},d.toggle=function(a){l[l.contains(this,a)?"remove":"add"](this,a),this.updateClassName()};if(Object.defineProperty)f={get:c,enumerable:!n.ie||n.version>8?!0:!1,configurable:!0},Object.defineProperty(e,"classList",f);else if(Object.prototype.__defineGetter__)e.__defineGetter__("classList",c);else throw Error("Could not create classList shim")}(a),typeof Function.prototype.bind=="undefined"&&(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=c.call(arguments,1);return function(){return b.apply(a,d.concat(c.call(arguments)))}}),f&&(delete g.cookie,XMLHttpRequest=B()),h=g.$.bind(h),z.alias(h,g),delete h.$,delete h.bootstrap,delete h.callback,delete h.data,delete h.init,delete h.loading,g.route.initial=null,h.loading=g.loading.create.bind(h.loading),h.fire=g.fire,h.on=g.on,h.once=g.once,h.un=g.un,h.listeners=g.listeners,g.state._current=g.state.current="initial",h.state._current=h.state.current=g.state.current;if(!f)switch(!0){case typeof a.$=="undefined"||a.$===null:a.$=h;break;default:a.a$=h,g.aliased="a$"}z.proto(Array,"array"),typeof Element!="undefined"&&z.proto(Element,"element"),typeof HTMLDocument!="undefined"&&z.proto(HTMLDocument,"element"),z.proto(Function,"function"),z.proto(Number,"number"),z.proto(String,"string"),g.constructor=g,h.error.log=g.error.log=[],h.on(a,"error",function(a){h.fire("error",a)},"error",a,"all"),f||(h.on(a,"hashchange",function(){h.fire("beforeHash, hash, afterHash",c.hash)},"hash",a,"all"),h.on(a,"resize",function(){h.client.size=g.client.size=n.size(),h.fire("resize",g.client.size)},"resize",a,"all"),h.on(a,"load",function(){h.fire("render").un("render")}),h.on(a,"DOMNodeInserted",function(a){var b=a.target;typeof b.id!="undefined"&&b.id.isEmpty()&&(z.genId(b),b.parentNode instanceof Element&&b.parentNode.fire("afterCreate",b),h.fire("afterCreate",b))},"mutation",a,"all"),h.on(a,"DOMNodeRemoved",function(a){d(a.target)},"mutation",a,"all"),h.on("hash",function(a){(h.route.enabled||g.route.enabled)&&x.load(a)},"route",g.route,"all"));var i,j;i=function(){return this._current},j=function(a){if(a===null||typeof a!="string"||this.current===a||a.isEmpty())throw Error(s.error.invalidArguments);return g.state.previous=g.state._current,g.state._current=a,g.fire(a)};switch(!0){case!n.ie||n.version>8:z.property(g.state,"current",{enumerable:!0,get:i,set:j}),z.property(h.state,"current",{enumerable:!0,get:i,set:j});break;default:g.state.change=function(a){return j.call(g.state,a),g.state.current=a},h.state.change=function(a){return j.call(g.state,a),g.state.current=a}}h.ready=!0;switch(!0){case f:g.init();break;case typeof a.define=="function":a.define("abaaso",function(){return g.init()});break;case/complete|loaded/.test(b.readyState):g.init();break;case typeof b.addEventListener=="function":b.addEventListener("DOMContentLoaded",g.init,!1);break;case typeof b.attachEvent=="function":b.attachEvent("onreadystatechange",e);break;default:z.timer.init=z.repeat(e)}},{array:l,callback:{},client:{android:n.android,blackberry:n.blackberry,chrome:n.chrome,firefox:n.firefox,ie:n.ie,ios:n.ios,linux:n.linux,mobile:n.mobile,opera:n.opera,osx:n.osx,playbook:n.playbook,safari:n.safari,tablet:n.tablet,size:{height:0,width:0},version:0,webos:n.webos,windows:n.windows,del:function(a,b,c,d){return n.request(a,"DELETE",b,c,null,d)},get:function(a,b,c,d){return n.request(a,"GET",b,c,null,d)},headers:function(a,b,c){return n.request(a,"HEAD",b,c)},post:function(a,b,c,d,e){return n.request(a,"POST",b,c,d,e)},put:function(a,b,c,d,e){return n.request(a,"PUT",b,c,d,e)},jsonp:function(a,b,c,d){return n.jsonp(a,b,c,d)},options:function(a,b,c){return n.request(a,"OPTIONS",b,c)},permissions:n.permissions},cookie:o,data:p,element:q,json:r,label:s,loading:{create:z.loading,url:null},message:t,mouse:u,number:v,observer:{log:w.log,add:w.add,fire:w.fire,list:w.list,once:w.once,remove:w.remove},state:{_current:null,header:null,previous:null},string:y,validate:A,xml:C,$:z.$,alias:z.alias,aliased:"$",allows:n.allows,append:function(a,b,c){return c instanceof Element&&c.genId(),q.create(a,b,c,"last")},bootstrap:i,clear:q.clear,clone:z.clone,coerce:z.coerce,compile:z.compile,create:q.create,css:z.css,decode:r.decode,defer:z.defer,define:z.define,del:function(a,b,c,d){return n.request(a,"DELETE",b,c,null,d)},destroy:q.destroy,encode:r.encode,error:z.error,expire:m.clean,expires:12e4,extend:z.extend,fire:function(a,b,c){var d=typeof c!="undefined",e,f,i;e=d?a:this,f=d?b:a,i=d?c:b;if(typeof e=="undefined"||e===h)e=g;return w.fire(e,f,i)},genId:z.genId,get:function(a,b,c,d){return n.request(a,"GET",b,c,null,d)},guid:z.guid,headers:function(a,b,c){return n.request(a,"HEAD",b,c)},hidden:q.hidden,id:"abaaso",init:function(){return delete g.init,h.fire("init").un("init").fire("ready").un("ready")},iterate:z.iterate,jsonp:function(a,b,c,d){return n.jsonp(a,b,c,d)},listeners:function(a){var b=this;if(typeof b=="undefined"||b===h)b=g;return w.list(b,a)},log:z.log,merge:z.merge,module:z.module,object:z.object,on:function(a,b,c,d,e,f){var i=typeof c=="function",j,k,l,m,n,o;j=i?a:this,k=i?b:a,l=i?c:b,m=i?d:c,n=i?e:d,o=i?f:e;if(typeof j=="undefined"||j===h)j=g;return typeof n=="undefined"&&(n=j),w.add(j,k,l,m,n,o)},once:function(a,b,c,d,e,f){var i=typeof c=="function",j,k,l,m,n,o;j=i?a:this,k=i?b:a,l=i?c:b,m=i?d:c,n=i?e:d,o=i?f:e;if(typeof j=="undefined"||j===h)j=g;return typeof n=="undefined"&&(n=j),w.once(j,k,l,m,n,o)},options:function(a,b,c){return n.request(a,"OPTIONS",b,c)},permissions:n.permissions,position:q.position,post:function(a,b,c,d,e){return n.request(a,"POST",b,c,d,e)},prepend:function(a,b,c){return c instanceof Element&&c.genId(),q.create(a,b,c,"first")},property:z.property,put:function(a,b,c,d,e){return n.request(a,"PUT",b,c,d,e)},queryString:z.queryString,ready:!1,reflect:z.reflect,repeat:z.repeat,route:{enabled:!1,del:x.del,hash:x.hash,init:x.init,list:x.list,load:x.load,server:x.server,set:x.set},stylesheet:z.stylesheet,script:z.script,stop:z.stop,store:function(a,b,c){return p.register.call(p,a,b,c)},tpl:z.tpl,un:function(a,b,c,d){var e=typeof c!="undefined",f,i,j,k;f=e?a:this,i=e?b:a,j=e?c:b,k=e?d:c;if(typeof f=="undefined"||f===h)f=g;return w.remove(f,i,j,k)},update:q.update,version:"2.8.21",walk:z.walk}}(),typeof g.bootstrap=="function"&&g.bootstrap();switch(!0){case typeof exports!="undefined":module.exports=g;break;case typeof define=="function":define(function(){return g});break;default:a.abaaso=g}})(this);